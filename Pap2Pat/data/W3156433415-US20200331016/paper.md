# Introduction

Irrigation withdrawals from groundwater sources in the United States totaled 217 GL=day in 2015 (Dieter et al. 2018). The largest of these groundwater resources, the Ogallala Aquifer, accounts for approximately 30% of total nationwide withdrawals (Natural Resources Conservation Service 2012). Innovations that create water-efficient and uniform center pivot irrigation systems have the ability to preserve this nonrenewable aquifer resource because center pivot systems account for 80% of all irrigated land in states that utilize the Ogallala Aquifer (National Agriculture Statistics Service 2019).

In-canopy sprinkler packages are a recent innovation that allow center pivot irrigation systems to operate more efficiently (Melvin and Martin 2018). However, these sprinkler packages can still malfunction, causing the system to operate at decreased levels of application uniformity. As a result, irrigated crops receive a nonuniform application of water. The cumulative impacts of these nonuniform irrigation events can decrease overall crop yield for the field, which substantially decreases the field's economic productivity (Kranz et al. 2012). Therefore, decreasing the rate at which these innovations malfunction should be an environmental and economic priority.

Detachment from the center pivot is the primary mechanism by which in-canopy sprinklers malfunction. In-canopy sprinklers hang low in the crop biomass, increasing the potential of entanglement and detachment from the center pivot (Melvin and Martin 2018). Detached in-canopy sprinklers can create issues, such as runoff, soil erosion, anaerobic soil conditions, and deep percolation of nutrients (Rudnick et al. 2016). To prevent these uniformity issues, it is crucial to detect and replace detached in-canopy sprinklers immediately. Unlike overhead sprinkler packages, detachments of these in-canopy packages are not easily visible during drive-by field checks or identifiable using yield maps (Kranz et al. 2012). The current method of detecting detached in-canopy sprinklers is by visual inspection along the center pivot span (Rudnick et al. 2016). Therefore, a monitoring system that sends an alert when and where an in-canopy sprinkler detaches from the center pivot would assist in repairing the system before long-term uniformity issues occur.

## Objective

The objective of this study was to develop a novel prototype in-canopy sprinkler monitoring system that monitors in-canopy sprinklers on a center pivot irrigation system and alerts the user when and where a detachment of an in-canopy sprinkler occurs.

# Monitoring System Design

System Overview A novel system was created to monitor individual in-canopy sprinklers and communicate the time and location an in-canopy sprinkler or drop hose becomes detached from the center pivot. The monitoring system is composed of three key subsystems: a master controller node, a series of sprinkler nodes monitoring each in-canopy sprinkler, and a digital compass node to assist in determining the location of the detachment site (Fig. 1). Development of this system utilized low-cost, publicly available technologies. All subsystems were connected to each other through an inter-integrated circuit serial communication bus, or I 2 C bus, for node-to-node communication and mounted inside weatherproof housing.

Application Note for Observed I 2 C Issues Throughout the development of this monitoring system, a critical issue was detected while using the I 2 C bus to communicate between subsystems. The master controller node was observed to become unresponsive, or stuck, after attempting to communicate with an unpowered node in the system. However, a solution was developed that utilizes relays or transistors to physically disconnect the unpowered node from the I 2 C bus upon power loss. The incoming serial data (SDA) and serial clock (SCL) lines are connected through the relay or transistor which is powered by the node itself. Upon power loss, the node's SDA and SCL connections to the I 2 C bus are severed effectively removing it from the system until power is restored. The absence of the node on the I 2 C bus can then be detected and communicated to the user without the monitoring system becoming unresponsive. This method can be deployed on similar systems utilizing I 2 C.

## Master Controller Node

The master controller node manages the entire system by monitoring and requesting data from all nodes while communicating pertinent information to the user. The node is controlled by an Arduino MKR GSM 1400, which is a microcontroller platform with integrated cellular communication. This node is connected to the I 2 C bus through a bidirectional logic level converter, CYT1076 (Fig. 2). The purpose of the logic level converter was to allow the Arduino MKR GSM 1400 to communicate with the other nodes of the monitoring system by converting the outgoing 3.3-V signals from the master controller node into the 5-V signals used by the rest of the system. Simultaneously, the logic level converter would convert incoming 5-V signals from the rest of the system into 3.3-V signals used by the master controller node.

The capital cost of the master controller node is approximately $75. The most expensive component of this node is the Arduino MKR GSM 1400 which can be purchased for approximately $55. The only known recurring expense for this node is the purchase and continued service of a subscriber identification module (SIM) card that allows the node to communicate with the user. The total of this recurring expense will be dependent on the user's preferred provider and plan and is therefore not included in this analysis. A complete capital cost analysis for the master controller node, which includes components for connecting this node to the rest of the system, can be found subsequently in Table 1.

The software of the master controller node performs the following functions: 1. Checks the status of all sprinkler nodes for missing in-canopy sprinklers and missing sprinkler nodes. 2. Requests compass bearing angle from the digital compass node. 3. Reads and responds to applicable text messages sent to the system, as seen in Table 2. 4. Reports any missing in-canopy sprinklers or sprinkler nodes to the user via a text message. When a detached in-canopy sprinkler is reported, the master controller node calculates the approximate geographic coordinates of the detachment site in decimal degrees. The coordinates are calculated using the known coordinates of the pivot point of the center pivot, the radius from the pivot point to the in-canopy sprinkler, and the current compass bearing angle. The coordinates of the detachment site must initially be calculated as a long integer in the software because the level of precision necessary for accurate coordinates in decimal degrees is not possible with the microcontroller found on most Arduino boards. Therefore, a longitude of 96.582840 would need to be denoted as 96582840 in the software.

To calculate the coordinates of the detachment site, a reference to the length of 1°latitude and longitude is required. According to Robinson (1995), this length is a function of latitude and can be calculated using Eqs. (1) and (2), where m DDLAT and m DDLON are the change of 1°latitude and longitude per meter, respectively, and Center Latitude is the latitude in decimal degrees of the pivot point of the center pivot. The coefficients found in both equations ensure that the final value has been converted into the long integer format required by the software: 

When an in-canopy sprinkler is reported missing, the coordinates of the detachment site are calculated in long integer format using Eqs. (3) and (4), where Lat Sprinkler is the latitude of the detachment site, Lon Sprinkler is the longitude of the detachment site, r Sprinkler is the radius from the pivot point to the in-canopy sprinkler, Center Latitude and Center Longitude are respectively the latitude and longitude of the pivot point in long integer format, and φ is the current compass bearing angle in radians:

The Lat Sprinkler and Lon Sprinkler values are then converted from the long integer format into decimal degrees by introducing a decimal point in the correct location. The system then sends a text    message to the user with information about which in-canopy sprinkler is missing and where it is located (Fig. 3). This process of calculating the detachment site and reporting the loss to the user is performed for every missing in-canopy sprinkler or drop hose detected by the monitoring system.

## Sprinkler Node

The sprinkler node monitors each connected in-canopy sprinkler and reports any detachments to the master controller node. This node consists of an Arduino Uno, a magnetic reed switch, an alternating current (AC) to direct current (DC) converter, and a relay shield (Fig. 4). The relays prevent the master controller node from becoming unresponsive by disconnecting the sprinkler node from the I 2 C bus in the event that a sprinkler node loses power (a concern mentioned earlier). Under this design (one sprinkler node monitoring one in-canopy sprinkler) the maximum number of in-canopy sprinklers that can be monitored by the system is 119 due to limitations using Arduino microcontrollers communicating with each other via I 2 C (Arduino 2020).

The capital cost of the sprinkler node is approximately $70. The most expensive components of this node are the Arduino Uno and relay shield, which can be purchased for approximately $23 and $20, respectively. A complete capital cost analysis for the sprinkler node, which includes components for connecting this node to the rest of the system, can be found in Table 3.

The magnetic reed switch is secured to the drop hose directly above the in-canopy sprinkler, and a small magnet is secured directly below the magnetic reed switch to the in-canopy sprinkler (Fig. 5). The wires from the magnetic reed switch are connected to the Arduino Uno through a breakaway plug, with half of the breakaway plug connected to the Arduino Uno and secured to the pivot span and the other half secured to the drop hose. The sprinkler node is able to register any detachments of the in-canopy sprinkler or drop hose since a loss of either component will result in the same loss of signal.

The sprinkler node's software begins by powering each relay to ensure that the node is connected to the I 2 C bus. In the event that the node loses power, the relays will disconnect the node from the I 2 C bus. If power is present, the sprinkler node then joins the I 2 C bus with an address matching the in-canopy sprinkler it is monitoring. When the master controller node requests data from  the sprinkler node, it responds with a value corresponding to the presence or absence of its in-canopy sprinkler and drop hose.

## Digital Compass Node

The digital compass node measures the center pivot's compass bearing angle and reports this value to the master controller node.

The node consists of two Arduino Uno boards, two relays or transistors, an AC to DC converter, and a digital compass module (Fig. 6). The digital compass module, HMC5883L, senses threeaxis magnetic vectors necessary for calculating a compass bearing and reports these values to Arduino Uno B (Fig. 6), which converts the raw vector information into a bearing angle. This bearing angle is then transferred to Arduino Uno A (Fig. 6), where it is then transferred to the master controller node.

The capital cost of the digital compass node is approximately $105. The most expensive component of this node is the digital compass module, which can be purchased for approximately $32. A complete capital cost analysis for the digital compass node, which includes components for connecting this node to the rest of the system, can be found subsequently in Table 4.

## Testing Apparatus

The monitoring system was connected to a demonstration center pivot, which consisted of a single span with eight detachable drop hoses and in-canopy sprinklers (Fig. 7). To test multiple compass bearing angles and detachment locations, the span was designed to pivot around a hinge which mounted the demonstration center pivot to a vertical pole. Sprinkler nodes were constructed and mounted to their respective in-canopy sprinklers, and the digital compass node was mounted to the end of the center pivot span. All nodes were connected to the master controller node and to one another via common I 2 C and 120 VAC wires.

# Results

Several experiments were performed to evaluate the accuracy and efficiency of the monitoring system. The first experiments were performed in two sets, with the first (Set 1) testing different aspects/ capabilities of the monitoring system in triplicate, and then (Set 2) repeating the same number of trials but incorporating a random number generator to determine the testing order. These experiments included the following steps:

• Detaching in-canopy sprinklers from the drop hose to ensure the system would alert the user to the change; • Detaching drop hoses from the center pivot span to ensure the system would alert the user to the change; • Disconnecting sprinkler nodes from the I 2 C bus to ensure the system would alert the user of the malfunction; and • Sending each possible text message outlined in Table 2 to ensure that the system responded with the appropriate action or information.

Each experiment was assessed as either a success or a failure defined by the system's response. Experimental results for both Sets 1 and 2 showed a perfect success rate for all experiments, demonstrating that the system will accurately and efficiently communicate the presence of detached in-canopy sprinklers, the presence of detached drop hoses, malfunctioning sprinkler nodes, and requested system information.

The second set of experiments evaluated the accuracy of the system-generated coordinates of detached in-canopy sprinklers. Each experiment consisted of rotating the demonstration center pivot to a unique compass bearing angle and detaching all in-canopy sprinklers. The monitoring system detected these detachments and sent a message detailing the coordinates of each detached in-canopy sprinkler, which were then recorded. The compass bearing angle, as measured by the system, was then requested from the monitoring system and recorded. The actual set of coordinates was determined by measuring the compass bearing angle manually with a compass and using this value with the coordinates of the pivot point and in-canopy sprinkler radii to determine the coordinates of the detachment sites. This follows the process previously described in Eqs. ( 1)-(4). The system-generated and actual coordinates for the measured compass bearing angles of 150°, 156°, 169°, 174°, 185°, and 189°are represented by black, purple, green, orange, blue, and red (right to left), respectively, in Fig. 8. The multiple coordinates per angle represent each detached sprinkler (eight sprinklers total). Analysis of the difference between the system-generated and actual coordinates led to the conclusion that the system-generated coordinates exhibited an average error of 0.16 m. Extrapolating this error to a center pivot with a span of approximately 400 m (quartermile), means the detached in-canopy sprinkler is located within a 7-m radius (on average) of the system-generated coordinates. Error would increase as distance from the pivot point of the detachment location increased. The observed error is likely caused by improper calibration of the digital compass module for local magnetic declination in addition to the module's inability to compensate for tilt. If the digital compass module had the ability to compensate for tilt, then it is hypothesized that the observed error would drastically decrease. Another possible option (which is beyond the objective of this current experiment) is to let this device communicate with the center pivot's main panel to generate the actual bearing angle of the center pivot.

# Design Revisions and Improvements

Overall, the designed monitoring system has proven to be effective in accurately detecting when and where an in-canopy sprinkler will detach from a center pivot irrigation system. However, revisions to the original design of the sprinkler node were made to increase functionality and to reduce the cost of the monitoring system. The sprinkler node design was revised to monitor up to four flow meters attached between the pivot mainline and each in-canopy sprinkler (Fig. 9). By updating the monitoring system to utilize flow meters instead of magnetic reed switches, the sprinkler nodes can now also   detect and alert the user when in-canopy sprinklers are clogged in addition to becoming detached from the center pivot system. The software of the master controller node and sprinkler node were also updated to reflect these design revisions.

The revised sprinkler node is controlled by an ATMEGA 328-PU microcontroller, the same microcontroller found embedded on commercially available Arduino Uno boards, which monitors the four connected flow meters (in this embodiment Adafruit Product ID 828) and reports flows outside of the designed flow limits. Normally this microcontroller would be limited to two interrupt pins, which are the inputs necessary for monitoring flow meters, but by using a series of transistors (Fig. 10) the microcontroller can alternate between two inputs per interrupt pin. These expansions not only allow each revised sprinkler node to monitor four flow meters but increase the theoretical limit of in-canopy sprinklers that can be monitored by the system to 476 units. This would not only encompass the majority of center pivot irrigation systems in use today but also represents a sharp increase from the 119 monitored in-canopy sprinkler capacity of monitoring systems using the original sprinkler node design. Additionally, the process to disconnect the revised sprinkler node from the I 2 C bus upon loss of power was simplified from the original design. Two transistors (BC337)  powered by the microcontroller were placed between the I 2 C connection ports and the microcontroller along the SDA and SCL lines, respectively. As with the original sprinkler node design, this keeps the monitoring system from becoming unresponsive. The revised sprinkler node can be programmed using a Future Technology Devices International (FTDI) 232 USB to serial UART integrated circuit (IC) device, which can be connected to the corresponding FTDI inputs on the node.

A custom printed circuit board (PCB) for the revised sprinkler node was designed utilizing PCB design software following the schematic in Fig. 10 and then exported to a manufacturer to be constructed. These PCBs reduce the overall cost of the monitoring system because mass-produced PCBs incorporating only the necessary electrical components are often cheaper substitutes than commercially available boards. For example, the capital cost of the revised sprinkler node is approximately $75, with the most expensive components being those used for weatherproofing the node (Table 5). Using PCBs in the revised design would also allow the assembly of these nodes to be less complex because most connections would already be etched into the PCBs.

After the manufactured PCBs were received, electrical components were soldered to the board (Fig. 11), and preliminary testing of the revised design commenced. Preliminary testing consisted of connecting a flow meter to each input and varying the flow to ensure the system responded appropriately. When the sprinkler node detected abnormally low flow rates, the system responded appropriately by notifying the user that the connected in-canopy sprinkler was clogged. Conversely, when abnormally high flow rates were detected, the system responded appropriately by notifying the user that the connected in-canopy sprinkler had become detached and could be located at a given set of coordinates. The system was also able to detect whether multiple in-canopy sprinklers connected to the same sprinkler node had malfunctioned through clogging or detachment. It can be concluded from this preliminary testing that the revised sprinkler node was operational and serves as a substitute for the original design while increasing the monitoring system's functionality.

The current deployed sprinkler package would determine the acceptable range of flow through each in-canopy sprinkler, and the high and low flow set points would be assigned accordingly. In deployments where pressure regulators are not used in conjunction with the sprinkler package, field topography may play a significant role in changing the designed flow rate range and cause the system to falsely determine whether an in-canopy sprinkler is malfunctioning. Therefore, in deployments where field topography changes significantly and pressure regulators are not used, initial data would need to be collected to correlate this changing acceptable flow rate range for each in-canopy sprinkler with current center pivot direction. Once these relationships are established, the monitoring system's software would need to be adjusted to determine the acceptable flow rate range for each in-canopy sprinkler as a function of center pivot direction in real-time ensuring that the system accounts for field topography. In deployments where pressure regulators are installed with each in-canopy sprinkler, field topography would not change flow rates significantly, and the previously mentioned adjustment would not be necessary.

# Discussion

## Cost Analysis of Monitoring System

To assess the feasibility of this monitoring system's deployment on full-scale center pivot irrigation systems, the capital cost for the monitoring system was estimated using both the original and revised sprinkler node designs. In this analysis the cost was estimated for deployment on a standard 400 m (quarter-mile) center pivot with in-canopy sprinkler spacing of 1.5 m (Melvin and Martin 2018). Therefore, in this scenario, the monitoring system would need to monitor 264 in-canopy sprinklers.

As previously mentioned, because of limitations associated with using I 2 C buses with Arduino microcontrollers, the maximum  number of in-canopy sprinklers that can be monitored using the original monitoring system is 119. Therefore, an additional master controller node would be necessary for this scenario, with the monitoring system costing approximately $18,000, or $69.62 per incanopy sprinkler monitored. However, the original sprinkler node could be redesigned to monitor up to four in-canopy sprinklers to make it more comparable to the monitoring capacity of the revised sprinkler node while lowering costs. With this change, the overall capital cost of the original monitoring system is reduced to approximately $5,900, or $22.27 per in-canopy sprinkler monitored. The revised monitoring system reduces the overall capital cost even further to approximately $5,500, or $20.77 per in-canopy sprinkler. The majority of these cost reductions occur from the revised sprinkler node utilizing only essential electronic components and monitoring up to four in-canopy sprinklers per node. This revision provides the most feasible design for full-scale deployment from a cost perspective, in addition to the numerous previously discussed advantages.

## Secondary Benefits of the Monitoring System

Two secondary benefits were discovered through the development of the monitoring system. The first benefit is the early detection of wire theft. Since the master controller node is designed to detect whether nodes are disconnected from the I 2 C bus, if wires connecting a node to the rest of the system are cut or stolen, an alert is immediately sent to the user. If multiple nodes in the system are reported missing, this is indicative of a physical disconnection of wires, not just the failure of a single node. This feature gives users reassurance that their system has not been stolen and remains operational.

The second benefit of the monitoring system is the ability to remotely sense the center pivot rotational direction or detect whether the irrigation system has become stuck. The incorporation of the Compass message option in the user interface allows users to request the current center pivot compass bearing angle. If users wish to remotely sense the direction in which the center pivot system is rotating, they would need to call this function several minutes apart and compare the responses. If the bearing angle increases between the two messages, then that means the center pivot is moving in a clockwise direction. Conversely, if the bearing angle decreases between the two messages, then the center pivot is moving in a counterclockwise direction. If the bearing angle is the same, then the center pivot is likely stuck in mud or has other mechanical issues that require immediate attention. These relationships hold true except for if the center pivot crosses North (0°) between the two messages. If this feature is deemed necessary/useful, the monitoring system's software could easily be modified to keep track of center pivot rotational direction and report the direction directly to the user.

## Future Work

This monitoring system has proven effective in accurately detecting malfunctioning in-canopy sprinklers on a center pivot irrigation system. However, two improvements are recommended to enhance the resiliency and accuracy of the monitoring system and ensure that it is ready for full-scale deployment.

The first improvement would be the incorporation of a watchdog timer. A watchdog timer consists of an independent processor that resets a computerized system if an error arises or if the system becomes unresponsive. This component would need to be integrated with the master controller node and would check for signals from the node. Anytime a signal is received, the watchdog timer resets its countdown. However, if the master controller node fails to check in before the countdown elapses, the watchdog timer would reset the master controller node and restart the countdown. The addition of a watchdog timer would provide the monitoring system an additional level of resiliency by preventing the user from needing to physically restart the system if it encounters a critical error.

The second improvement would be to increase the accuracy of the detachment coordinates of in-canopy sprinklers. The observed error in the current design primarily arose when the digital compass module, HMC5883L, was tilted off a level horizontal plane. Therefore, incorporating a tilt-compensated digital compass module into the design will ensure more accurately sensed compass bearing angles when the system is calculating the geographic coordinates of malfunctioning in-canopy sprinklers.

After these improvements are made, the monitoring system will be ready to be deployed and tested in actual production settings on a full-scale center pivot. However, several challenges will likely be encountered during this stage of development. The logistical challenges encountered during this stage will involve a significant increase in resources required to scale up the current system of eight monitored in-canopy sprinklers to the several hundred found on full-scale systems, in addition to the significant time necessary to construct and install each node in the system. It is also possible that design-related challenges will arise during this stage, and small adjustments to each node may be necessary. These challenges will need to be overcome before the technology can be deployed widely on full-scale center pivots, but the work outlined in this study represents significant progress toward that stage.

# Conclusions

With in-canopy sprinkler detachments impacting the efficiency and uniformity of irrigation systems and, ultimately, decreasing crop yield, it becomes crucial that producers detect and replace missing in-canopy sprinklers immediately. To alleviate these issues, a novel prototype in-canopy sprinkler monitoring system for center pivot irrigation was developed with the objective of accurately detecting and alerting users when and where in-canopy sprinklers become detached. The monitoring system is composed of three key subsystems: a master controller node, a series of sprinkler nodes, and a digital compass node. The system monitors all connected incanopy sprinklers and communicates if a detachment occurs to the user through messages sent over a cellular network. Experiments designed to validate the performance of the monitoring system demonstrated that the system accurately detects when an in-canopy sprinkler detaches from the system, with errors in the detachment location averaging 0.16 m. Extrapolating this error to a center pivot with a span of approximately 400 m (quarter-mile), means the detached in-canopy sprinkler is located within a 7-m radius (on average) of the system-generated coordinates, with error increasing with distance from the pivot point of the center pivot irrigation system.

The monitoring system gained increased functionality through the revision of the sprinkler node design, which allowed the node to detect clogged in-canopy sprinklers in addition to detachments. Even with these successful revisions, future work is necessary to improve the monitoring system to prepare it for deployment on a full-scale center pivot irrigation system. These improvements will increase the resiliency and accuracy of the system and include incorporating a watchdog timer and upgrading the current digital compass module to a tilt-compensated version.

# Acknowledgments

This material is based on research funded by the USDA Natural Resources Conservation Service under Awards 69-3A75-013 and 69-3A75-17-279 and the USDA Agricultural Research Service under Agreement 58-3090-5-007.

# Data Availability Statement

Some or all data, models, or code that support the findings of this study are available from the corresponding author upon reasonable request.

# Notation

The following symbols are used in this paper:

Center latitude = latitude of pivot point of center pivot; Center longitude = longitude of pivot point of center pivot;

Lat Sprinkler = latitude of detachment site; Lon Sprinkler = longitude of detachment site; m DDLAT = change of one degree of latitude per meter; m DDLON = change of one degree of longitude per meter; r Sprinkler = radius from pivot point to in-canopy sprinkler; and φ = compass bearing angle.

