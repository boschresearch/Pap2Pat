{
    "id": "US20220008157",
    "authors": [
        "Lena Maier-Hein",
        "Sebastian Josef Wirkert",
        "Anant Suraj Vemuri",
        "Leonardo Antonio Ayala Menjivar",
        "Silvia Seidlitz",
        "Thomas Kirchner",
        "Tim Adler"
    ],
    "title": "METHOD AND SYSTEM FOR AUGMENTED IMAGING IN OPEN TREATMENT USING MULTISPECTRAL INFORMATION",
    "date": "2019-07-31 00:00:00",
    "abstract": "Disclosed herein is a method of generating augmented images of tissue of a patient undergoing open treatment, in particular open surgery, wherein each augmented image associates at least one tissue parameter with a region or pixel of the image of the tissue, said method comprising the following steps: estimating a spectral composition of light illuminating a region of interest of the tissue, obtaining one or more multispectral images of the region of interest, applying a machine learning based regressor or classifier to the one or more multispectral images, or an image derived from said multispectral image, to thereby derive one or more tissue parameters associated with image regions or pixels of the corresponding multispectral image, wherein said regressor or classifier has been trained to predict the one or more tissue parameters from a multispectral image under a given spectral composition of illumination, wherein the regressor or classifier employed is made to match the estimated spectral composition of light illuminating said region of interest of the tissue.",
    "sections": [
        {
            "title": "DESCRIPTION",
            "paragraphs": [],
            "subsections": [
                {
                    "title": "FIELD OF THE INVENTION",
                    "paragraphs": [
                        "The present invention is in the field of medical technology. In particular, the present invention relates to a method and system for augmented imaging of tissue using multispectral information."
                    ],
                    "subsections": [],
                    "outline_long": [
                        "define field of invention"
                    ],
                    "num_characters": 193,
                    "outline_medium": [
                        "define field of invention"
                    ],
                    "outline_short": [
                        "define field of invention"
                    ]
                },
                {
                    "title": "BACKGROUND OF THE INVENTION",
                    "paragraphs": [
                        "In open or minimally invasive surgery, there is a need for augmented imaging of the tissue under treatment. Augmented imaging as understood herein indicates providing an image of the tissue which indicates additional information other than the film image of the tissue itself. This additional information is generally referred to as \u201ctissue parameter\u201d in the present disclosure.",
                        "One important example of such additional information could be functional information, in which information related to the functional state of the tissue is provided. Particularly important functional states to be indicated to the surgeon is the perfusion or the oxygenation of the tissue. Functional images in a broader sense may also comprise images providing information about functional states derived from the functional parameters, for example a metabolic state, or other properties of the tissue derived from such functional parameters, such as cancerous tissue, in particular cancerous lymph node tissue, and in particular the discrimination between benign and malign tumor more tissue. The corresponding information is generally referred to as \u201ctissue parameter\u201d herein.",
                        "Oxygen saturation, here also referred to as oxygenation, denotes the fraction of oxygen saturated hemoglobin relative to the total hemoglobin. Since oxygen saturated hemoglobin and oxygen un-saturated hemoglobin have different light absorption properties depending on wavelength, oxygenation can in principle be determined by multispectral imaging.",
                        "Perfusion can be defined as the volume of blood that flows through the capillaries of a certain tissue or organ in an interval of time. The stopping or reduction in perfusion is known as \u201cischemia\u201d and can lead to irreversible damage. Depending on the organ, this damage will occur within minutes to hours. The damage is caused by the imbalance between supply and demand, since cells still consume oxygen and other nutrients, but no new oxygenated blood is arriving. Because of reduced oxygenation and the lower amount of blood in ischemia, multispectral imaging has potential to characterize perfusion as well.",
                        "Ischemia can be prompted by several reasons. In some situations, it may be caused by a physician voluntarily. An example for this is partial nephrectomy, where a kidney tumor is surgically removed. To reduce bleeding during the resection, ischemia can be induced by clamping the supplying hilar vessel. In this case, it would be extremely helpful for the surgeon to resort to functional imaging to estimate the ischemia, both at the beginning of the intervention, to confirm that perfusion has been successfully stopped, as well as after the invention, to confirm that the kidney again receives sufficient blood flow.",
                        "Ischemia can also be an unwanted side effect after surgery. Two prominent examples are organ transplants and anastomosis, i.e. the reconnection of two tubular sections. In this case too, it would be extremely helpful for surgeons to judge the perfusion state during and after the intervention.",
                        "Visualizing perfusion may also be helpful in identifying tumors. Detectable changes related to perfusion can in some cases be attributed to cancer, because important hallmarks of cancer such as hypoxia (deprivation of oxygenated blood) and angiogenesis (formation of new blood vessels) are characterized by changes in oxygenation and blood volume fraction.",
                        "While it is in principle known that oxygenation can be detected using multispectral imaging, known methods suffer from severe drawbacks. One deficiency in existing methods is that they are not able to provide \u201clive\u201d augmented images, i.e. images created in real time at a rate of e.g. 25 Hz or above, such as to give immediate feedback to the surgeon and to avoid motion artefacts or blurring.",
                        "A further deficiency is the lack of precision in the functional information conveyed by the images. Most systems for interventional in vivo multispectral imaging use linear estimation approaches based on the modified Beer-Lambert law, as described in A. Sassaroli and S. Fantini. Comment on the modified Beer-Lambert law for scattering media. PhysMed Biol, 49(14):N255-257 (2004). However, while these methods are fast, they are restricted to estimating oxygenation, but no perfusion, they require small multispectral bandwidths and they also rely on a number of unrealistic assumptions regarding tissue composition that lead to imprecise results. More sophisticated ex vivo tissue analysis methods employ highly accurate Monte Carlo methods for more accurate assessment of physiological parameters.",
                        "The drawback of these methods is that they are too slow for real-time estimation of tissue parameters when dealing with high-resolution multispectral images; they are thus not suited for application during surgery or interventional procedures.",
                        "Finally, known methods for functional imaging using multispectral information require illumination of the tissue under highly specified illumination conditions. So far, it has been difficult to apply this technique under varying lighting conditions, which currently limits the versatility and practical applicability of the method. Varying light conditions may for example occur in an operating room setting, where different light sources with different spectra are simultaneously in use, and where a composition of light on the tissue changes when the patient or one of the light sources is moved."
                    ],
                    "subsections": [],
                    "outline_long": [
                        "introduce augmented imaging",
                        "define tissue parameter",
                        "motivate oxygenation",
                        "motivate perfusion",
                        "limitations of ischemia",
                        "application of ischemia",
                        "limitations of existing methods",
                        "limitations of linear estimation approaches",
                        "limitations of Monte Carlo methods",
                        "limitations of illumination conditions"
                    ],
                    "num_characters": 5434,
                    "outline_medium": [
                        "motivate augmented imaging",
                        "describe tissue parameters",
                        "limitations of existing methods",
                        "application of multispectral imaging",
                        "challenges in real-time estimation"
                    ],
                    "outline_short": [
                        "motivate augmented imaging",
                        "limitations of existing methods"
                    ]
                },
                {
                    "title": "SUMMARY OF THE INVENTION",
                    "paragraphs": [
                        "The problem underlying the invention is to provide a method and a system for functional imaging that overcomes one or more of the above-mentioned deficiencies. This problem is solved by a method according to claim 1 and a system according to claim 34. Preferred embodiments are defined in the dependent claims.",
                        "According to one aspect of the invention, a method of generating one or more augmented images of tissue of a patient undergoing open surgery is provided, wherein each augmented image associates at least one tissue parameter with a region or pixel of the image of the tissue. The method comprising the following steps:",
                        "estimating a spectral composition of light illuminating a region of interest of the tissue,",
                        "obtaining one or more multispectral images of the region of interest, and",
                        "applying a machine learning based regressor or classifier to the one or more multispectral images, or to an image derived from said multispectral image, to thereby derive one or more tissue parameters associated with image regions or pixels of the corresponding multispectral image, wherein said regressor or classifier has been trained to predict the one or more tissue parameters from a multispectral image under a given spectral composition of illumination. Note that wherever reference is made to predict one or more tissue parameters from \u201ca multispectral image\u201d, it is understood that the tissue parameter can also be predicted or derived based on a plurality of images, in particular a time series of images, also optionally taking in account the time evolution thereof. In other words, wherever applicable, whenever reference is made to deriving a tissue parameter from \u201can image\u201d, it is understood, without further mention, that this could also be derived from a time series of images.",
                        "Herein, the regressor or classifier is applied either to the multispectral image itself, or to a processed version thereof, which is referred to as an \u201cimage derived from said multispectral image\u201d in the present disclosure. For simplicity, in the following, this distinction is not explicitly made, i.e. whenever reference is made to a regressor or classifier being applied to the \u201cmultispectral image\u201d, it is to be understood that it is applied either to the multispectral image itself or an image derived therefrom, for example a multispectral image that has been subjected to some sort of segmentation or the like.",
                        "Depending on the type of tissue parameter, the method may employ a regressor, which allows for determining tissue parameters from a continuous range, such as an oxygenation value, or a classifier, which could represent for example the recognition of one of a predetermined set of organs to be recognized with the help of the multispectral images. In the following, sometimes reference will be made to a \u201cregressor\u201d only for brevity, but it is to be understood that where applicable, depending on the type of tissue parameter, the respective disclosure also applies to a classifier, without further mention.",
                        "In the present invention, the regressor or classifier employed is made to match the estimated spectral composition of light illuminating said region of interest of the tissue by one of three possible variants.",
                        "According to a first variant, the regressor or classifier is selected among a plurality of regressors or classifiers that have been previously trained for different training illuminations, such that the spectral composition of the training illumination is the most similar to the estimated spectral composition of said light illuminating said region of interest.",
                        "According to a second variant, the obtained multispectral image is transformed based on information derived from the estimated spectral composition of the light illuminating said region of interest, and a standard regressor or classifier is applied to the transformed multispectral image, which has been trained under a standard illumination, wherein the transformation is capable of compensating a change in the multispectral image due to a deviation in the spectral composition of the illumination from the standard illumination.",
                        "Finally, in a third variant, an already trained regressor or classifier may be retrained using simulation data that is adapted to the estimated spectral composition of light illuminating said region of interest. Namely, according to preferred embodiments of the invention, the data used for training is obtained by means of simulation in a way described in more detail below, and in this simulated data, some assumption about the spectral composition of the illumination light is made. The estimated spectral composition of the light will generally deviate from the illumination spectrum used in the simulation of training data, but the simulated training data can be adapted to account for this deviation. Based on this adapted simulation data, the regressor or classifier that was previously trained based on a different illumination spectrum can be retrained, such as to provide correct tissue parameters from images with the deviating illumination. The inventors have observed that using efficient ways of retraining, based on so-called transfer learning, this retraining can be carried out in surprisingly short timeframes, which may be acceptable for some practical applications. However, this third variant is still much more time-consuming to carry out than the first two variants, which for this reason are currently preferred.",
                        "Accordingly, in all three variants, a suitable regressor or classifier can be applied to the multispectral image, in spite of the fact that the illumination of the tissue in the region of interest may not be known in advance, or can even change over time. This makes the MSI-based augmented imaging suitable for applications in open surgery, where the lighting conditions in the region of interest will typically vary.",
                        "Note that in particularly preferred embodiment, two or even all three of these variants can be combined, such that an ensemble of regressors/classifiers is obtained, which can be applied to the multispectral image, and the tissue parameters to be actually used in the augmented image can e.g. be selected from or calculated from the tissue parameters derived based on the individual regressors/classifiers.",
                        "While reference is made herein to one region of interest, it is to be understood that there could be plural regions of interest.",
                        "In the present disclosure, both the term \u201caugmented imaging\u201d as well as the term \u201ctissue parameter\u201d have a broad meaning. Augmented images are understood herein as images providing information in addition to the image itself, and this information is represented by a tissue parameter. Herein, the term \u201cimage\u201d merely expresses the fact that the tissue parameter is associated with a pixel or with a certain region within the multispectral image, but it does not imply that the tissue parameters must be presented to the user as a \u201cvisual image\u201d.",
                        "One example for such additional information is functional information characterizing the functional state of the tissue. Accordingly, one variant of \u201caugmented images\u201d could be referred to as \u201cfunctional images\u201d, and the corresponding \u201ctissue parameter\u201d would then be a \u201cfunctional parameter\u201d. Examples for such \u201cfunctional parameters\u201d are e.g. the oxygenation or blood volume fraction mentioned in the background section of the application above. Augmented images according to the invention may also provide physiological information, for example a presence or concentration of lipids, or a presence or concentration of melanine, and in this case, the \u201ctissue parameter\u201d could be a \u201cphysiological parameter\u201d. These functional or physiological parameters may be associated with individual pixels of the multispectral image, where a pixel could however correspond to a \u201cmultispectral pixel\u201d comprised of a group of of sensor pixels configured for measuring an intensity of received light in a corresponding spectral range, as will be described below in more detail with reference to a specific embodiment. However, these functional or physiological parameters could likewise be associated with certain regions within the multispectral image, wherein said region may consist of a plurality of multispectral pixels. An example of such regions is a so-called \u201csuperpixel\u201d described below. Accordingly, in preferred embodiments, said at least one tissue parameter comprises one or more of the following: an oxygenation, a blood volume fraction, a presence or concentration of lipids, a presence or concentration of melanine, a presence or concentration of bile, a presence or density of collagen or elastin, a presence or concentration of water, a presence of artificial dyes, in particular methylene blue or a parameter derived from any or any combination thereof.",
                        "However, the \u201ctissue parameter\u201d may alternatively comprise a tissue classification parameter, representing e.g. morphological information. For example, the tissue classification parameter could designate one out of various organs to be identified in the multispectral image, designate necrotic tissue, designate cancerous tissue, in particular cancerous lymph node tissue, and/or the stage thereof (benign or malign), or designate polyps. In cases where the tissue parameter represents morphological information, the tissue parameter will typically not be associated with individual pixels, but with certain regions within the multispectral image, for example a region corresponding to a given organ identified within the image by means of a suitable classifier. In these examples, applying the machine learning based classifier to the multispectral image may include a step of segmenting the image according to morphological features to be recognized, such as organs or the like. The segmentation may be an inherent step carried out when the classifier is applied to the multispectral image.",
                        "In some embodiments, the tissue parameter may be a parameter designating different materials and/or tooth decay in dental applications.",
                        "In other embodiments, the tissue parameter may be a landmark-indicating-parameter designating key landmarks, in particular nerves or important vessels, which may assist a surgeon in avoiding to inadvertently injuring the same. Providing such landmark-indicating-parameter associated with pixels of regions within the multispectral image is again a type of morphological imaging, and could involve a step of segmenting the image.",
                        "In some embodiments, the additional information in the augmented image may represent an event, for example bleeding, tissue inflammation or the presence of smoke, which would call for immediate action. For example, if smoke is detected in an endoscopic application, this could trigger an automatic ventilation to remove the smoke for clearer vision. Accordingly, the tissue parameter may be an event parameter indicating the presence of bleeding, or a parameter indicating the presence of smoke.",
                        "In some embodiments, tissue parameter may be a neurological parameter representing sensory evoked potentials. The inventors have discovered that sensory evoked potentials may lead to chemical/biological process in brain tissue that can be detected by multispectral images.",
                        "Finally, in some embodiments, the tissue parameter may be a prediction-of-event parameter, predicting a medical event, for example a kidney failure. Note that with regard to the cases where the tissue parameter represents an event or the prediction of an event, the tissue parameter may be associated with the entire multispectral image, which would be a special case of the \u201cimage region\u201d with which the tissue parameter is associated.",
                        "In the present disclosure, the step of estimating the spectral composition of illuminating light has a broad meaning, and covers any conceivable way by which the spectral composition can be determined. The typical situation in open treatment, in particular open surgery, is that there is some light for illuminating the patient in the operating room, which is beyond control of the system disclosed herein, and this composition is to be estimated, typically by some type of measurement. In the alternative, there could be embodiments where the spectrum of illumination light is actively controlled, for example by controlling intensities of different light sources with different spectra, or by applying selected filters or the like. In cases like this, the step of \u201cestimating a spectral composition of illuminating light\u201d could amount to computing the spectral composition based on the control parameters determining the spectral composition, i.e. without actually having to measure the spectrum. However, in this case too, it is important to match the regressor or regressors used to the illumination spectrum currently employed, in a manner described above.",
                        "In a preferred embodiment, said step of estimating a spectral composition of illuminating light is based on light that is specularly reflected from said region of interest of the tissue, or from a region close to said region of interest of the tissue. This allows for obtaining the spectral composition of the light that is actually used for illuminating the region of interest, obtained at the region of interest. Note that due to the sterility requirement at the region of interest, it would be difficult or even impossible to use a white balance standard or the like.",
                        "These difficulties can be avoided by basing the spectral composition estimate on specularly reflected light. Moreover, while it is preferred that the estimation of the spectral composition of illuminating light is based on light that is specularly reflected from said region of interest of the tissue itself, it is also possible to rely on light that is specularly reflected from a region that is only \u201cclose\u201d to said region of interest. Herein, \u201cclose to\u201d means sufficiently close that it can be reasonably assumed that the spectral composition of the light is the same or practically the same as at the region of interest. In practice, this could for example mean less than 50 cm, preferably less than 30 cm away from said region of interest.",
                        "In a preferred embodiment, the method further comprises a step of identifying regions of specular reflection within a multispectral image of said region of interest of the tissue, or a region close to said region of interest of the tissue. In some embodiments, said method further comprises a step of transforming said multispectral image to a lower dimensional color space, in particular HSI (hue, saturation, intensity) color space. The HSI color space is particularly suitable for determining specular image regions, as it separates color from intensity and saturation.",
                        "In a preferred embodiment, the method further comprises a step of sorting regions of specular reflection according to size. Some of the spectral regions may be formed by single pixels or a region of few adjacent pixels only, which tend to be outliers and not suitable for reliably estimating the illumination light source spectrum. Accordingly, particularly small specular regions should be discarded. On the other hand, in practice it is found that the largest connected region within the segmented image is often in reality formed by the effusive background, and should therefore likewise be discarded. Accordingly, in a preferred embodiment, the first to n-th largest connected regions of specular pixels are determined, wherein the largest connected region of specular pixels is typically the second largest connected region within the segmented image.",
                        "In a preferred embodiment, the method further comprises a step of subjecting identified regions of specular reflection to morphologic dilation to thereby ensure that they include a predetermined number or percentage of non-saturated pixels. In practice, it is seen that specular regions may contain values, which do not give useful information regarding the spectrum, because part of the spectrum is truncated by the saturation of the corresponding pixel sensor element. However, it can be assumed that in the neighborhood of a spectral region, diffusing specular components are mixed, and using morphologic dilatation, these neighborhoods can be incorporated into the region of specular reflection, to thereby decrease the fraction of saturated/overexposed pixels. By applying morphologic dilation, the general shape of the specular region may be maintained.",
                        "Preferably, the method further comprises the step of separating, within an identified region of specular reflection within the multispectral image, contributions from specular reflection from contributions from diffused reflection. Namely, in practice, what is identified as \u201cspecular regions\u201d will always contain some degree of diffused reflection, which, unlike specular reflection, does not exhibit the same spectral composition as the illumination light. Accordingly, in preferred embodiments, the contributions from specular and diffused reflection are separated, such that the estimate of the spectral composition is based on the truly specular component only. In a preferred embodiment, the separation is done using a blind source separation method, such as principal component analysis (PCA) or independent component analysis (ICA), as explained in more detail below. In alternative embodiments, however, the separation may e.g. be carried out based on multiple linear regression.",
                        "For estimating said spectral composition of the illuminating light, in a preferred embodiment, multispectral images of said region of interest are recorded with a lower exposure than the multispectral images to which said regressor or classifier is applied. The inventors have noticed that using lower exposures than those that are optimum for recording the multispectral images for deriving tissue parameters, the spectral composition of the illuminating light source can be determined based on specular highlights with particularly high precision. Herein, the lower exposure multispectral images may e.g. be recorded with a lower exposure time and/or with a smaller aperture opening than the multispectral images to which said regressor or classifier is applied. In preferred embodiments, the exposure time and/or aperture size is chosen such that the intensity is decreased by at least 20%, preferably by at least 40%, and most preferably by at least 60% as compared to the intensity obtained for the exposure used for recording the functional images, i.e. the multispectral image to which said regressor or classifier is applied.",
                        "In a preferred embodiment, said spectral composition is estimated based on a selected number of pixels or pixel groups, wherein said pixels or pixel groups are selected from said lower exposure image according to a selection criterion ensuring that the pixel or pixel group has a high, and in particular a highest possible lightness, under the provision that the image detector used for recording the image is not saturated for any of the spectral components of the pixel or pixel group. Herein, the \u201clightness\u201d is a measure for the average intensity of the pixel or pixel group over all of its spectral components. In this embodiment, a \u201cselection criterion\u201d is used which fulfils two functions. First of all, it ensures that only unsaturated pixels are considered for the spectral composition estimation. Namely, even if lower exposures are used, there may be pixels for which at least some color channels of the corresponding detector are saturated, thereby cutting off part of the spectral intensity and thereby failing to truly represent the actual light spectrum. This is also referred to as \u201cspecular highlight segmentation\u201d herein. The specular highlight segmentation may also comprise a step of sorting out pixels having too low intensities, for example intensities only resembling the dark current, since these pixels will not qualify for the spectral composition estimation anyhow, and can be dismissed to reduce the size of pixels or pixel groups to consider in the selection. The second function is to select among the remaining pixels those pixels or pixel groups that have particularly high lightness, because such high lightness is indicative of specular reflection. For example, in one embodiment, the pixels associated with the NP highest lightness values can be selected among the \u201cvalid pixels\u201d, i.e. those that were not discarded in a specular highlight segmentation. A suitable value for NP can be determined empirically, in preferred embodiments, it may be between 50 and 250, preferably between 80 and 170. However, this is just one exemplary selection criterion, and any selection criterion that allows for discarding saturated pixels and for choosing pixels with high lightness, i.e. specular highlights, may be used.",
                        "This embodiment can be implemented very efficiently, with moderate computational and structural effort, as will become apparent from the description of a specific example below, and at the same time allows for a very precise estimation of the spectral composition of the illumination, thereby allowing to reliably predict tissue parameters under various and possibly varying illumination conditions.",
                        "In a preferred embodiment, said multispectral image comprises a number of k color channels, and the method further comprises a step of transforming the spectral information from said k color channels, or a subset thereof, to a quasi-continuous spectrum. Obtaining a quasi-continuous spectrum is particularly helpful for the second variant of the invention, in which the obtained multispectral image is transformed\u2014based on information derived from the estimated spectral composition of the light illuminating said region of interest\u2014for use with a standard regressor or classifier. For this variant, a transformation is needed which is capable of compensating a change in the multispectral image due to a deviation in the spectral composition of the illumination from the standard illumination. This transformation can be best determined if a continuous or at least quasi-continuous spectrum of the actual illumination light is available. In a preferred embodiment, the wavelengths within said quasi-continuous spectrum are preferably separated by no more than 10 nm, preferably by no more than 5 nm and most preferably by no more than 3 nm.",
                        "In a preferred embodiment, the one or more augmented images is a series of augmented images generated consecutively at a rate of 25 Hz or above, preferably at a rate of 75 Hz or above. According to this embodiment, the augmented images can be obtained at what could be considered a \u201cvideo rate\u201d, allowing for immediate feedback to the surgeon. Moreover, such video rate imaging can keep up with motion of the tissue occurring inevitably during surgery and reduce or avoid blurring of the augmented image.",
                        "In a preferred embodiment, the multispectral images are obtained using a multispectral sensor, said multispectral sensor comprising multispectral pixels, wherein each multispectral pixel comprises a group of sensor pixels configured for measuring an intensity of received light in a corresponding spectral range, thereby permitting to obtain a multispectral image in a single shot. Using such a multispectral sensor allows for higher imaging speeds as compared for example to a prior art embodiment employing a filter wheel, and also ensures that the various components of the spectrum are recorded precisely at the same point in time, i.e. avoiding any movement of the tissue between the recording of different image components, as can occur when using a filter wheel. Moreover, employing such a multispectral sensor allows for small and lightweight devices which are economically preferable over a device comprising a filter wheel. In a preferred embodiment, each multispectral pixel comprises a group of 3\u00d73 or 4\u00d74 sensor pixels.",
                        "In a preferred embodiment, said regressor or classifier is based on a convolutional neural network (CNN). The inventors have confirmed that CNN allows for very rapid calculation of the tissue parameters with moderate hardware expense, which is particularly important for embodiments employing video rate imaging. Moreover, CNN allow for an end-to-end processing of the spectral images and have shown to give very accurate results.",
                        "In order to obtain one or more tissue parameters associated with an image region or pixel of the corresponding multispectral image, in a preferred embodiment, said regressor or classifier is applied to a neighborhood covering more than said image region or pixel of said multispectral image. In this embodiment, it is exploited that CNNs provide the possibility to incorporate regions with a spatial extent into the estimation process. In this embodiment, the system can base functional estimation (or the determination of other tissue parameters) not only on one spectral measurement, i.e. one \u201cimage region\u201d or \u201cpixel\u201d of the multispectral image, but on a neighborhood. In case of homogeneous tissue, moving from one (noisy) spectral measurement to an area is advantageous because this provides multiple (noisy) measurements to base further reasoning on.",
                        "In a preferred embodiment, said image region or pixel of the multispectral image is formed by a multispectral pixel of a multispectral sensor, wherein each multispectral pixel of said sensor comprises a group of sensor pixels configured for measuring an intensity of received light in a corresponding spectral range, and wherein said neighborhood to which the regressor or classifier is applied corresponds to a number of adjacent multispectral pixels of said multispectral sensor.",
                        "In a preferred embodiment, said regressor or classifier devised for applying to said neighborhood is trained using a simulated neighborhood, which is derived from copies of a simulated image region or pixel collectively covering said neighborhood, wherein said copies are subjected to individual noise and/or modifications accounting for tissue inhomogeneities.",
                        "In a preferred embodiment, said multispectral image comprises a number of k color channels, wherein said step of applying the regressor or classifier to the multispectral image comprises inputting k reflectance values obtained from the color channels of the multispectral image to the regressor or classifier. Herein, said reflectance values may be obtained from light sensor readings by subtracting a dark image recorded in complete darkness from the multispectral image, and preferably further normalizing the image by the difference of a white image obtained or obtainable from a standard white target and the dark image.",
                        "In a preferred embodiment, the method further comprises a step of deriving an RGB image from the multispectral image. The RGB image can be helpful for surgeon recognizing the region of interest on a display. In particular, in this embodiment it is not necessary to provide for an additional RGB imaging sensor.",
                        "In a preferred embodiment, said regressor or classifier is trained based on a forward model, which comprises a tissue model, a simulation of spectral reflectance that is characteristic for tissue modelled by said tissue model, and an adaption of said spectral reflectance to an imaging system which is used for recording the multispectral images. Herein, the simulation is preferably a Monte Carlo simulation, which gives the most accurate results.",
                        "Herein, said tissue model is preferably a layered tissue model comprising a plurality of layers, wherein each layer is characterized by a set of optically relevant tissue parameters, wherein said optically relevant tissue parameters preferably comprise a blood volume fraction, an oxygenation, the presence of a tumor, the presence or concentration of fat, the presence or concentration of melanine, the presence or concentration of bile, the presence or density of collagen or elastin, the presence or concentration of water, or the presence of artificial dyes, in particular methylene blue.",
                        "Said set of optically relevant tissue parameters preferably comprises one or more of a parameter quantifying an amount of scattering, a scattering power, which characterizes an exponential wavelength dependence of scattering, an anisotropy factor characterizing a directionality of scattering, a refractive index, and a layer thickness.",
                        "In a preferred embodiment, said adaption of said spectral reflectance to the imaging system comprises calculating, from the spectral reflectance of the modelled tissue, an estimate of an intensity associated with each color channel of said imaging system.",
                        "In a preferred embodiment, said calculating of said estimate of intensity associated with each color channel is based on one or more of a quantum efficiency of a camera or optical sensor used, information about the spectral composition of the illumination light, transmittance of optical components used, such as spectral filters, a nonlinear camera response function, and camera noise for each color channel.",
                        "In a preferred embodiment, for a given task, among a plurality of simulations, a subset of simulations are selected by comparison with measurement on real tissue, wherein the subset of simulations match the measurements better than the remainder of the simulations.",
                        "Generally, the training of the regressor or classifier is carried out based on simulated tissue data, because it can be generated in large amounts, allowing for a thorough training of the machine learning regressor/classifier. In contrast to this, obtaining reliable training data from measurements on actual tissue is by far more involved and hence limited in practice. In view of this, some of the present inventors have recently proposed a method called \u201cdomain adaption\u201d which is particularly useful in the framework of the present invention, cf. S. J. Wirkert, A. S. Vemuri, H. G. Kenngott, S. Moccia, M. G\u00f6tz, B. F. B. Mayer, K. H. Maier-Hein, D. S. Elson, and L. Maier-Hein. Physiological Parameter Estimation from Multispectral Images Unleashed. In Medical Image Computing and Computer-Assisted Intervention\u2014MICCAI 2017, Lecture Notes in Computer Science, pages 134-141. Springer, Cham (2017). ISBN 978-3-319-66178-0 978-3-319-66179-7. Namely, if the regressor/classifier is intended for a given task, its performance can be improved if the training is carried out only on a subset of simulations which are selected based on a comparison with measurements on real tissue for this task, namely those simulations that match the actual measurements to some predetermined degree. This way, it can be ensured that the training data is indeed relevant for the real tissue to be analyzed.",
                        "In preferred embodiments, plural regressors or classifiers are applied to the one or more multispectral images, leading to plural results for possible tissue parameters, and the tissue parameters associated with the region or pixel of the image of the tissue is obtained by combining or selecting from said possible tissue parameters.",
                        "In preferred embodiments, said machine learning based regressor or classifier is suitable for providing a confidence value together with said prediction of said one or more tissue parameters, indicating a measure of confidence in the accuracy of the one or more tissue parameters.",
                        "In case the confidence value fails to meet a predefined confidence criterion, the method may comprise one or more of the following:",
                        "the tissue parameters are not visualised in the augmented image,",
                        "the tissue parameters are visualized in the augmented image, but together with an indication of the confidence,",
                        "tissue parameters to be used in the augmented imaging are derived by a selection or a combination of values from one of\n\n\n- - different regions within the same image,\n  - same regions within different multispectral images of the same\n    tissue obtained with different imaging setups, in particular with a\n    different illumination spectrum and/or with different bands selected\n    for the multispectral imaging, and\n  - same regions within the same multispectral to which different\n    regressors or classifiers are applied.",
                        "Further, tissue parameters to be used in the functional imaging can be combined for example by forming an average value over a time series of images, or an average value within an image or a part of the image.",
                        "In other words, instead of a single regressor/classifier, an ensemble of regressors/classifiers may be applied to the same multispectral image. Herein, the above-mentioned \u201ccombination of values\u201d may be an uncertainty-based aggregation of values, e.g. a weighted mean of inferred values taken from a region of interest, or the like.",
                        "In preferred embodiments, said regressor or classifier is capable of deriving a probabilistic distribution of possible tissue parameters. Note that traditional machine learning methods generate a single \u201chypothesis\u201d given a measurement, e.g. one plausible tissue parameter configuration given a measured spectrum. However, in a preferred embodiment, the machine learning algorithm is directed to deriving multiple \u201cplausible hypotheses\u201d instead, i.e. a probability distribution of possible tissue parameters. Herein, the term \u201cdistribution\u201d has a broad meaning, and does not imply any lower boundary on the number of different possible tissue parameters. More detailed description on the underlying methology is described in Simon A. A. Kohl, Bernardino Romera-Paredes, Clemens Meyer, Jeffrey De Fauw, Joseph R. Ledsam, Klaus H. Maier-Hein, S. M. Ali Eslami, Danilo Jimenez Rezende, Qlaf Ronneberger A Probabilistic U-Net for Segmentation of Ambiguous Images, 2018, arXiv:1806.050034v1. However, other probabilistic approaches, e.g. approximate Bayesian computation may be used to tackle inverse problems, whose forward process is well-understood. In such embodiments too, a distribution of plausible parameter configurations (rather than one single estimate) is outputted for a given spectrum. If the distribution is uni-modal (and not too broad), the inversion of the acquired spectrum can be regarded a well-posed problem. Otherwise, the problem is ambiguous and the different modes of the distribution are outputted as alternative hypotheses, or in other words, \u201cmultiple plausible solutions\u201d.",
                        "In case said probability distribution of possible tissue parameters exhibits plural modes and/or is broader than a predetermined threshold, in preferred embodiments, at least one new multispectral image is generated with a different imaging set up, in particular with a different illumination spectrum and/or different bands selected for the multispectral imaging.",
                        "It is generally believed that for obtaining meaningful tissue parameters from multispectral images, a large number of bands are needed. Generally, \u201cmultispectral images\u201d are understood to be images having more than three wavelength bands, usually much more than three wavelength bands, and at least a few wavelength bands different from the ordinary three wavelengths used for RGB imaging. While a large number of wavelength bands assists in the derivation of tissue parameters, this usually comes at the price of reduced imaging speed (if the wavelength bands are recorded sequentially) or a reduced spatial resolution (if large number of sensor pixels for a correspondingly large number wavelength bands have to be placed next to each other on the image sensor), or both. However, the inventors have determined that for the particular application of oxygenation estimation, very accurate results can be obtained when using a surprisingly small number of wavelength bands, if these bands are properly chosen. The novel method how to determine these most suitable wavelength bands is described in more detail below. Accordingly, in a preferred embodiment, said tissue parameter is related to oxygenation or blood volume fraction, and said multispectral image comprises at least three, preferably at least four spectral components whose center wavelengths fall into one of the following wavelength intervals: 495-505 nm, 535-545 nm, 550-570 nm, 575-585 nm, and 590-610 nm.",
                        "If all five wavelength bands are employed in the multispectral imaging, oxygenation results with excellent accuracy can be obtained. Further analysis of the inventors revealed that in fact any combination of 4 out of the 5 proposed bands would give excellent results for oxygenation estimation. This allows e.g. for designing a multispectral sensor where each multispectral pixel is formed by 2\u00d72 single color pixel sensors, detecting light in corresponding four out of the above five bands. Surprisingly, the inventors could confirm that good oxygenation estimates can even be obtained when only three of the above five wavelengths are chosen. This allows for an even higher resolution, if the multispectral image sensor comprises only three single color pixel sensors. This image would still be regarded as \u201cmultispectral\u201d in the framework of the present disclosure, because these wavelength bands are different from the bands used for RGB imaging. Moreover, in the multispectral image sensor, three types of single color pixel sensors located in respective three out of the above five bands could be combined with pixel sensors detecting light within different bands that are provided for other imaging purposes",
                        "In a preferred embodiment, said augmented image is projected into the field of vision of goggles to be worn by a surgeon.",
                        "Herein, said goggles preferably further comprise one or more of the following components: a multispectral camera suitable for obtaining said one or more multispectral images of the region of interest, a microphone for receiving speech commands, a wireless data link for exchanging data with a computing device or a database, and a data processing unit suitable for one or more of applying said regressor or classifier to said multispectral image, recognizing gestures, particularly gestures indicating regions of interest for which augmented images are to be created, and controlling the display of augmented images in the field of view of the glasses, particularly in a way that the augmented image is overlaid with the actual scenery seen through the goggles.",
                        "In the previous embodiments, it has been shown how machine learning algorithms can be used to convert pixel-wise multispectral reflectance measurement to tissue parameters.",
                        "However, the accuracy of these algorithms can only be guaranteed if the multispectral images match the ones that have been seen by the machine learning algorithm during its training. In a preferred embodiment, the method further comprises a step of out of distribution detection (OoD), wherein said OoD detection comprises a step of determining information about the closeness of the multispectral image or parts of said multispectral image to a given training data set. By means of the OoD detection, it can be prevented that the machine learning algorithms present spurious results for tissue parameters caused by a lack of training on the tissue represented by the multispectral image.",
                        "In a preferred embodiment, said OoD detection is carried out using an OoD detection algorithm configured for assigning a numerical closeness value to multispectral information associated with said multispectral image or parts thereof, in particular associated with individual pixels or pixel groups. Herein, the multispectral information could for example be the spectrum determined for a certain pixel, but it could also be a quantity that is derived from said spectrum. Moreover, the multispectral information may be associated with single pixels, or groups of pixels, within an image, without accounting for interrelations between the spectra of individual pixels or individual pixel groups. However, in some embodiments, the OoD detection may be carried out on the full multispectral image or at least on regions thereof. Herein, the numerical value indicates the closeness of said spectral information to the corresponding spectral information in said given training data set.",
                        "There are various possibilities to assign a closeness of a sample to an underlying dataset, and the OoD detection of the invention is not limited to any specific one of them. However, in a preferred embodiment, said OoD detection algorithm comprises an ensemble of neural networks, and in particular invertible neural networks (INN). Each of said neural networks of the ensemble has been trained, on said given training data set, to transform a training data sample to a transformed data sample, such that the transformed training data matches a predetermined statistical distribution. Moreover, said OoD detection algorithm is configured to determine the numerical closeness value for a data sample by\n\n\n- - transforming said data sample with each neural network of said\n    ensemble of neural networks to obtain an ensemble of transformed\n    data samples, and\n  - determining said numerical closeness value as a measure indicative\n    of the variance of said ensemble of transformed data sets.",
                        "Note that the neural networks of the ensemble are per se unrelated to any machine learning based classifier or regressor that is eventually to be used for determining functional parameters, except that it is trained using the same training data. Namely, the neural networks of the ensemble are not intended for predicting any biologically or medically meaningful parameters, but are instead simply trained to map a distribution of data samples to said predetermined statistical distribution, and are only used for this OoD analysis. The rationale behind this approach is that for a data sample that is close to those that have been considered during training, the neural networks of said ensemble will typically transform the data samples to transformed data samples which are similar to each other, and hence leading to a smaller variance, while this cannot be expected for data samples that are very different from anything the ensemble of neural networks have seen in their training.",
                        "In a preferred embodiment, said OoD detection algorithm uses the \u201cwidely applicable information criterion\u201d (WAIC) to determine said numerical closeness value. References for the use of the WAIC in the literature are given in the more detailed description thereof below.",
                        "Herein, the WAIC, or a value derived therefrom, may be used as said numerical closeness value. The WAIC is defined as",
                        "WAIC(x)=Var\u0398[log p(x|\u0398)]\u2212E\u0398[log p(x|\u0398)],",
                        "wherein x is a data sample, \u0398 are the parameters of the neural networks of said ensemble of neural networks, log p(x|\u0398) corresponds to said predetermined statistical distribution, and E\u0398 [log p(x|\u0398)] is an expectation term used for normalization purposes.",
                        "In a preferred embodiment, said predetermined distribution is a multivariate standard Gaussian defined as",
                        "log p(x|\u0398)=\u2212\u00bd\u2225f\u0398(x)\u22252\u2212n/2 log(2\u03c0)+log|det Jf\u0398(x)|,",
                        "where f\u0398 represents a network of said ensemble of neural networks with corresponding network parameters \u0398, x is a data sample and Jf\u0398 denotes the Jacobian of the distribution. Note that the multivariate standard Gaussian just one example of a statistical distribution, that is attractive for computational purpose, but that other statistical solutions may likewise be used.",
                        "Moreover, note that other approaches to OoD detection may likewise be employed in the context of the present invention. In a preferred embodiment, the OoD detection algorithm is based on a variational autoencoder, as described in An, J., & Cho, S. (2015). Variational autoencoder based anomaly detection using reconstruction probability. Special Lecture on IE, 2(1). Simply put, an autoencoder is a neural network that is trained by unsupervised learning, and which is trained to learn reconstructions that are close to its original input. An autoencoder is composed of two parts, an encoder and a decoder. Autoencoder based anomaly detection is a deviation based anomaly detection method using semi-supervised learning. It uses the reconstruction error as the anomaly score. Data points with high reconstruction error are considered to be anomalies. Only data with normal instances are used to train the autoencoder. After training, the autoencoder will reconstruct normal data very well, while failing to do so with anomaly data which the autoencoder has not encountered. While simply speaking, a plain autoencoder only transforms features to a latent space and back, by looking at the reconstruction from the variational autoencoder it is possible to identify specific regions that are \u201cabnormal\u201d in cases where one trains on whole images, which may be particularly helpful.",
                        "Prior to or along with applying a regressor or classifier that has been trained with a given training data set, in preferred embodiments, said OoD detection is carried out to determine the closeness of the multispectral image or part of said multispectral image to said given training data set, or to a related training data set, and if the closeness is found to be insufficient, the functional tissue parameter is not determined or is marked as unreliable. This way, it can be avoided that tissue parameters are generated that cannot be relied on due to lack of relevant training. In case the closeness is found to be insufficient, in a related embodiment, it may be further checked whether the closeness with a training dataset associated with another regressor or classifier is better, and given the case, said another regressor or classifier may be applied to said multispectral image or parts of said multispectral image. In other words, in this embodiment, the OoD detection does not only allow for noticing situations where a given regressor or classifier may fail to make reliable predictions due to lack of relevant training for the multispectral images at hand, but also for identifying a regressor or classifier with more appropriate training. In particularly preferred embodiments, the training dataset associated with said another regressor or classifier corresponds to different illumination conditions. Indeed, changing illumination conditions, which may for example arise when a given light source in an operating room is switched on or off, or is moved closer to or further away from the site of intervention, are a scenario where the OoD detection is of particular value, to avoid that changing illumination conditions, such as different spectral compositions provided by different light sources, lead to errors in the prediction of tissue parameters. In other embodiments, the training dataset associated with said another regressor or classifier corresponds to a different tissue type. This way, it can be ensured that the most appropriate regressor or classifier is used for various tissue types. Note that this way, it is also possible to choose suitable regressors or classifiers for different parts of the multispectral image. This may be particularly important if there are different illumination conditions in different parts of the image, for example to different mixtures of contributions from different light sources, or if there there are different tissue types in the same image.",
                        "Note that one practical implementation would be to use the exact same training data for the OOD algorithm (i.e. the training data on which the ensemble of neural networks is trained) on the one hand, and the corresponding regressor or classifier on the other hand. However, this is not necessary, as long as the OOD algorithm and the regressor/classifier have been trained on similar training data, which was referred to as a \u201crelated dataset\u201d above. Similar training data could for example be two subsets of a larger set of training data, or training data which are generated in silico by different simulations of the same type of tissue model, or obtained by medical images that show the same medical or biological context, for example the very same type of tissue with the same oxygenation value, or same ranges of oxygenation values. In view of this, said OoD detection need not necessarily be carried out to determine the closeness of the multispectral image or part of said multispectral image to said (same) given training data set, but could be carried out to determine the closeness of the multispectral image to a \u201crelated training data\u201d, as was specified above.",
                        "Prior to applying a regressor or classifier to a multispectral image or part thereof, a preferred embodiment comprises a step of using the OoD detection for selecting among a plurality of regressors or classifiers, each associated with a corresponding training data set, the regressor or classifier to whose training data the multispectral image or part of said multispectral image is the closest to. The method further comprises applying said selected regressor or classifier to the multispectral image or part thereof. In this embodiment, the OoD detection is used to automatically determine the most appropriate regressor or classifier for the multispectral images at hand. Again, in preferred embodiments, said training datasets associated with said plurality of regressors or classifiers preferably correspond to different illumination conditions, or to different tissue types.",
                        "In a preferred embodiment, said said OoD detection is carried out repeatedly over time, to thereby detect a change in conditions, in particular illumination conditions, by means of a change in closeness of the multispectral image with a given set of training data. This way, changing conditions can be constantly monitored and detected before errors occur. Note that while it can be computationally quite expensive to establish the OoD detection algorithm, for example due to the training of the ensemble of neural networks in the preferred embodiment, applying the OoD detection algorithm is of negligible computational effort, such that it can be carried out continuously or at high frequencies to allow for a close monitoring of a change in conditions.",
                        "A further aspect of the present invention relates to a system for generating one or more augmented images of tissue of a patient undergoing open surgery, wherein each augmented image associates at least one tissue parameter with a region or pixel of the image of the tissue, said system comprising:",
                        "an apparatus for estimating a spectral composition of light illuminating a region of interest of the tissue,",
                        "a multispectral camera for obtaining one or more multispectral images of the region of interest,",
                        "a computing device comprising a machine learning module for applying a machine learning based regressor or classifier to the one or more multispectral images or an image derived from said multispectral image, to thereby derive one or more tissue parameters associated with image regions or pixels of the corresponding multispectral image, wherein said regressor or classifier has been trained to predict the one or more tissue parameters from a multispectral image under a given spectral composition of illumination, wherein the computing device is configured to make the regressor or classifier employed to match the estimated spectral composition of light illuminating said region of interest of the tissue by one of",
                        "selecting the regressor or classifier among a plurality regressors or classifiers that have been previously trained for different training illuminations, such that the spectral composition of the training illumination is the most similar to the estimated spectral composition of said light illuminating said region of interest, or",
                        "transforming the obtained multispectral image based on information derived from the estimated spectral composition of the light illuminating said region of interest and applying a standard regressor or classifier to the transformed multispectral image, which has been trained under a standard illumination, wherein the transformation is capable of compensating a change in the multispectral image due to a deviation in the spectral composition of the illumination from the standard illumination, or",
                        "retraining an already trained regressor or classifier using simulation data that is adapted to the estimated spectral composition of light illuminating said region of interest.",
                        "Herein, said apparatus for estimating a spectral composition can comprise a computing device, which is programmed to obtain an estimate for the spectral composition of the illumination light, for example based on multispectral images obtained using said multispectral camera of the system. The computing device could be a microprocessor, an FPGA or the like. Moreover, the apparatus could also be formed by the same computing device comprising said machine learning module, which in this case further comprises a module for the estimation of spectral composition.",
                        "Preferably, said system further comprises a display device, wherein said system is configured to display said augmented image, wherein said system is in particular configured to display the augmented image together with or in an overlaid fashion with an RGB image of said region of interest.",
                        "In another preferred embodiment, the system comprises goggles, wherein said system is configured to project said augmented image into the field of view of said goggles.",
                        "In a preferred embodiment, said goggles further comprise one or more of the following components:",
                        "a multispectral camera suitable for obtaining said one or more multispectral images of the region of interest,",
                        "a microphone for receiving speech commands,",
                        "a wireless data link for exchanging data with a computing device or a database, and a data processing unit suitable for one or more of applying said regressor or classifier to said multispectral image, recognizing gestures, particularly gestures indicating regions of interest for which augmented images are to be created, and controlling the display of augmented images in the field of view of the glasses, particular in a way that the augmented image is overlaid with the actual scenery seen through the goggles.",
                        "In a preferred embodiment of the system, said at least one tissue parameter comprises one or more of the following: an oxygenation, a blood volume fraction, a presence or concentration of lipids, a presence or concentration of melanine, a presence or concentration of bile, a presence or density of collagen or elastin, a presence or concentration of water, or a presence of artificial dyes, in particular methylene blue, or a parameter derived from any or any combination thereof,",
                        "a tissue classification parameter, in particular a tissue classification parameter designating various organs, designating necrotic tissue, designating cancerous tissue, in particular cancerous lymph node tissue, and/or the stage thereof, or designating polyps,",
                        "a parameter designating different materials and/or tooth decay in dental applications,",
                        "a landmark indicating parameter designating key landmarks, in particular nerves or important vessels;",
                        "an event parameter indicating the presence of bleeding, or a parameter indicating the presence of smoke, a",
                        "a neurological parameter representing sensory evoked potentials, or",
                        "a prediction of event parameter, predicting a medical event.",
                        "In a preferred embodiment, said apparatus for estimating a spectral composition of illuminating light is configured for carrying out said estimation based on light that is specularly reflected from said region of interest of the tissue, or from a region close to said region of interest of the tissue.",
                        "Preferably, said apparatus for estimating spectral composition is configured for identifying regions of specular reflection within a multispectral image of said region of interest of the tissue, obtained with said multispectral camera, or a region close to said region of interest of the tissue.",
                        "Preferably, said apparatus for estimating spectral composition is further configured for transforming said multispectral image to a lower dimensional color space, in particular HSI color space.",
                        "In a preferred embodiment, said apparatus is further configured for sorting regions of specular reflection according to size, wherein preferably, the first to n-th largest connected regions of specular pixels are determined, where n is an integer number that is smaller than the total number of regions of connected specular pixels.",
                        "In a preferred embodiment, said apparatus is further configured for subjecting identified regions of specular reflection to morphologic dilation to thereby ensure that they include a predetermined number or percentage of non-saturated pixels.",
                        "In a preferred embodiment, said apparatus is further configured for separating, within an identified region of specular reflection within the multispectral image, contributions from specular reflection from contributions from diffused reflection, in particular using a principal component analysis or an independent component analysis.",
                        "In a preferred embodiment of the system, for estimating said spectral composition of the illuminating light, the system is preferably configured for recording multispectral images of said region of interest with a lower exposure than the multispectral images to which said regressor or classifier is applied.",
                        "In a preferred embodiment said system is configured for recording said lower exposure multispectral images with a lower exposure time and/or a smaller aperture opening than the multispectral images to which said regressor or classifier is applied, wherein preferably, the exposure time and/or aperture size is set such that the intensity is decreased by at least 20%, preferably by at least 40%, and most preferably by at least 60% with respect to the intensity obtained for the exposure used for recording the multispectral images to which said regressor or classifier is applied.",
                        "In a preferred embodiment, said system is configured for estimating said spectral composition based on a selected number of pixels or pixel groups, wherein said system is configured for selecting said pixels or pixel groups from said lower exposure image according to a selection criterion ensuring that the pixel or pixel group has a high, and in particular a highest possible lightness, under the provision that the image detector used for recording the image is not saturated for any of the spectral components of the pixel or pixel group, wherein the lightness is a measure for the average intensity of the pixel or pixel group over all of its spectral components.",
                        "In a preferred embodiment of the system, said multispectral image comprises a number of k color channels, and wherein the apparatus further configured for transforming the spectral information from said k color channels, or a subset thereof, to a quasi-continuous spectrum, wherein the wavelengths within said quasi-continuous spectrum are preferably separated by no more than 10 nm, preferably by no more than 5 nm and most preferably by no more than 3 nm.",
                        "In preferred embodiments, the one or more augmented images is a series of augmented images generated consecutively at a rate of 25 Hz or above, preferably at a rate of 75 Hz or above.",
                        "In a preferred embodiment of the system, the multispectral camera comprises a multispectral sensor, said multispectral sensor comprising multispectral pixels, wherein each multispectral pixel comprises a group of sensor pixels configured for measuring an intensity of received light in a corresponding spectral range, thereby permitting to obtain a multispectral image in a single shot, wherein preferably, each multispectral pixel comprises a group of 3\u00d73 or 4\u00d74 sensor pixels.",
                        "In a preferred embodiment of the system, said regressor or classifier is based on a convolutional neural network.",
                        "In order to obtain one or more tissue parameters associated with an image region or pixel of the corresponding multispectral image, said machine learning module is preferably configured for applying said regressor or classifier to a neighborhood covering more than said image region or pixel of said multispectral image.",
                        "In a preferred embodiment, said image region or pixel of the multispectral image is formed by a multispectral pixel of a multispectral sensor of said multispectral camera, wherein each multispectral pixel of said sensor comprises a group of sensor pixels configured for measuring an intensity of received light in a corresponding spectral range, and wherein said neighborhood to which the regressor or classifier is applied by said machine learning module corresponds to a number of adjacent multispectral pixels of said multispectral sensor.",
                        "In a preferred embodiment, said regressor or classifier devised for applying to said neighborhood is trained or obtainable by training using a simulated neighborhood, which is derived from copies of a simulated image region or pixel collectively covering said neighborhood, wherein said copies are subjected to individual noise and/or modifications accounting for tissue inhomogeneities.",
                        "In a preferred embodiment, said multispectral image comprises a number of k color channels, wherein said machine learning module is configured for carrying out said step of applying the regressor or classifier to the multispectral image by inputting k reflectance values obtained from the color channels of the multispectral image to the regressor or classifier.",
                        "In a preferred embodiment of the system, said machine learning module is configured for obtaining said reflectance values from readings of said a sensor of said camera by subtracting a dark image recorded in complete darkness from the multispectral image, and preferably further normalizing the image by the difference of a white image obtained or obtainable from a standard white target and the dark image.",
                        "In a preferred embodiment of the system, said machine learning module or a separate module is configured for deriving an RGB image from the multispectral image.",
                        "In a preferred embodiment of the system, said regressor or classifier employed by said machine learning module is trained based on a forward model, which comprises a tissue model, a simulation of spectral reflectance that is characteristic for tissue modelled by said tissue model, and an adaption of said spectral reflectance to an imaging system which is used for recording the multispectral images, wherein said simulation of the spectral reflectance is preferably a Monte Carlo simulation.",
                        "Herein, said tissue model is preferably a layered tissue model comprising a plurality of layers, wherein each layer is characterised by a set of optically relevant tissue parameters, wherein said optically relevant tissue parameters preferably comprises one or more of a blood volume fraction, an oxygenation, the presence of a tumor, the presence or concentration of gall, the presence or concentration of fat, the presence or concentration of melanine, the presence or concentration of bile, the presence or density of collagen or elastin, the presence or concentration of water, or the presence of artificial dyes, in particular methylene blue.",
                        "In addition, said set of optically relevant tissue parameters preferably further comprises one or more of a parameter quantifying an amount of scattering, a scattering power, which characterizes an exponential wavelength dependence of scattering, an anisotropy factor characterizing a directionality of scattering, a refractive index, and a layer thickness.",
                        "In addition or alternatively, said adaption of said spectral reflectance to the imaging system preferably comprises calculating, from the spectral reflectance of the modelled tissue, an estimate of an intensity associated with each color channel of said imaging system.",
                        "Herein, said calculating of said estimate of intensity associated with each color channel is preferably based on one or more of a quantum efficiency of a camera or optical sensor used, information about the spectral composition of the illumination light, transmittance of optical components used, a nonlinear camera response function, and camera noise for each color channel.",
                        "In a preferred embodiment of the system, said regressor or classifier has been trained for a given task, wherein the training was based on a subset of simulations from a larger set of simulations, wherein said subset of simulations was selected by comparison with measurements on real tissue, wherein the subset of simulations matched the measurements better than the remainder of the simulations.",
                        "In a preferred embodiment of the system, said data processing unit is suitable for applying plural regressors or classifiers to the one or more multispectral images, leading to plural results for possible tissue parameters, and for obtaining the tissue parameters associated with the region or pixel of the image of the tissue by combining or selecting from said possible tissue parameters.",
                        "In a preferred embodiment, said machine learning based regressor or classifier is suitable for providing a confidence value together with said prediction of said one or more tissue parameters, indicating a measure of confidence in the accuracy of the one or more tissue parameters.",
                        "Herein, in case the confidence value fails to meet a predefined confidence criterion, the data processing unit is preferably configured to carry out one or more of the following: not visualising the tissue parameters in the augmented image, visualising the tissue parameters in the augmented image, but together with an indication of the confidence, deriving tissue parameters to be used in the augmented imaging by a selection or a combination of values from one of\n\n\n- - different regions within the same image,\n  - same regions within different multispectral images of the same\n    tissue obtained with different imaging setups, in particular with a\n    different illumination spectrum and/or with different bands selected\n    for the multispectral imaging,\n  - same regions within the same multispectral to which different\n    regressors or classifiers are applied.",
                        "In a preferred embodiment of the system, said regressor or classifier is capable of deriving a probabilistic distribution of possible tissue parameters.",
                        "Herein, in case said probability distribution of possible tissue parameters exhibits plural modes and/or is broader than a predetermined threshold, the system is preferably further configured for generating at least one new multispectral image with a different imaging set up, in particular with a different illumination spectrum and/or different bands selected for the multispectral imaging.",
                        "In a preferred embodiment of the system, said tissue parameter is related to oxygenation or blood volume fraction, and wherein said multispectral image comprises at least three, preferably at least four spectral components whose center wavelengths fall into one of the following wavelength intervals: 495-505 nm, 535-545 nm, 550-570 nm, 575-585 nm, and 590-610 nm.",
                        "In a preferred embodiment of the system, said computing device, or an additional computing device associated with the system is configured for carrying out an out of distribution detection (OoD), wherein said OoD detection comprises a step of determining information about the closeness of the multispectral image or parts of said multispectral image to a given training data set. In other words, the OoD detection can be carried out by the same computing device that also comprises said machine learning module, or it can be carried out by another computing device. The another computing device can be formed by one or more microprocessors, which is programmed to carry out the OOD detection.",
                        "In a preferred embodiment, said computing device or additional computing device is configured for carrying out said OoD detection using an OoD detection algorithm configured for assigning a numerical closeness value to multispectral information associated with said multispectral image or parts thereof, in particular associated with individual pixels or pixel groups, said numerical value indicating the closeness of said spectral information to the corresponding spectral information in said given training data set.",
                        "In a preferred embodiment, said OoD detection algorithm comprises an ensemble of neural networks, in particular invertible neural networks (INN), wherein each of said neural networks of the ensemble has been trained, on said given training data set, to transform a training data sample to a transformed data sample, such that the transformed training data matches a predetermined statistical distribution, and wherein said OoD detection algorithm is configured to determine the numerical closeness value for a data sample by\n\n\n- - transforming said data sample with each neural network of said\n    ensemble of neural networks to obtain an ensemble of transformed\n    data samples, and\n  - determining said numerical closeness value as a measure indicative\n    of the variance of said ensemble of transformed data sets.",
                        "In a preferred embodiment, said OoD detection algorithm uses the \u201cwidely applicable information criterion\u201d (WAIC) to determine said numerical closeness value, and wherein in particular, the WAIC, or a value derived therefrom, is used as said numerical closeness value, wherein said WAIC is defined as",
                        "WAIC(x)=Var\u0398[log p(x|\u0398)]\u2212E\u0398[log p(x|\u0398)],",
                        "wherein x is a data sample, \u0398 are the parameters of the neural networks of said ensemble of neural networks, log p(x|\u0398) corresponds to said predetermined statistical distribution, and E\u0398 [log p(x|\u0398)] is an expectation term used for normalization purposes.",
                        "In a preferred embodiment, said predetermined distribution is a multivariate standard Gaussian defined as",
                        "log p(x|\u0398)=\u2212\u00bd\u2225f\u0398(x)\u22252\u2212n/2 log(2\u03c0)+log|det Jf\u0398(x)|,",
                        "where f\u0398 represents a network of said ensemble of neural networks with corresponding network parameters \u0398, x is a data sample and Jf\u0398 denotes the Jacobian of the distribution.",
                        "In a preferred embodiment, said OoD detection algorithm is based on a variational autoencoder.",
                        "In a preferred embodiment, prior to or along with applying a regressor or classifier that has been trained with a given training data set, said computing device or additional computing device is configured for carrying out said OoD detection to determine the closeness of the multispectral image or part of said multispectral image to said given training data set, or to a related training data set, and to not determine the functional tissue parameter or to mark it as unreliable, if the closeness is found to be insufficient, wherein, in case the closeness is found to be insufficient, the computing device or additional computing device is further configured to check whether the closeness with a training dataset associated with another regressor or classifier is better, and given the case, to apply said another regressor or classifier to said multispectral image or parts of said multispectral image,",
                        "wherein in particular, said training dataset associated with said another regressor or classifier corresponds to different illumination conditions or to a different tissue type.",
                        "In a preferred embodiment, prior to applying a regressor or classifier to a multispectral image or part thereof, said computing device or additional computing device is configured for using the OoD detection for selecting among a plurality of regressors or classifiers, each associated with a corresponding training data set, the regressor or classifier whose training data the multispectral image or part of said multispectral image is closest to, and for applying said selected regressor or classifier to the multispectral image or part thereof,",
                        "wherein said training datasets associated with said plurality of regressors or classifiers preferably correspond to different illumination conditions or different tissue types.",
                        "The computing device or additional computing device is preferably configured for carrying out said OoD detection repeatedly over time, to thereby detect a change in conditions, in particular illumination conditions, by means of a change in closeness of the multispectral image with a given set of training data."
                    ],
                    "subsections": [],
                    "outline_long": [
                        "introduce problem of functional imaging",
                        "propose solution with method and system",
                        "define method of generating augmented images",
                        "estimate spectral composition of light",
                        "obtain multispectral images",
                        "apply machine learning based regressor or classifier",
                        "derive tissue parameters from multispectral images",
                        "train regressor or classifier for different illuminations",
                        "transform multispectral image based on estimated spectral composition",
                        "apply standard regressor or classifier",
                        "retrain regressor or classifier using simulation data",
                        "combine multiple variants",
                        "define augmented imaging and tissue parameter",
                        "provide functional information",
                        "provide physiological information",
                        "associate tissue parameters with pixels or regions",
                        "define tissue classification parameter",
                        "designate morphological information",
                        "segment image according to morphological features",
                        "designate different materials and/or tooth decay",
                        "designate key landmarks",
                        "provide event parameter",
                        "predict medical event",
                        "estimate spectral composition of illuminating light",
                        "measure spectral composition",
                        "compute spectral composition based on control parameters",
                        "estimate spectral composition from specularly reflected light",
                        "identify regions of specular reflection",
                        "transform multispectral image to lower dimensional color space",
                        "sort regions of specular reflection according to size",
                        "discard small specular regions",
                        "subject identified regions to morphologic dilation",
                        "separate specular and diffused reflection",
                        "use blind source separation method",
                        "record multispectral images with lower exposure",
                        "estimate spectral composition based on selected pixels",
                        "select pixels with high lightness",
                        "transform spectral information to quasi-continuous spectrum",
                        "generate series of augmented images at video rate",
                        "obtain multispectral images using multispectral sensor",
                        "configure sensor pixels for measuring intensity of received light",
                        "obtain multispectral image in a single shot",
                        "use convolutional neural network (CNN)",
                        "allow for rapid calculation of tissue parameters",
                        "enable end-to-end processing of spectral images",
                        "provide accurate results",
                        "describe preferred embodiments",
                        "conclude summary of invention",
                        "introduce multispectral imaging",
                        "motivate CNNs for tissue parameter estimation",
                        "describe neighborhood-based estimation",
                        "define multispectral pixel",
                        "describe simulated neighborhood training",
                        "input reflectance values to regressor/classifier",
                        "derive RGB image from multispectral image",
                        "train regressor/classifier with forward model",
                        "describe layered tissue model",
                        "define optically relevant tissue parameters",
                        "adapt spectral reflectance to imaging system",
                        "estimate intensity associated with each color channel",
                        "select simulations by comparison with real tissue measurements",
                        "train regressor/classifier with domain adaption",
                        "apply multiple regressors/classifiers to multispectral image",
                        "provide confidence value with tissue parameter prediction",
                        "handle low confidence values",
                        "combine tissue parameters from different regions/images",
                        "derive probabilistic distribution of tissue parameters",
                        "handle ambiguous tissue parameter distributions",
                        "generate new multispectral image with different setup",
                        "describe oxygenation estimation with few wavelength bands",
                        "determine suitable wavelength bands for oxygenation estimation",
                        "project augmented image into field of vision of goggles",
                        "describe components of goggles",
                        "convert multispectral reflectance to tissue parameters",
                        "detect out-of-distribution multispectral images",
                        "determine closeness of multispectral image to training data",
                        "describe out-of-distribution detection algorithm",
                        "use ensemble of neural networks for out-of-distribution detection",
                        "transform data sample with neural networks",
                        "determine numerical closeness value from transformed data samples",
                        "use widely applicable information criterion for out-of-distribution detection",
                        "define widely applicable information criterion",
                        "use WAIC as numerical closeness value",
                        "describe predetermined statistical distribution",
                        "define multivariate standard Gaussian distribution",
                        "introduce OoD detection algorithm",
                        "motivate neural networks",
                        "describe autoencoder based anomaly detection",
                        "explain variational autoencoder",
                        "describe OoD detection for regressor or classifier selection",
                        "outline system for generating augmented images",
                        "describe apparatus for estimating spectral composition",
                        "explain multispectral camera",
                        "outline computing device with machine learning module",
                        "describe tissue parameters",
                        "outline system components",
                        "describe apparatus for estimating spectral composition",
                        "explain multispectral image transformation",
                        "describe region of specular reflection identification",
                        "outline spectral composition estimation",
                        "describe lower exposure multispectral image recording",
                        "explain pixel or pixel group selection",
                        "describe quasi-continuous spectrum transformation",
                        "outline augmented image generation",
                        "describe multispectral sensor",
                        "explain regressor or classifier application",
                        "describe neighborhood selection",
                        "outline simulated neighborhood training",
                        "describe reflectance value input",
                        "explain dark image subtraction and normalization",
                        "describe RGB image derivation",
                        "outline forward model training",
                        "describe tissue model",
                        "explain spectral reflectance simulation",
                        "describe imaging system adaptation",
                        "outline regressor or classifier training",
                        "describe subset selection",
                        "explain confidence value provision",
                        "describe probabilistic distribution derivation",
                        "outline new multispectral image generation",
                        "describe oxygenation or blood volume fraction related tissue parameter",
                        "explain multispectral image composition",
                        "describe out of distribution detection",
                        "outline OoD detection algorithm",
                        "describe ensemble of neural networks",
                        "explain widely applicable information criterion",
                        "describe predetermined statistical distribution",
                        "outline variational autoencoder based OoD detection",
                        "describe OoD detection for regressor or classifier selection",
                        "explain training dataset association",
                        "describe repeated OoD detection",
                        "outline change in condition detection",
                        "describe illumination condition detection",
                        "explain system configuration",
                        "describe display device configuration",
                        "outline goggles configuration",
                        "describe multispectral camera integration",
                        "explain microphone integration",
                        "describe wireless data link integration",
                        "outline data processing unit configuration",
                        "describe gesture recognition",
                        "explain augmented image display control",
                        "describe system configuration"
                    ],
                    "num_characters": 72140,
                    "outline_medium": [
                        "introduce problem of functional imaging",
                        "propose method and system for functional imaging",
                        "define method of generating augmented images",
                        "estimate spectral composition of light",
                        "obtain multispectral images",
                        "apply machine learning based regressor or classifier",
                        "derive tissue parameters from multispectral images",
                        "explain application of regressor or classifier",
                        "describe three variants of applying regressor or classifier",
                        "select regressor or classifier based on estimated spectral composition",
                        "transform multispectral image based on estimated spectral composition",
                        "retrain regressor or classifier using simulation data",
                        "combine multiple variants of applying regressor or classifier",
                        "define augmented imaging and tissue parameter",
                        "provide examples of tissue parameters",
                        "describe functional or physiological parameters",
                        "describe tissue classification parameters",
                        "describe event parameters",
                        "describe prediction-of-event parameters",
                        "estimate spectral composition of illuminating light",
                        "identify regions of specular reflection",
                        "transform multispectral image to lower dimensional color space",
                        "separate specular and diffused reflection contributions",
                        "estimate spectral composition based on selected pixels or pixel groups",
                        "introduce multispectral imaging",
                        "motivate CNNs for tissue parameter estimation",
                        "describe neighborhood-based estimation",
                        "define multispectral pixel and sensor",
                        "train regressor or classifier using simulated data",
                        "input reflectance values to regressor or classifier",
                        "derive RGB image from multispectral image",
                        "train regressor or classifier using forward model",
                        "describe layered tissue model",
                        "adapt spectral reflectance to imaging system",
                        "select simulations based on real tissue measurements",
                        "apply multiple regressors or classifiers",
                        "provide confidence value with tissue parameter prediction",
                        "handle low confidence values",
                        "derive probabilistic distribution of tissue parameters",
                        "generate new multispectral image with different setup",
                        "determine suitable wavelength bands for oxygenation estimation",
                        "describe out of distribution detection",
                        "introduce OoD detection algorithm",
                        "motivate neural networks",
                        "describe autoencoder based anomaly detection",
                        "explain OoD detection for regressor or classifier selection",
                        "describe system for generating augmented images",
                        "introduce apparatus for estimating spectral composition",
                        "describe multispectral camera",
                        "explain machine learning module",
                        "describe tissue parameters",
                        "introduce apparatus for estimating spectral composition",
                        "describe estimation of spectral composition",
                        "explain transformation of multispectral image",
                        "describe sorting of regions of specular reflection",
                        "explain morphologic dilation",
                        "describe separation of specular and diffused reflection",
                        "introduce lower exposure multispectral images",
                        "describe estimation of spectral composition",
                        "explain selection of pixels or pixel groups",
                        "describe transformation to quasi-continuous spectrum",
                        "introduce series of augmented images",
                        "describe multispectral sensor",
                        "explain regressor or classifier based on convolutional neural network",
                        "describe application of regressor or classifier",
                        "introduce simulated neighborhood",
                        "describe obtaining reflectance values",
                        "explain derivation of RGB image",
                        "introduce forward model",
                        "describe tissue model",
                        "explain adaptation of spectral reflectance"
                    ],
                    "outline_short": [
                        "introduce problem of functional imaging",
                        "propose method and system for functional imaging",
                        "describe method of generating augmented images",
                        "estimate spectral composition of light illuminating tissue",
                        "obtain multispectral images of tissue",
                        "apply machine learning based regressor or classifier",
                        "describe three variants of applying regressor or classifier",
                        "define augmented imaging and tissue parameter",
                        "provide examples of tissue parameters",
                        "describe estimation of spectral composition of illuminating light",
                        "describe identification of regions of specular reflection",
                        "describe preferred embodiments of the method",
                        "motivate multispectral imaging",
                        "describe CNN-based regressor for tissue parameter estimation",
                        "detail training of regressor using simulated neighborhoods",
                        "outline application of regressor to multispectral image",
                        "describe forward model for tissue parameter estimation",
                        "detail ensemble of regressors for improved tissue parameter estimation",
                        "describe probabilistic distribution of tissue parameters",
                        "outline out-of-distribution detection for machine learning algorithms",
                        "detail WAIC-based out-of-distribution detection algorithm",
                        "introduce OoD detection algorithm",
                        "describe ensemble of neural networks",
                        "motivate variational autoencoder",
                        "summarize system for generating augmented images",
                        "describe apparatus for estimating spectral composition",
                        "outline machine learning module",
                        "detail regressor or classifier",
                        "explain tissue model",
                        "describe forward model",
                        "outline training of regressor or classifier",
                        "describe application of regressor or classifier",
                        "detail out of distribution detection",
                        "describe selection of regressor or classifier",
                        "outline repeated OoD detection"
                    ]
                },
                {
                    "title": "DESCRIPTION OF THE PREFERRED EMBODIMENTS",
                    "paragraphs": [
                        "For the purposes of promoting an understanding of the principles of the invention, reference will now be made to a preferred embodiment illustrated in the drawings, and specific language will be used to describe the same. It will nevertheless be understood that no limitation of the scope of the invention is thereby intended, such alterations and further modifications in the illustrated apparatus and such further applications of the principles of the invention as illustrated therein being contemplated as would normally occur now or in the future to one skilled in the art to which the invention relates.",
                        "As was indicated above, multispectral imaging (MSI) has the potential to monitor intricate changes in tissue perfusion, which are quantified by blood volume fraction and oxygenation and cannot easily be seen by the human eye. Deciphering this information, i.e., estimating the molecular composition of tissue on the basis of multispectral images, remains challenging.",
                        "Embodiments of the invention are capable of video-rate estimation of physiological parameters during minimally invasive interventions as well as open surgery by combining the accuracy of Monte Carlo based approaches with the speed of state-of-the-art machine learning (ML) algorithms, as is schematically indicated in FIG. 1.",
                        "FIG. 1 gives a schematic overview over a augmented imaging method according to an embodiment of the present invention. As is seen from FIG. 1, the procedure comprises an \u201coff-line\u201d part, also referred to as \u201ctraining part\u201d, which is carried out prior to the actual intervention during which augmented imaging is desired, and an \u201conline part\u201d in which the augmented imaging is carried out in real time. As seen from FIG. 1, in the offline phase, n examples (ti)n,1 are drawn from a point-wise model of artificial tissue to be described in more detail below. For each of these samples, highly accurate simulations calculate a spectral reflectance ri. Herein, the index i denotes a voxel of the tissue that leads to a pixel in the image, and the bold font indicates that the reflectance ri is a vector, since it comprises as its components reflectance values for different wavelengths. Note that throughout this disclosure, vectors are indicated by bold font. In a next step, spectral reflectance ri is transformed to a space, which indicates the reflectance in each band that will be measured with the actual imaging system, i.e. the camera and the corresponding optics. The result of the learning is a regressor {circumflex over (\u2003)}\u0192, which indicates the reflectance in each band that will be measured with the actual imaging system, i.e. the camera and the corresponding optics. Accordingly, this transformation is referred to as \u201cadaption to imaging system\u201d in FIG. 1 above. The band reflectances xi are then ready to serve as input for a machine learning algorithm. The algorithm learns how to relate the reflectance measurement of a pixel i to a functional tissue parameter yi\u2208ti, by establishing a corresponding regressor {circumflex over (\u2003)}\u0192. This tissue parameter can e.g. be tissue oxygenation or blood volume fraction, but other function parameters are likewise possible, provided that they are represented by the tissue model.",
                        "In the online application, shown in the lower half of FIG. 1, the trained machine learning based regressor {circumflex over (\u2003)}\u0192 is then applied to real multispectral images and within milliseconds generates an estimate yi for each (multispectral) pixel in the image. As is indicated in FIG. 1, these real multispectral images can be generated by cameras employed by different types of devices. One application would be a camera associated with a laparoscope. A second application considered herein relates to a camera that is installed in an operating room, for example associated with an operating room light device, and a third application relates to a camera associated with glasses or goggles to be worn by a surgeon. While in the laparoscope the illumination of the tissue is solely due to the illumination light source of the laparoscope itself, which has a precisely known spectral composition, in open surgery applications, where the other two applications would typically find use, one would usually have to deal with uncontrolled and varying illumination conditions. Various ways to cope with this situation are summarized under \u201cauto calibration\u201d in FIG. 1 and will be described in more detail below. From the multispectral images, true band reflectance measurements are derived, to which then the off-line trained regressor {circumflex over (\u2003)}\u0192 is applied, to derive the tissue parameters yi (in the example of FIG. 1 \u201coxygenation\u201d) of the tissue encoded in the reflectance measurements. Since the functional parameters yi are associated with corresponding image pixels i, they can be displayed on a suitable display device as an image, as is shown in the lower right of FIG. 1 for the case of oxygenation. For laparoscopic applications, the display could be the same display on which the ordinary RGB images are displayed, and the augmented images could be additionally presented, next to the RGB image, or in an overlaid fashion. However, the augmented images or the information contained therein could also be presented in a chart or the like, for example a chart showing the oxygenation over time for a given region of interest. That is to say, the term \u201caugmented image\u201d implies that there is a tissue parameter associated with a certain region or pixel of an image of the tissue of interest, but it does not necessarily mean that it is represented to the user as an image.",
                        "For applications in open surgery, the display could be a display provided in the operating room, or the lenses of goggles to be worn by a surgeon into which functional information or any other type of additional information can be projected as per se known from augmented reality or so-called mixed reality applications.",
                        "As is apparent from the above, the input to the machine learning regression in the shown example is generated by a \u201cforward model\u201d that consists of three parts: (1) a layered tissue model that formally describes the composition of possible tissues, (2) highly realistic simulations of spectral reflectances that are computed using tissues drawn from the model, and (3) a transformation of the simulation to the camera space, which is referred to as \u201cadaption to imaging system\u201d in FIG. 1. This process of sample creation and transformation is represented by the box in the offline training part of FIG. 1. The term \u201cforward model\u201d indicates that the model follows the forward direction of causality. Namely, starting out from a model of the tissue, the interaction of light with the tissue is simulated, to obtain the reflectance of the tissue. In the preferred embodiment, this simulation is carried out by the Monte Carlo method. Herein, the tissue exhibits certain tissue parameters of interest, such as oxygenation, which will have an influence on its reflectance spectrum. Next, the reflectance of the tissue is adapted to the imaging system to predict the reflectivity image for each frequency band or color channel at each pixel of the multispectral camera under the specific optical setup that is to be used in operation. What needs to be solved in practice, however, is the reverse problem: For augmented imaging, the task is to determine, from the multispectral image, the relevant information of interest concerning the tissue, i.e its tissue parameters. This inverse problem is solved by the machine learning regressor {circumflex over (\u2003)}\u0192 that is trained with the data obtained by the forward model. Both, the details of preferred embodiments of forward models and of the machine learning will be described in more detail in the following sections.",
                        "Layered Tissue Model",
                        "In embodiments of the invention, the tissue t inspected during surgery is modeled as a layered structure. Each layer l is characterized by a set of optically relevant tissue properties: l={vhb, s, amie, b, g, n, d}, where the parameters describe the following:\n\n\n- v_(hb) blood volume fraction \\[%\\], the amount of blood occupying a\n  unit volume of tissue\n- s the ratio \\[%\\] of oxygen-bound hemoglobin to total hemoglobin, also\n  referred to as oxygenation\n- a_(mie) a parameter quantifying the amount of scattering \\[cm\u207b\u00b9\\] by\n  the reduced scattering coefficient at a given wavelength, here at 500\n  nm\n- b the scattering power, a term which characterizes the exponential\n  wavelength dependence of the scattering\n- g an anisotropy factor, characterizing the directionality of\n  scattering\n- n the refractive index\n- d the layer thickness \\[\u03bcm\\]",
                        "The optical and physiological parameters amie, b, g, vhb and s influence the optical absorption and scattering coefficients. As in D. Hidovic-Rowe and E. Claridge. Modelling and validation of spectral reflectance for the colon. PhysMed Biol, 50(6):1071-1093 (2005), the absorption coefficient \u03bca at wavelength \u03bb may be calculated by",
                        "\u03bca(whb,s,\u03bb)=vhbchb(s\u00b7\u03f5HbO2(\u03bb)+(1\u2212s)\u00b7\u03f5Hb(\u03bb))ln(10)(64,500 g mol\u22121)\u22121.\u2003\u2003(1)",
                        "\u03b5HbO2 and \u03b5Hb are the molar extinction coefficients of oxygenated and de-oxygenated hemoglobin and chb is the molar concentration of hemoglobin in human blood. Herein, hemoglobin, the oxygen transporter in human blood, can be assumed to be the only notable absorber at least for visceral applications. Another notable absorber of visible light in human tissue is melamine, which however is mainly contained in the skin. Clearly, the model allows for easy integration of further absorbers (if necessary) by modifying the above equation (1). In this model, oxygenation is assumed to be constant across layers, which is a reasonable assumption if the layers share a common blood supply. The reduced scattering coefficient \u03bcs\u2032 is calculated by an empirical power law",
                        "\\(\\begin{matrix}\n{{\\mu_{s}^{\\prime}\\left( {a_{mie},b,\\lambda} \\right)} = {{a_{mie}\\left( \\frac{\\lambda}{500\\mspace{14mu}{nm}} \\right)}^{- b}.}} & (2)\n\\end{matrix}\\)",
                        "This simple heuristic approximation to measurements of reduced scattering was proposed in S. L. Jacques. Optical properties of biological tissues: a review. Physics in Medicine and Biology, 58(11):R37-R61 (2013) for the visible wavelength range. The anisotropy factor g is assumed constant over the wavelength range. With g and \u03bcs\u2032, the scattering coefficient \u03bcs can be calculated by",
                        "\\({\\mu_{s}\\left( {a_{mie},b,\\lambda} \\right)} = {\\frac{\\mu_{s}^{\\prime}\\left( {a_{mie},b,\\lambda} \\right)}{1 - g}.}\\)",
                        "Pixel independence is implicitly assumed, by modelling tissue as homogeneous, infinite slabs. This leads to less assumptions on the 3D composition of tissue as e.g. vessels, but prevents modelling cross-talk between pixels.",
                        "Calculation of Spectral Reflectance",
                        "The spectral reflectance denotes the portion of light returning to the surface after interaction with the tissue for each wavelength. This quantity is a property of the tissue and as such independent on the measurement system. To generate such a reflectance spectrum r from a tissue drawn from the layered model, a function rsim is evaluated at wavelengths \u03bb",
                        "r(\u03bb,t)=rsim(\u03bb,t)=rsim(\u03bb,l1, . . . ,lk).\u2003\u2003(3)",
                        "In this embodiment, a multi-layered MC (MCML) approach can be chosen for evaluation of rsim, because MC models are widely considered to be the gold standard for calculating how light travels through biological tissue. The MC tissue optics simulation irradiates multi-layered tissue with photon packets as disclosed in L. Wang and S. L. Jacques. Monte Carlo modeling of light transport in multilayered tissues in standard C. The University of Texas, MDAnderson Cancer Center, Houston (1992). Depending on the properties of the layers, the photons will be probabilistically reflected, scattered and absorbed. Among other attributes, the photons reflected at the tissue surface due to (possibly multiple) scattering events can then be determined in the simulation.",
                        "Adaptation to Imaging System",
                        "The simulations described in the previous paragraph yield spectral reflectances at specific wavelengths. The spectral reflectance is an inherent property of the tissue and as such independent on the measurement system and lighting. As a third step in the generation of the forward model, as shown in FIG. 1 (\u201cadapting to imaging system\u201d), the camera independent spectral reflectances are converted to values proportional to image intensities measured by the specific camera that will be used during the intervention in the online application. As indicated in FIG. 1, the camera can e.g. be associated with a laparoscope, a camera installed or movably provided in an operating room, or a camera associated with glasses worn by a surgeon, in particular glasses adapted for augmented reality applications, as will be described in more detail below. The invention is not limited to any specific type of camera. However, in preferred embodiments of the invention, the specific camera to be used in online application is explicitly accounted for in establishing the forward model used for training the machine learning regressor, by what is referred to herein as \u201cadapting to imaging system\u201d in FIG. 1. In the embodiment considered here, the camera comprises a multispectral sensor which integrates the reflectance over the spectral bands bj\u2208b, where j is an integer number indicating the respective band, and b is a vector formed by the individual bands. The camera intensity measurement ij for the j-th band is assumed to be dependent on the following factors:\n\n\n- r(\u03bb,t) the spectral reflectance for the tissue.\n- l_(j)(\u03bb,p) linear factors subsuming the response of b_(j), the quantum\n  efficiency of the camera, the irradiance of the illuminant (e.g.,\n  Xenon or Halogen) and other components in the imaging system like the\n  transmittance of the optic set used. It will generally be dependent on\n  the position in the image p.\n- \u03c4(\u22c5) the camera response function, which is often intentionally\n  non-linear to cover a higher range of irradiances within the possible\n  image intensities\n- \u03c9_(j) camera noise for band j, which is mainly formed by shot noise\n  due to the particle nature of light and so-called dark noise, which is\n  dependent on sensor temperature and linear in integration time",
                        "For large image intensities, the typically Poisson distributed noise sources can be approximated by multiplicative Gaussian noise (see G. E. Healey and R. Kondepudy. Radiometric CCD camera calibration and noise estimation. Pattern Analysis and Machine Intelligence, IEEE Transactions on, 16(3):267-276 (1994), J. Katrarnik, F. Pernur, and B. Likar. Radiometric calibration and noise estimation of acousto-optic tunable filter hyperspectral imaging systems. AppliedOptics, 52(15):3526-3537 (2013) and A. Mansouri, F. S. Marzani, and P. Gouton. Development of a protocol for CCD calibration: application to a multispectral imaging system. International Journal of Robotics and Automation, 20(2):94-100 (2005)). Because the analysis is carried out on pixel level, geometric distortions caused by lens effects are not relevant. Based on the above ingredients, an image intensity can be simulated by",
                        "ij(t)=\u03c4(\u222b\u03bb\u03bblj(\u03bb,p)\u00b7r(\u03bb,t)\u00b7\u03c9jd\u03bb).\u2003\u2003(4)",
                        "Assuming \u03c4(\u22c5) is linear and that the spatial inhomogeneities of the light source are independent of wavelength lj(\u03bb,p)=\u03b1(p) lj(\u03bb), the model simplifies to",
                        "ij(t)=\u03b1(p)\u222b\u03bb\u03bblj(\u03bb)\u00b7r(\u03bb,t)\u00b7\u03c9jd\u03bb\u2003\u2003(5)",
                        "The factor \u03b1(p) accounts for constant multiplicative changes in intensity, which can be regarded as an \u201coverall brightness\u201d. The reason for these changes are differences in distance or angle of the camera to the tissue and the internal scaling of electrical current to values measured by a camera, as further described in E. Claridge and D. Hidovic-Rowe. Model based inversion for deriving maps of histological parameters characteristic of cancer from ex-vivomultispectral images of the colon. IEEE TransMed Imaging (2013).",
                        "Machine Learning Based Inversion With the method described so far, simulated image intensities depend on the image brightness \u03b1(p) and the spectral distribution of light reaching the sensor lj(\u03bb). To make the data more robust to changes in lj(\u03bb), each band intensity may be divided by its volume lj=\u222b\u03bb\u03bblj(\u03bb) d\u03bb. The results is referred to as \u201cband reflectance\u201d herein:",
                        "\\(\\begin{matrix}\n{{r_{j}(t)} = {\\frac{i_{j}(t)}{1_{j}} = {{a(p)} \\cdot {\\int_{\\lambda_{\\min}}^{\\lambda_{\\max}}{{\\frac{l_{j}(\\lambda)}{\\int_{\\lambda_{\\min}}^{\\lambda_{\\max}}{{l_{j}(\\lambda)}d\\lambda}} \\cdot {r\\left( {\\lambda,t} \\right)} \\cdot w_{j}}d{\\lambda.}}}}}} & (6)\n\\end{matrix}\\)",
                        "This corresponds to a calibration with a white target as one would do for real measurements. The multiplicative \u03b1(p) is accounted for by normalizing with the sum of all bands, transforming the data to what is further referred to as normalized reflectance:",
                        "\\(\\begin{matrix}\n{{r_{j,n}(t)} = {\\frac{{\\alpha(p)}{r_{j}(t)}}{{a(p)}\\Sigma_{k}{r_{k}(t)}} = {\\frac{r_{j}(t)}{\\Sigma_{k}{r_{k}(t)}}.}}} & (7)\n\\end{matrix}\\)",
                        "This way, dependence on \u03b1(p) is removed. As a final transformation \u2212log is taken from the normalized reflectance s and the resulting values are divided by their 2 norm, transforming the data to what is called normalized absorbance xj:",
                        "\\(\\begin{matrix}\n{{x_{j}(t)} = {\\frac{{- \\log}{r_{j,n}(t)}}{\\sqrt{{\\Sigma_{k}\\left( {- {\\log\\left( {r_{k,n}(t)} \\right)}} \\right)}^{2}}}.}} & (8)\n\\end{matrix}\\)",
                        "This last transformation is strictly speaking not necessary, but is found to lead to better experimental results in regression. Given a noise model W and a tissue t, the training input data for the regressor X=(x(t1), . . . , x(tm))T can be simulated.",
                        "Any machine learning regressor can be trained for specific tissue parameters y\u2208t, such as oxygenation and blood volume fraction. A machine learning regressor is a function \u0192\u0398, parametrized by parameters \u0398. It maps input features, in this case the described x, to labels y, in this case tissue parameters. Machine learning methods generally aim to find the parameters which minimize the expected risk R:",
                        "\\(\\begin{matrix}\n{\\overset{\\hat{}}{f} = {{\\arg\\underset{f_{\\theta}}{\\min\\;}{R\\left( {f_{\\theta},X_{train},y_{train},{l\\left( {\\cdot {, \\cdot}} \\right)}} \\right)}} = {\\frac{1}{\uf603X_{train}\uf604}{\\sum{l\\left( {{f_{\\theta}\\left( x_{train} \\right)},\\ y_{train}} \\right)}}}}} & (9)\n\\end{matrix}\\)",
                        "Machine learning hence tries to determine the function which maps the training features Xtrain closest to the training labels ytrain. The notion of closeness is provided by the real valued loss 1, which is often amended by a regularizing term to prevent overfitting to the training data. The functions, often also called hypotheses, and minimization technique may differ substantially depending on method.",
                        "In the example of random regression forests, which may be employed in one embodiment, the functions are defined by an ensemble of decision trees. The path a feature traverses in a tree depends on comparisons taking place in the nodes. The output of the function is calculated from the leafs the feature landed in. Because the determination of the optimal trees is NP-complete (where NP stands for nondeterministic polynomial time), learning the trees is usually done by a greedy algorithm, which iteratively adds nodes, as further described in L. Breiman. Random Forests. Machine Learning, 45(1):5-32 (2001). For a more detailed description of machine learning, reference is made to M. Mohri et al. Foundations of Machine Learning. The MIT press (2012). ISBN 978-0-262-01825-8.",
                        "Random forest regressors were chosen in this embodiment because they are capable of near real-time regression of megapixel multispectral images. A further advantage is that random forest regressors are inherently multi-variate and thus allow joint oxygenation and blood volume fraction estimation. However, as will be demonstrated below, neural networks are likewise suited for the task, and advantageous in some respects.",
                        "Application to In Vivo Recordings",
                        "The trained regressor can be applied to each pixel of an in vivo acquired multispectral image, as indicated in the schematic representation of FIG. 1. This image should undergo the same transformations as the simulations. In the preferred embodiment, first the images I are transformed to normalized reflectance by correcting by a dark D and white image W:",
                        "\\(X_{I} = \\frac{I - D}{W - D}\\)",
                        "and dividing by the mean in the spectral dimension. Similar to the transformations to the simulations in Equation (8), the actual multispectral measurement data is further transformed to absorbance and normalized by an additional 2 norm. This ensures that real recordings and simulations are in the same space, which is independent of multiplicative changes in illumination.",
                        "Video Rate Analysis",
                        "In order to allow for augmented imaging at video rate, in one embodiment, a laparoscopic system 10 has been provided which is schematically shown in FIG. 2. The laparoscopic system 10 comprises a laparoscope 12 having a shaft portion 14 and a light guide 16 connected with an illumination light source 18. The laparoscope 12 is different from prior art laparoscopes in that it comprises a small and lightweight multispectral snapshot camera 20 comprising a multispectral snapshot image sensor 22 and suitable imaging optics 24. In preferred embodiments, the multispectral snapshot camera 20 allows for live imaging at video frame rates of higher than 25 Hz. In one embodiment, the Ximea (Muenster, Germany) MQ022HG-IM-SM4X4-VIS multispectral snapshot camera 20 has been combined with a commercially available laparoscope. The Ximea camera includes a mosaic snapshot sensor 22 with a frame rate of up to 170 Hz for image cubes of 512\u00d7272\u00d716 resolution, where the third dimension resembles 16 available color channels. The sensor is made by the Interuniversity Microelectronics Centre (IMEC) in Leuven, Belgium and has a bit depth of 10. The sensor acquires the complete multispectral image at a single snapshot, using a 4\u00d74 repeating mosaic pattern. FIG. 3 shows the mosaic pattern when zoomed twice into a single image.",
                        "In the system 10 of FIG. 2, a blue/green filter 26 is placed in front of the camera 20. As the tissue reflects red brighter than blue, by using the blue/green filter 26, information from red and from blue are recorded at more balanced camera counts, and at similar noise levels. A suitable blue/green filter is a filter that has an average transmissivity in a wavelength range between 400 and 600 nm that is higher than the average transmissivity in a wavelength range between 600 and 750 nm.",
                        "The camera 20 is connected via a data link 28 with a computing device 30 comprising a machine learning module 32. The data link 28 may be a wired or wireless connection. The machine learning module 32 may be a software module installed on the computing device 30. The computing device 30 can be a PC or workstation and preferably has a graphics processing unit (GPU) suitable for rapid processing of the machine learning based processes. However, in other embodiments, the computing device 30 could be an FPGA, which is particularly suitable for incorporating into commercially available platforms, such as platforms currently used by laparoscope manufacturers or the like. The machine learning module 32 receives the sensor data from the multispectral snapshot image sensor 22, subjected to suitable processing by the computing device 30 to determine the tissue parameters needed for the augmented imaging. A display device 34 is connected with the computing device 30 by a further wired or wireless data link 28. The display device 34 can be an ordinary display arranged in an operating room. In FIG. 2, an image 36 is schematically shown on the display 34, including an RGB image 38 of an organ on which an augmented image 40 indicating tissue parameters such as oxidization or blood volume fraction is overlaid.",
                        "With the random forest approach proposed above, it was found difficult to generate the augmented images for this camera at a required speed for fulfilling the 25 Hz requirement. To match the fast recording with equally fast analysis, the random forests were replaced with convolutional neural networks (CNN) known e. g. from Y. Lecun, L. Bottou, Y. Bengio, and P. Haffner. Gradient-based learning applied to document recognition. Proceedings of the IEEE, 86(11):2278-2324 (1998) which allowed for the desired processing speed with reasonable hardware efforts. A further advantage of CNN is that image demosaicing and calibration can naturally be formulated as (convolutional) operations within the CNN architecture and that CNNs can operate on whole images and image patches, thus taking advantage of neighborhood information for contextual information processing.",
                        "In one embodiment, two networks are created. The offline training network shown in FIG. 4 determines weights and biases for functional estimation. The trained weights and biases are put into the live evaluation network shown in FIG. 5, which processes new images in real time during the intervention. The networks can be separated into several modules, explained in the following. In FIGS. 4 and 5, for easy reference, blocks related to input are indicated by dashed frames, blocks related to convolution are indicated by solid frames, and other blocks are indicated by dotted frames.",
                        "Data Preparation",
                        "The spectral reflectance of tissue is an intrinsic property of tissue, which is independent of the imaging system employed. Nonetheless, the recorded reflectance can be influenced mainly by: camera filter responses, camera quantum efficiency, illuminant relative irradiance, etc. Hence, adaptation of simulated spectra to the corresponding imaging hardware is needed.",
                        "With reference to FIG. 4, data preparation module 42 is provided for training only and serves to convert the simulations of spectral reflectance into data which as closely as possible resembles measurements from the multispectral imaging camera used. However, the adaption of simulations may also happen outside of the network during the training.",
                        "The same type of spectral reflectance simulations described above can be used for this purpose and are carried out in block 44. Through camera quantum efficiency and filter transmission measurements provided by the manufacturer and light source relative irradiance, laparoscope transmission and glass filter transmission measurements from a spectrometer, the spectral reflectance simulations are transformed to normalized reflectance space.",
                        "These pixel-wise normalized reflectance simulations are used as basis for functional estimation as described above. However, the mosaic pattern of the specific single snapshot sensor 22 used has a certain spatial extent. The present embodiment simulates local neighborhoods as captured by the sensor. In case of a snapshot multispectral sensor, each spectrum already has a spatial extent (for example 4\u00d74 for a 16 band measurement using the snapshot sensor 22 of FIG. 2, called \u201cmosaic\u201d below). In this case, spectra are presented to the CNN as mosaics. Changes in tissue composition within the mosaic could thus lead to abrupt changes of the measured spectra at these locations. To account for this effect, in this embodiment mosaics are simulated by augmenting rearranging the simulated normalized reflectances xi in a mosaic pattern (see block 46), to thereby account for small neighborhoods within which the tissue can change. A second, randomly drawn staining sample xj, also referred to as \u201cdisturbing simulation\u201d, is arranged in the same manner. The original simulated sample xi and the randomly chosen staining sample or disturbing simulation xj are shown in FIG. 6(a), and the rearrangement in the mosaic pattern is shown in FIG. 6(b). The pixels of the original mosaic are exchanged with pixels of the \u201cdisturbing mosaic\u201d with a certain probability (e.g. 20%). To make the results more robust, a small patch of 3\u00d73 mosaics was simulated, so that one training sample consists of 9=3\u00d73 mosaics with the same base xi and staining xj reflectances, as shown in FIG. 6(c). In FIG. 6(c), pixels or elements of xi that were replaced by pixels/elements of the disturbing simulation xj are indicated by a thick border.",
                        "In this embodiment, it is exploited that CNNs provide the possibility to incorporate regions with a spatial extent into the estimation process. In this embodiment, the system can base functional estimation (or the estimation of other types of tissue parameters) not only on one spectral measurement, but on a neighborhood. Given homogeneous tissue, moving from a single (noisy) spectral measurement to an area is advantageous because this provides multiple (noisy) measurements to base further reasoning on. Disadvantages of moving from (almost) point based region to a larger area are disturbances such as tissue and lighting inhomogeneities.",
                        "In the embodiment shown in FIG. 6, a spatial neighborhood is incorporated. That is to say, the fully trained regressor is not applied to a single \u201cmultispectral pixel\u201d or \u201cmosaic\u201d within the real multispectral image, but to a neighborhood of the real image, as is schematically shown in FIG. 6(d). FIG. 6(d) shows a 4\u00d74 \u201cmosaic\u201d, for which the tissue parameters are to be determined by means of the trained regressor. Incorporating neighborhood here means that the regressor is actually applied to some \u201cevaluated neighborhood\u201d around the 4\u00d74 mosaic, which in this case also includes the eight closest mosaics surrounding the mosaic for which the tissue parameters are to be determined. In FIG. 6(d), the evaluated neighborhood is indicated by hatching. After the trained regressor is evaluated on this evaluated neighborhood, the regressor is moved one mosaic further and evaluated again, which is indicated as \u201cnext neighborhood\u201d in FIG. 6(d). This procedure can be regarded as \u201cconvolutional sliding of regression window\u201d.",
                        "For the purpose of training the regressor, the \u201cevaluated neighborhood\u201d is provided by copying the same mosaic several times until the desired spatial extent is matched, i.e. in the given example, eight times. Noise is added to all measurements independently, as is schematically shown in FIG. 6(e). This brings the advantage of processing regions, namely to be able to base reasoning on multiple measurements. To also model the disadvantages, especially tissue inhomogeneities, several means of varying model complexity may be chosen.",
                        "One simple model for tissue inhomogneity assumes that these occur randomly in the simulated neighborhood. Precisely this assumption has been made in the FIG. 6(c), where random inhomogeneities were simulated by replacing, with a certain probability (in FIG. 6(c) 20%), each pixel within each mosaic of a \u201cbase tissue\u201d (see FIG. 6(f)) by a randomly chosen measurement from a different tissue.",
                        "Other embodiments can employ more complex models for tissue inhomogeneities, such as modeling typical shapes like tissue borders or vessels with differing orientation, as is schematically shown in FIG. 6(f), which shows for comparison a situation where the inhomogeneity is random (top), and a situation where typical shapes, in this example a vessel is modelled (bottom).",
                        "To model sensor noise, zero mean Gaussian noise may be added to the simulations as explained above. In the embodiment shown, both oxygenation and blood volume fraction were selected to be the tissue parameters for regression, but it is understood that other tissue parameters could likewise be chosen. They were set to the mean values within the first 250 \u03bcm within the artificial tissue. The simulated mosaic patches served as input to the normalization module 48, which is part of the training (FIG. 4) and of the live evaluation network (FIG. 5).",
                        "Normalization",
                        "In the normalization module 48, mosaic images are demosaiced (block 50) to separate spectral and spatial domains into individual axes. This can for example be achieved using a bilinear interpolation as described in R. Zhen and R. L. Stevenson. Image Demosaicing. In Color Image and Video Enhancement, pages 13-54. Springer, Cham (2015). ISBN 978-3-319-09362-8 978-3-319-09363-5 or by learning the interpolation within the CNN framework, cf. M. Gharbi, G. Chaurasia, S. Paris, and F. Durand. Deep Joint Demosaicing and Denoising. ACMTrans. Graph., 35(6):191:1-191:12 (2016). In this embodiment, demosaicing 50 is implemented by stacking each mosaic of 4\u00d74 to a 16 dimensional vector. This operation may be implemented by shifting a 4\u00d74 kernel with 16 output channels and a stride of four over the image. Each of the 16 kernel channels then has a 1 entry in the extracted mosaic pixel and zeros elsewhere. It is to be noted that this simple way of demosaicing introduces a small spatial misalignment due to the spatial extent of each mosaic, which however still allowed to receive very good results.",
                        "In the present embodiment, both real measurements and simulations are normalized to account for constant changes in illumination. These changes are caused by varying light source intensities or illuminating conditions, such as poses of a laparoscope or the distance of an operating room light from the tissue of interest. In this embodiment, this is done in block 52 by dividing each of the demosaiced reflectances by its 2 norm. The normalized reflectances then serve as input for the functional estimation module 54.",
                        "Functional Estimation",
                        "The functional estimation module 54 could be regarded as the heart of the network, in which the relationship between input data and tissue parameters is established. In the embodiment shown, it is composed of several convolution/rectified linear units (ReLU) blocks 56 of a type further described in V. Nair and G. E. Hinton. Rectified linear units improve restricted Boltzmann machines. In Proceedings of the 27th international conference on machine learning (ICML-10), pages 807-814 (2010). In the most simple embodiment, all blocks 56 are 1\u00d71 convolutions, denoting the same result as a fully connected, pixel-wise network applied to each image pixel. If patch-wise 3\u00d73 mosaic input is generated as described above, the first two layers are 2\u00d72 convolutions, followed by 1\u00d71 feature transformations. Because of the fully convolutional architecture, patches and images of arbitrary sizes can serve as input to the network. The number of convolutional layers and filters depends on the implementation, weights and biases are learned with respect to the loss described next. The result of the operations, representing an estimate for the tissue parameter image or images (in case more than one tissue parameter is determined, such as oxygenation and blood volume fraction) is then obtained in block 58.",
                        "During training, the obtained functional estimation in block 58 is compared with the true tissue parameters of the tissue. Since in the present embodiment, the tissue is simulated using a tissue model of the type described above, the \u201ctrue tissue parameters\u201d are known, and sufficient datasets can be generated to carry out an efficient training. The comparison with the true tissue parameters of the tissue may be carried out by means of a loss calculation as described in the next section. In the live evaluation network shown in FIG. 5, the same functional estimation module 54 is employed, but in this case, the underlying CNN has been sufficiently trained using the training network of FIG. 4. Accordingly, in this case the \u201caugmented image estimation\u201d 58 is actually expected to be a very good representation of the tissue parameter image of the tissue represented by the camera image 64, and is outputted as the functional image in block 59. Note that carrying out the functional estimation by means of the machine learning based functional estimation module 54 is an example of what is referred to as \u201capplying a machine learning based regressor\u201d to a multispectral image herein. Note that while specific reference has been made to functional parameters herein, this embodiment is likewise applicable to other types of tissue parameters as referred above.",
                        "Loss",
                        "The loss is the objective function to be minimized during training. In the embodiment shown, an Euclidean loss was chosen and employed in block 62, defined as",
                        "\\(\\begin{matrix}\n{{\\frac{1}{2N}{\\sum\\limits_{i}^{N}{\uf605{y_{{true},i} - y_{{pred},i}}\uf606}_{2}^{2}}},} & (10)\n\\end{matrix}\\)",
                        "with N being the elements in the training batch, and the result of the loss calculation is obtained in block 63. Tissue parameters come in differing ranges. In the employed data set, oxygenation varied from 0-100%, while blood volume fraction only ranged from 0-30%. To ensure that different ranges of the estimated parameters do not influence the loss, the real ytrue and estimated ypred were scaled in block 60. This scaling was determined on the training data so that the training labels range from 0 to 1 for each parameter. The trained weights and biases were copied to the in vivo evaluation network.",
                        "Calibration",
                        "With reference to FIG. 5, before the normalization and functional estimation are applied to the in vivo network, the camera images 64 are transformed to reflectance. Two images were recorded before the intervention for this purpose: a dark image with no light and a white image, taken from a white reflectance standard, such as a standard white reference. The reflectance can then be computed as: R=(I\u2212D)/(W\u2212D) where \u201cR\u201d represents the reflectance and \u201cI\u201d the image. This normalization can be incorporated into the network as addition and multiplication operations that can then be highly parallelized in order to speed up computations. Therefore, white and dark recordings were stored in the network to be simply added (\u2212dark) and multiplied (1/(white\u2212dark)), see blocks 66 and 68.",
                        "RGB Estimation",
                        "To also show the physician a familiar image as a reference during the intervention, an RGB image is simultaneously estimated.",
                        "As indicated in FIG. 5, this calculation takes place in a separate path 70 and aimed to reconstruct an idealized RGB filter response FRGB\u2208R3\u00d7m from the multispectral systems response Fmultispectral\u2208R|b|\u00d7m using a linear transformation T\u2208R3\u00d7|b|:",
                        "FRGB=T\u00b7Fmultispectral",
                        "with m being the number of parsed wavelengths and |b|, the number of multispectral bands. Filter matrix Fmultispectral can incorporate light source irradiance and transmission of the optics employed to make the estimation inherently white balanced. The linear transformation T may be found by least squares regression and put into the network. Here the transformation was represented by three 1\u00d71 filters, one for each R, G and B, with no biases.",
                        "Practical Implementation: Video Rate Laparoscope",
                        "One target application is partial nephrectomy, in which a kidney tumor is surgically removed. During these interventions, often the renal artery has to be clamped to prevent bleeding. Verification of correct clamping is not straightforward; especially if the preferable selective clamping of a segmental artery is performed, in which ischemia is induced only in the cancerous part of the kidney. One possibility to ensure correct clamping according to prior art is to check perfusion with indocyanine green (ICG) fluorescence: after ICG is injected in the blood stream, it binds to the plasma. The bound ICG travels through the blood stream and accumulates in the internal organs, especially in the kidney and liver within a minute. No fluorescent signal thus corresponds to no perfusion. Due to long washout periods of about 30 minutes, this test is not repeatable if the wrong segment has been clamped.",
                        "Multispectral imaging (MSI) methods of the present invention are capable of substituting for the only once applicable fluorescence method. With reference to FIG. 7 to 11, results demonstrating the performance of the approach are shown. FIG. 7 shows mean oxygenation values obtained by different methods for comparison, namely by using a CNN regressor, a random forest regressor and the standard Beer-Lambert approach. In each case, the oxygenation is shown as a function of time, while consecutively two clamps were applied to the renal artery. FIG. 8 shows the corresponding standard deviation of the different methods within the region of interest. All three measurements reveal a considerable drop in oxygenation with time. However, a small dip of oxygenation within the first minute after the first clamping could only be measured with the CNN approach. Note that the Beer-Lambert approach gives impossible oxygenation values greater than 100%. It is seen that the CNN regressor gives the best performance.",
                        "FIGS. 9 and 10 show the mean oxygenation and the standard deviation in a similar manner as FIGS. 7 and 8, but for a situation after the last clamp is opened, leading to a recovery of the oxygenation. It is again seen that both of the machine learning-based approaches are superior over the simple Beer-Lambert approach, and that again the CNN regressor has superior performance over the random forest-based regressor.",
                        "Finally, FIG. 11 shows the mean oxygenation as a function of time determined with different training methods for the CNN. The four datasets show the possible combinations of whether the training is based on a small neighborhood (\u201cpatch\u201d) or a single pixel (\u201cpixel\u201d), and whether additional noise coming from nearby tissues was simulated (\u201cstaining\u201d) or not (\u201cno staining\u201d). All methods show the same general trend. The preferred approach which combines both, the patch and the staining estimates higher non-ischemic oxygenation, which is physiologically more plausible, and is also substantially less noisy. In each of FIG. 7 to 11, the letters \u201cR\u201d indicate a re-initialisation of the region of interest. A template matching based region of interest tracker was developed to follow a region of interest through the videos. Due to substantial movement and thus perspective change, the region of interest was initiated at approximately the same position after applying the first clamp, applying the second clamp and before releasing the clamps.",
                        "As was explained above, as part of the adaption of the simulations in the forward model to the imaging system, the spectral composition of the illumination light used is accounted for. This can in fact be quite easily done if the MSI-based augmented imaging is used in a minimally invasive scenario, e.g. in endoscopic or laparoscopic interventions, where the illumination light is solely provided by the instrument used and hence known and well controlled. However, if the MSI-based functional imaging is carried out in open surgery, the spectral composition of the illumination light is not easily controlled, because it will depend on the various light sources used in the operating room. Moreover, since the patient and/or the light sources will be moved under surgery, the composition of the illumination light may constantly change.",
                        "To deal with this situation, during the online application (cf. lower half of FIG. 1), an autocalibration step is carried out which is explained in more detail with reference to FIGS. 12 and 13. The autocalibration 74 comprises two steps, namely a step 76 of estimating a spectral composition of the light currently illuminating a region of interest of the tissue, and a step that ensures that the machine learning based regressor 72 indeed matches the estimated spectral composition of the illumination light. In the embodiment of FIG. 12, the spectral composition of the light source is estimated from specular reflections, also referred to as \u201cspecularities\u201d herein, which will be explained in more detail below. Moreover, in this embodiment the spectral composition is determined based directly on the 16 color channels of the MSI sensor for simplicity, since these values are readily available.",
                        "Regarding the second step, two different variants may be employed. In the first variant shown in FIG. 12, a plurality of regressors 72 are provided, which were each trained on different model light sources (light source 1, light source 2 and so on). These different model light sources are also referred to as \u201ctraining illuminations\u201d above. The different model light sources 72 have different spectral compositions, covering the most typical spectral compositions that can occur in operation room lighting conditions. The autocalibration comprises a step 78 in which the regressor is selected among the plurality of previously trained regressors 72 that is associated with the model light source that is the most similar to the \u201cestimated light source\u201d. In the example shown in FIG. 12, the spectral composition of the model light source 2 is the closest to the spectral composition of the estimated light source, such that the corresponding regressor 72 is used in the online application for determining the tissue parameters. This way, highly reliable tissue parameters can be determined in spite of the fact that the actual illumination spectrum of the region of interest is not previously known. Moreover, the autocalibration 74 can be repeated at comparatively short intervals of as little as one minute, 30 seconds or even less, such that the MSI-based augmented imaging can constantly adapt to changing illumination conditions.",
                        "In the second variant, schematically shown in FIG. 13, only a single regressor 72 is provided, which was trained based on a \u201cgeneric light source\u201d. Herein, the \u201cgeneric light source\u201d is a light source having a spectral composition that is typical to occur at the patient site in the operating room, and provides an illumination that is referred to as the \u201cstandard illumination\u201d above. In this variant too, a step 76 of estimating the spectral composition of the actual light source from specularities is employed, but in this case, a full spectrum is estimated, in a manner described in more detail below. Then, in a step 80, the measurements are \u201ctransformed to generic light source\u201d. This means that the obtained multispectral image is transformed, based on information derived from the estimated spectral composition in step 76, to a transformed multispectral image to which then the regressor 72 trained on the generic light source is applied. The transformation applied in step 80 is capable of compensating a change in the multispectral image due to a deviation of the spectral composition of the actual light source from that of the generic light source. In other words, after the transformation, the multispectral image \u201clooks\u201d like or at least similar to a multispectral image that would have been obtained of the same region of interest if it had been illuminated with the generic light source.",
                        "In exemplary embodiments, the transformation applied in step 80 may be performed by defining a standard optical system F1, which is a n\u00d7m matrix, with each row representing one filter and each column representing transmission in one wavelength (e.g. 300 to 1000 nm in 2 nm steps). F1 could for example be composed by taking the filter transmission of the multispectral camera and multiplying a Xenon light source irradiance spectrum. A second matrix F2 of size 1\u00d7m represents the actual knowledge about the current optical system.",
                        "Note, that the number of filters 1 in the second matrix F2 could equal n, but this is not a necessity as F1 represents a fictional, idealized system. F2 comprises the filter transmission, the estimated light source spectrum and all other knowledge about the optical system, such as a glass filter or the like. A transformation T [l\u00d7n] may then be determined by linear regression to match F1 and F2: F1=T*F2.",
                        "In a third variant, the regressor could be retrained with the simulation data adapted to the current estimate of the light source. The CNN parameters of the original regressor may serve as a starting point for training (transfer learning) which greatly reduces training time of the regressor.",
                        "Next, with reference to FIG. 14, an embodiment of the method for estimating the light source from specular reflections according to step 76 is described in more detail.",
                        "In step 82, specular highlights, i.e. regions of specular reflection are identified in the MSI. In one embodiment, this step 82 comprises the following substeps:",
                        "A substep 84 in which the multispectral image is transformed to the HSI (hue, saturation, intensity) color space. The HSI color space is particularly suitable for determining specular highlights, as it separates color from intensity and saturation. The corresponding transformation matrix can again be determined using linear regression, in a similar manner as described above with respect to the RGB estimation. In particular, the transformation to HSI color space may be based on the RGB estimate of the multispectral image described above. Suitable formulas for the final step of transforming from RGB to HSI color space are e.g. suggested in J. Serra, Espaces couleur et traitement d'images, Centre de Morphologie Math\u00e9matique, Ecole des Mines de Paris, Paris, France, Tech. Rep. N-34/02/MM, 2002. as follows:",
                        "Int=(R+G+B)/3;",
                        "Sat=(2R\u2212G\u2212B)/2 if (B+R)>=2G;",
                        "Sat=(R+G\u22122B)/2 if (B+R)<2G;",
                        "Color information is contained in both hue and saturation. The saturation describes the \u2018purity\u2019 of the color\u2014a specular reflection of a white light source will have R, G as well as B-component and thus a low saturation, whereas the diffusely reflected light from the red tissue will have less G and B contribution, corresponding to a higher saturation. Accordingly, by transforming the multispectral image, or the RGB image derived from the multispectral image, to HSI space allows for a more reliable detection of specular regions as compared e.g. to looking for matching high intensity zones in R, G and B histograms. Indeed, determining specular highlight pixels from these histograms would typically require histogram post-processing/denoising, as described in Stephane Tchoulack et al., A video stream processor for real-time detection and correction of specular reflections in endoscopic images, Joint 6th International IEEE Northeast Workshop on Circuits and Systems and TAISA Conference, 2008, which can be avoided when operating in the HSI color state.",
                        "Step 82 further comprises a substep 86, in which the HSI image is segmented into specular regions and non-specular regions, for example using statistics-based thresholding. The result of the segmentation can for example be a binary image having a value of 1 for a specular reflection and a value of o for non-specular reflection.",
                        "Finally, step 82 further comprises a substep 88, in which the thus identified specular regions are sorted according to size. Some of the \u201cspecular regions\u201d may be formed by single pixels or a region of only a few adjacent pixels, which tend to be outliers and not suitable for estimating the illumination light source spectrum. Moreover, the largest connected region in the segmented image is often actually formed by a diffusive background, and is therefore likewise discarded. Accordingly, the first to n-th largest connected regions of specular pixels are determined, where n is a suitably chosen integer number, wherein it is to be noted that the largest connected region of specular pictures is usually the second largest connected region in the segmented image.",
                        "In practice, it turns out that the specular regions may contain overexposed or saturated pixel values. An overexposed pixel value has a maximum intensity value for a given pixel, for example a value of 256 in an 8-bit camera. These overexposed pixel values do not give useful information regarding the spectrum because part of the spectrum is truncated by the saturation of the corresponding pixel sensor element. In order to deal with such overexposed pixels, in step 90, the specular regions are subjected to morphologic dilatation, until they include a predetermined number or percentage of non-saturated pixels. In mathematical morphology, \u201cdilation\u201d is an operation that uses a structuring element for expanding shapes contained in an input image. In preferred embodiments, a 3\u00d73 pixel large structuring element is used for morphology\u2014dilating the specular region in the demosaiced image. The rationale behind this dilation is that in the neighborhood of a specular region, diffuse and specular components are mixed, such that the additional pixels incorporated by the dilation would still include specular information. The morphological expansion of the specular region will preserve the general shape of the specular region.",
                        "In subsequent step 92, within the specular region, diffused and specular reflection components are separated. In one embodiment, this is carried out using a principal component analysis (PCA). PCA is a statistical procedure that uses an orthogonal transformation to convert a set of observations of possibly correlated variables into a set of values of linearly uncorrelated variables called principal components. If there are n observations with p variables, then the number of distinct principal components is min (n\u22121,p). This transformation is defined in such a way that the first principal component has the largest possible variance (that is, accounts for as much of the variability in the data as possible), and each succeeding component in turn has the highest variance possible under the constraint that it is orthogonal to the preceding components. The resulting vectors are an uncorrelated orthogonal basis set. Under the reasonable assumption that the tissue properties are to a certain degree similar within the specular region, it can be assumed that the specular component s contributes an additive component to the measured spectrum m: m=s*l+ad1+bd2+ . . . . Herein, l resembles the spectrum of the light source, which is preserved in the specular reflection, and d1 and d2 are diffusive components which may likewise vary (according to coefficients a and b). However, it is assumed that these variations are smaller than the variations caused by the specularly reflected light. The purpose of the PCA is now to determine the linear projection of the (centred) data which includes the maximum variance. Since it is assumed that the illumination light source causes the largest variations, i.e. largest variance in the specular region, this projection corresponds to the light source, and resembles the first principal component of the PCA. In another embodiment, the light source could be determined by independent component analysis (ICA), which is a summarizing term for methods which find statistically independent components in data. ICA is suited for this task because the light source illumination spectrum is independent on the tissue.",
                        "In step 94, based on the specular component of the light extracted from the specular region in preceding step 92, the spectrum of the illumination light source is estimated. In the simplest case, it is sufficient to determine the relative intensities of the individual color channels of the MSI sensor. When using the MSI camera 20 of FIG. 2 including the 16 channel multispectral snapshot image sensor 22 for an open surgery application, the intensities for the 16 color channels or bands that are attributable to specular reflection can be determined. This can be sufficient for the embodiment of FIG. 12, where it is only necessary to select the most suitable previously trained regressor 72.",
                        "However, particularly in case of the embodiment of FIG. 13, where the obtained multispectral image is to be transformed to match that of a standard illumination or \u201cgeneric light source\u201d, it is advantageous to derive a quasi-continuous spectrum of the actual light source based on the limited number of color channels of the MSI sensor. In one embodiment, this is carried out by deriving a linear transformation matrix which transforms the k-dimensional measurement (with k being the number of color channels, i.e. 16 in the present embodiment) into a high dimensional, quasi-continuous frequency space. The \u201cquasi-continuous\u201d frequency space can for example span a frequency region of about 300 nm to 700 nm in steps of between 1.5 and 4 nm, for example 2 nm. This may for example be done using the Wiener estimation method disclosed in Izumi Nishidate et al., Visualization of hemodynamics and light scattering in exposed brain of rat using multispectral image reconstruction based on Wiener estimation method, SPIE Proceedings (Optical Society of America, 2015), paper 95360Z.",
                        "Note that the variant of FIG. 13 can be regarded as an application of the so-called \u201ccolor constancy method\u201d. Color constancy methods seek to keep the perceived color of a surface constant despite changes in the spectrum of the Illumination. In other words, color constancy methods aim at producing \u201cillumination-invariant\u201d. This is a challenging task, as neither the spectral reflectance of a surface nor the spectral irradiance of the illumination can be immediately derived from the reflectance spectrum.",
                        "Several approaches for color constancy methods have been suggested in the art, which shall not be discussed in detail here. Instead, reference is made to the overview given in Vivek Agarwal et al., An Overview of Color Constancy Algorithms, Journal of Pattern Recognition Research 1, 2006. While the prior art algorithms were developed for RGB Images, some of them allow for being adapted for multispectral Imaging.",
                        "Next, with reference to FIG. 18, a further and simpler variant for estimating the spectral composition of light illuminating a region of interest of a tissue is illustrated. Herein, the general idea is to frequently capture low exposure images, from which the illuminant can again be estimated via specular highlight analysis. In other words, based on low exposure multispectral images, specular highlight masks can be computed, which represent regions in the image that are not overexposed (due to the low exposure chosen). These regions are assumed to contain a dominant specular component yielding a direct reflection from which the spectral composition of the light source can be obtained when the signal is no longer in saturation. Note that in high exposure images, specular highlights tend to be saturated in which case they are not well suited for direct estimation of the light source's spectral composition). The estimation of functional tissue parameters is still performed on standard high exposure images with a machine learning method adapted to the illuminant parameters estimated from the low exposure specular highlights.",
                        "The procedure illustrated in FIG. 18 comprises the following three main steps:",
                        "(1) Acquisition of Low Exposure Images",
                        "While it is in principle possible to recover spectral information about the illuminant directly from the specular highlights of standard (i.e. high exposure time) multispectral images, in practice, specular reflections usually saturate the detector, leading to \u201cinvalid\u201d pixels. Other parts of the image, on the other hand, are typically substantially affected by underlying tissue properties and thus not well-suited for the recovery of the illuminant. To overcome this problem, in this embodiment, the acquisition of low exposure time multispectral images for calibration is proposed. Note that in the present embodiment, \u201clow exposure\u201d always refers to a comparatively short exposure time. However, the disclosure is not limited to this, and low exposures could also be established using a small diaphragm opening, or the like. While these low exposure images are generally associated with a low signal-to-noise-ratio (SNR), the guiding hypothesis in this embodiment is that in these images, \u201cvalid\u201d specular highlight pixels contain maximum spectral information about the illuminant. To determine the optimal exposure time for these low exposure images, several experiments were carried out as detailed below.",
                        "(2) Image Processing (Specular Highlight Segmentation) In this embodiment, the low exposure images are processed using a specular highlight segmentation approach which involves removing overexposed and underexposed pixels by selecting pixels with intensities Ims in a specific range Imin<Ims<Imax. Herein, Imin is set to the level of dark current for a given exposure time, which only needs to be determined once for a given multispectral camera. Imax accounts for the non-linearity in the camera response at high intensities and is set according to manufacturer specifications. This results in a set of pixel indices corresponding to a set of valid pixels Idxvalid. Based on this index set, specular highlight pixels are identified as follows. Initially, the lightness (IL)i;j is computed for all (i, j)\u2208IdXvalid by averaging the reflectance over all bands:",
                        "\\(\\begin{matrix}\n{\\left( I_{L} \\right)_{i;j} = {\\sum\\limits_{k = 1}^{n}\\frac{\\left( I_{k} \\right)_{i,j}}{n}}} & \\;\n\\end{matrix}\\)",
                        "where n is the number of bands and (Ik)i;j is the intensity corresponding to band k at pixel (i, j). From the \u201clightness image\u201d, a number of NP highlight pixels with the highest values of (IL)i;j are selected. The corresponding indices are represented by Idxhl\u2286Idxvalid. Based on an empirical analysis described below, we choose NP=100.",
                        "(3) Estimation of Illuminant",
                        "The illuminant in this embodiment is computed based on the idealized assumption that the diffusely reflected light from tissue can be neglected in specular highlight pixels chosen in the above manner. For each (i,j)\u2208Idxhl an estimate of the illuminant is computed by normalizing the acquired spectra",
                        "\\({I_{i,j}:L_{\\iota,J}^{\\bigwedge}} = \\frac{I_{i,j}}{{\uf603I_{i,j}\uf604}_{1}}\\)",
                        "{circumflex over (L)} is then set to the mean of all illuminant estimations from single pixels.",
                        "In this embodiment, the XIMEA (M\u00fcnster, Germany) MQ022HG-IM-SM4X4-VIS mosaic camera was used which records multispectral images at 16 bands in the visible range at video framerates. Five different light sources (LS) representing commonly used illumination conditions were used to validate the described approach: LS 1: Xenon (Storz D-light P 201337 20, Tuttlingen, Germany); LS 2: Halogen (Osram light bulb, Munich, Germany); LS 3: Fluorescent Light (desk lamp); LS 4: Xenon (Wolf Auto LP 5131, Knittlingen, Germany); and LS 5: LED (Wolf Endolight LED 2.2, Knittlingen, Germany). The reference illuminant spectra of all LS were obtained with the Ocean Optics HR2000+ (Largo, Fla., USA) spectrometer over a white reference, as described in Antonio, R. K, Cong, P. H.: Imaging spectroscopy for scene analysis. chap. 3.2.2, pp. 24-25 (2013). The irradiance of LS 1-5 normalized as described below is shown in FIG. 19a.",
                        "To quantify the difference between two LS spectra, their illuminant spectra may be considered as vectors and the Euclidean angle between them may be computed, in the manner described in Khan, H. A. e.a.: Illuminant estimation in multispectral imaging. Journal of the Optical Society of America A 34(7), 1085 (2017). The angular distance for the five LS used in this study ranges from 1.0\u00b0 (LS1 and LS4; both Xenon) to 25.9\u00b0 (LS1 and LS3; Xenon and fluorescent) as depicted in a confusion matrix shown in FIG. 19b.",
                        "To generate in silico data for a quantitative validation, a multispectral imaging pixel is generated from a vector t of optical tissue properties as described in the section \u201clayered tissue model\u201d above, which are assumed to be relevant for the image formation process. To convert a vector of tissue properties to a simulated reflectance spectrum rsim(\u03bb,ti) (where a corresponds to the wavelength), the Monte Carlo method is applied. Intensity in band j of a pixel for a given LS and camera is then computed as",
                        "ij(ti)=\u03b1(p)\u00b7wj\u222b\u03bb\u03bb\u03bej(\u03bb)\u00b7rsim(\u03bb,ti)d\u03bb\u2200j\u2208[1,B]",
                        "where \u03bej(\u03bb) represents the irradiance of the illuminant (e.g., Xenon or Halogen) and other components in the imaging system, such as transmittance of optical systems. \u03c9j is the camera noise for band j, B is the number of camera bands, and \u03b1(p) accounts for constant multiplicative changes of reflectance. By drawing samples ti from the layered tissue model and generating corresponding measurements, a data set of simulated multispectral measurements with corresponding ground truth oxygenation can be generated.",
                        "The inventors carried out experiments to assess how accurate and robust this approach to estimating the spectrum based on specular highlight analysis is. Moreover, the effect of errors in the estimation of the spectrum of the LS on the accuracy of functional parameter estimation was analysed.",
                        "For this purpose, multispectral images of an ex vivo pig liver illuminated with the five LS described in FIG. 19 were obtained. To determine the robustness of the described approach to illuminant estimation, images corresponding to a total of eight different poses of the camera relative to each LS (at different angles and distances) were taken. Images were recorded at different exposure times (5-150 ms), which were used for hyperparameter optimization.",
                        "The inventors determined empirically appropriate values for two hyperparameters, namely exposure time Texp for the calibration images (i.e. low exposure images) and number of highlight pixels NP per image. The inventors performed initial experiments using three of the five LS summarized in FIG. 19 namely LS1-LS3. These LS are referred to as validation LS herein, while we LS 4-5 are referred to as test LS. It was observed that varying Np in the range of 75-200 had a negligible influence on performance and thus a choice of Np=100 was made. When analyzing the low exposure images in the validation set (exposure times between 5 ms and 150 ms), the inventors further found that the angular error of illuminant estimations decreases as the SNR increases, where the SNR is defined as:",
                        "\\({{{SNR}\\left( T_{\\exp} \\right)} = {media{n_{({i,j})}\\left( \\frac{{\\left( I_{L} \\right)_{i,j}\\left( T_{e{xp}} \\right)} - {\\overset{\\_}{D}\\left( T_{e{xp}} \\right)}}{\\overset{\\_}{D}\\left( T_{e{xp}} \\right)} \\right)}}},{\\left( {i,j} \\right) \\in {{Idx}_{hl}\\left( T_{e{xp}} \\right)}}\\)",
                        "with (Texp) corresponding to the mean lightness value obtained for dark current (lights turned off), and Idxhl(Texp) representing the indices of the highlight pixels for exposure time Texp. Note that the SNR does not necessarily increase with exposure time due to overexposed specular highlight pixels.",
                        "Based on these findings, in one embodiment, multiple low exposure images were acquired in a range of 5 ms to 150 ms (in steps of 5 ms), and then Texp was set to that (low exposure) image with the maximum SNR. Note that the inventors also investigated acquiring multiple images of the same Texp and averaging the corresponding results but did not find an improvement with this approach.",
                        "To quantitatively assess the performance of this embodiment of the method for illuminant estimation, the method was applied to a total of 40 (number of LS times number of poses per LS) images. Consequently, descriptive statistics for the angle between the reference spectrum and the estimated spectrum was computed.",
                        "To quantify the impact of the error in illuminant estimation on a resulting oxygenation estimation error, the inventors used the simulation pipeline presented above to simulate a set of ground truth optical properties Otrain with |Otrain|=15000. These were used to generate 45 training sets, each corresponding to one of the five light sources LSi or their estimates L\u015ci (n=40; one for each of the eight poses for each LS) and each set comprising 5000 tuples of tissue properties and corresponding measurements. Note that the training sets for the different illuminants correspond to the exact same ground truth tissue parameters (including blood oxygenation, which in this example is the functional parameter to be recovered). For each training data set, a regressor for oxygenation estimation was trained using the approach described above. For testing the performance of the regressors, a test set for each of the five reference LS was generated, following the approach presented in the previous paragraph. Then descriptive statistics was computed for the quality of oxygenation estimation (1) using the reference illuminant for training (LStrain=LStest; n=5), (2) using another illuminant for training (LStrain\u2260LStest; n=20) and (3) using the described approach to illuminant estimation to estimate the LS (LStrain=L\u015ctest; n=40).",
                        "For qualitative validation, a multispectral imaging stream was acquired from the lips of a human subject, and the LS was switched from LS 1 to LS 5 during recording. Automatic light source calibration was carried out to continuously update the regressor to one tailored to the (estimated) light source. As baseline method, the inventors applied a regressor trained on LS 1 (the first LS used) throughout the whole acquisition process. Qualitative analysis was performed by visual inspection of the oxygenation results in a region of interest (ROI).",
                        "FIG. 20a shows the reference illuminant spectrum (circles) along with the estimations (crosses).",
                        "The true illuminant is consistently the nearest neighbour to the estimates, with the exception of LS 1 and LS 4, which are both Xenon LS from different manufacturers and have an angular distance of only 1\u00b0. The performance of the described illuminant estimation method is summarized in FIG. 20b. It can be seen that the angle between the estimate and the reference is always below 3.0\u00b0. The performance for the test light sources LS4 and LS5 is similar to that of the validation light sources LS1-LS3, which were used to tune the two hyperparameters.",
                        "As shown in FIG. 21(a), the mean error in oxygenation estimation when using the ground truth illuminant for training ranges from 10.5% (LS 1) to 12.5% (LS 3), with a mean of 11.3% (averaged over all five LS). The mean, median and maximum value of the mean blood oxygenation error was 11.6%, 11.3% and 13.1% when applying the described approach (n=40). The results were similar for the validation LS (mean: 11.3%) and the test LS (mean: 12.0%). Compared to using an arbitrary LS (no calibration performed), the method according to the present embodiment reduced the mean blood oxygenation error by an average of 47%.",
                        "FIG. 21 (b) illustrates the benefit of the presented approach in vivo. When assuming a constant LS, the estimated blood oxygenation changes when illumination conditions alter (and do no longer match the training conditions). Herein, the changing illumination takes place between images 90 and 100. If the change in illumination is not accounted for, or in other words, if a \u201cconstant illumination\u201d is assumed, this will lead to an error in blood oxygenation estimation, as is seen for images 100 to 200. The approach presented herein, however, compensates for the changing illumination spectrum by automatic LS calibration, such that even under the different illumination spectrum, the same blood oxygenation value is produced.",
                        "The guiding hypothesis that specular highlights extracted from low exposure multispectral images can be processed to recover the illumination spectrum with high accuracy, has been therefore been confirmed in the presented experimental analysis. It was further shown that the high quality of the estimations results in a high accuracy for recovering functional parameters, such as blood oxygenation in the presented example.",
                        "While the inventors optimized the hyperparameters Texp and NP on a subset of the LS used in the study, they did not observe a decrease in accuracy on the test LS. This can be attributed to the fact that the estimation results were robust to changes in these parameters.",
                        "Note that in the described embodiment, it is assumed that the illuminant spectrum is homogenous in the field of view of the camera. While initial experiments in a surgical environment suggest this to be good approximation, in preferred embodiments the method is extended such that different illuminants for different image patches are computed. Secondly, while in the described embodiment, the machine learning algorithm for oxygenation estimation is adapted by choosing a pretrained regressor from a discrete set of regressors, each corresponding to a different LS, in other embodiments, the other two variants described in the summary of the invention can be likewise employed. In other words, it is likewise possible to transform the obtained multispectral image based on information derived from the estimated illuminant spectrum and apply a standard regressor to the transformed multispectral image, which has been trained under standard illumination, where the transformation again compensates a change in the multispectral image due to a deviation in the spectral composition of the illumination from the standard elimination, and it is further possible to retrain an already trained regressor using simulation data that is adapted to the estimated illuminant spectrum.",
                        "While in the embodiment of FIG. 2 the MSI-based augmented imaging system 10 is associated with a laparoscope 12 which includes a multispectral camera 20, a multispectral camera 20 could also be directly provided in an operating room. In various embodiments, the camera 20 could be associated with an operating room light source which is used to illuminate the surgical site. For example, the camera 20 could be attached to an overhead surgical light source. This has the advantage that the illumination light of the tissue at the region of interest will be dominated by the light of the surgical light source having a known spectral composition, which makes it easier to provide a suitable regressor.",
                        "Similar to what is shown in FIG. 2, the camera 20 may be connected to a suitable computing device 30 including a machine learning module 32, and the computing device 30 may be connected to a display device 34 for displaying an RGB image 38 and a augmented image 40, possibly in an overlaid manner. The display device 30 could be installed in the operating room for the surgeon to turn to when additional information, such as functional information is needed.",
                        "FIG. 15 shows a yet further embodiment, where the multispectral camera 20 is associated with goggles 96. The multispectral camera 20 can be of the same type as the one discussed with reference to FIG. 2, including the mosaic multispectral snapshot sensor 22 (not shown in FIG. 15) that allows for recording multispectral images at a frame rate of 25 Hz are above, typically even 100 Hz and above. The goggles 96 comprise a data processing unit 98 which assumes the functionality of the computing device 30 of FIG. 2. In other words, the data processing unit 98 may apply the suitable regressor to the multispectral image data recorded by the multispectral camera 20 to thereby derive the tissue parameters to be displayed in a augmented image. If the data processing is too involved to be carried out by the comparatively small data processing unit 98, at least part of the computation can be carried out in an additional computing device 30 which is connected with the data processing unit 98 by a wireless link indicated by reference sign 100. Since the goggles 96 are typically worn in environments with varying illumination conditions, the autocalibration schemes described above with reference to FIGS. 12 and 13 are particularly useful in combination with the goggles 96.",
                        "In the embodiment shown, the augmented image will be displayed in the field of view of the goggles 96 in a manner per se known from augmented reality (AR) or \u201cmixed reality\u201d (MR) applications. This requires what is known as \u201chand-eye\u201d calibration in the art. Accordingly, the augmented images can be overlaid the actual scenery seen through the goggles by the surgeon. In a preferred embodiment, the goggles 96 may further comprise a light source (not shown) for illuminating the tissue in the region of interest. Also, the goggles 96 are configured for recognizing gestures. For example, the processing unit 98 of the goggles 96 may include program code for recognizing a gesture of a surgeon pointing to a region of interest, which triggers the generation and displaying of the augmented image in the goggles field of view. In some embodiments, the user can \u201cdraw\u201d a more complex region of interest using his or her finger that could indicate the boundaries of the organ or organs for functional or physiological parameter estimation. In yet further embodiments, the goggles 96 may use eye tracking to determine the location to with the user is looking to provide the corresponding tissue parameter estimation. Note that the term \u201ceye tracking\u201d as used herein has a broad meaning, and shall cover any way to determine the location to which the user is looking. In case of the goggles 96, this would mainly be determined by the movement of the head of the person wearing the goggles 96, but the term \u201ceye tracking\u201d is nevertheless used herein, it being understood that it also comprises \u201chead tracking\u201d or the like.",
                        "The goggles 96 further comprise a microphone 102 connected with the data processing unit 98 for enabling speech control. For example, the surgeon could point to an organ and say \u201cshow oxygenation\u201d or \u201cshow blood volume fraction\u201d, which would trigger the generation and display of the corresponding augmented image.",
                        "Note that the various components described could be rearranged differently according to practical considerations. For example, the multispectral camera 20 need not be provided at the goggles, but could be installed at another place in the operating room and transmit the multispectral image information to the processing unit 98 via wireless link 100, or to a further computing device 30 for applying the regressor to the multispectral image data and for transmitting only the augmented image data to the data processing unit 98 of the goggles 96. Similarly, the microphone 102 need not be attached to the goggles 96 themselves, as long as the audio information or its content is conveyed one way or the other to the data processing unit 98 of the goggles 96.",
                        "In a particularly preferred embodiment, the goggles 96 are connected with an external database, for example a database in which preoperative data is stored, or with the PACS database, to provide additional information to be displayed in the goggles field of view. Also, the goggles 96 may be configured for carrying out teaching programs for medical students.",
                        "For example, the user could point to an organ and ask \u201cwhich organ is this?\u201d, or \u201cwhere is the liver?\u201d, and the answer is presented by visual or audio output of the goggles 96.",
                        "In preferred embodiments, the method and system of the invention can be combined with an anatomic structure classification, which is based on the same multispectral images, or parts thereof, that are also used for augmented imaging. In one embodiment, the method may include a step of automatically classifying the anatomic structure, and in particular the organ, to which the region of interest belongs, and to select the regressor among a plurality of available regressors that has been specifically trained for this type of organ. Another application is to use the organ classification in the additional information presented to the user in the goggles 96.",
                        "Various ways of automatic classification of anatomic structures have been suggested in the art, and the embodiment is not limited to any specific one of them. However, a new approach to anatomical structure classification and image tagging, which is particularly suitable for use in embodiments of the present invention, was recently proposed by some of the present inventors, which employs an intrinsic measure of confidence to estimate its own performance with high reliability. This measure was applied to both RGB and multispectral imaging data with drastic improvement of image tagging performance in both cases. Organ recognition was performed by:\n\n\n- - 1. Grouping similar regions using a superpixels\n  - 2. Calculating textural (Local binary patterns) and spectral\n    (average spectrum) features for each superpixel.\n  - 3. Training a SVM classifier to estimate organ for each superpixel\n  - 4. Determining confidence of classification by analyzing the\n    dispersion of class probabilities",
                        "Note that the \u201csuperpixels\u201d are an example of the \u201cimage regions\u201d mentioned above, with which a tissue parameter could be associated. The assessment of confidence estimate was performed through a comprehensive in vivo study with seven pigs. When applied to image tagging, mean accuracy in the experiments increased from 65% to 90% (for RGB) and 80% to 96% (for multispectral), when including the confidence measure. This approach hence significantly improves over the current state of art on automatic labeling of endoscopic videos by introducing the use of the confidence metric, and by being the first study to use MI data for in vivo laparoscopic tissue classification. For more details, reference is made to S. Moccia et al., Uncertainty-Aware Organ Classification for Surgical Data Science Applications in Laparoscopy, DOI 10.1109/TBME 2018.2813015, which is incorporated herein by reference.",
                        "When multispectral imaging has been used in medical applications in prior art, imaging times have been very long, such that it has not been possible to exploit multispectral images in medical applications at a video rate, i.e. with frequencies of say 25 Hz or above. Usually, multispectral cameras would employ filter sets, often arranged in filter wheels, and for every color channel of the multispectral image, a new filter position has to be set, which obviously slows down the multispectral imaging considerably.",
                        "An important improvement has been presented herein above, where a multispectral sensor, shown in FIG. 2 under reference sign 22 allowing for imaging rates beyond 100 Hz was used. This was combined, in one embodiment, with a CNN based regressor, which allowed for deriving augmented images at the same high frequency and hence to the knowledge of the inventors for the first time allowed acquiring multispectral image based augmented images at video rates. However, since the multispectral sensor 22 employed multispectral pixels each composed of 4\u00d74 single pixel sensors, for providing 16 color channel simultaneously, this comes at the price of a somewhat decreased spatial resolution.",
                        "One way of combining both, high processing speed and a high spatial resolution conceived by the present inventors is to try to devise an apparatus with a lower number of frequency bands in the multispectral imaging which, when properly chosen, would still permit deriving tissue parameters, and in particular physiological or functional information with high accuracy. However, the lack of tools in prior art to quantify performance of systems make it rather expensive to design a MSI systems for medical applications. In view of these deficiencies, the inventors developed a generic framework for quantitative and application-specific performance assessment of multispectral cameras and their optical system, which is presented below. Such a framework can be utilized for building and fine-tuning the various components virtually. Based on some user input on camera characteristics and properties of the target domain, such a framework would quantify the performance of the given camera configuration with large amounts of Monte-Carlo generated data and a user-defined performance metric.",
                        "The proposed workflow of the simulation framework for characterizing performance of custom designed multispectral filter bands for medical applications is shown in FIG. 16. The framework leverages simulation of light transport in multi-layered tissue to generate tissue-specific spectral reflectances. The framework developed by the inventors relies on Monte Carlo modeling of light transport in multi-layered tissues (MCML), as described in Wang L, Jacques S L. Monte Carlo modeling of light transport in multi-layered tissues in standard C. The University of Texas, MD Anderson Cancer Center, Houston. 1992:4-11, or the GPU accelerated version that has been described in Alerstam E, Lo W C, Han T D, Rose J, Andersson-Engels S, Lilge L. Next-generation acceleration and code optimization for light transport in turbid media using GPUs. Biomedical optics express. 2010 Sep. 1; 1(2):658-75.",
                        "These can then be combined with previously mentioned user input to obtain realistic camera measurements.",
                        "For band selection, within such a framework, custom band configurations for images can be compared by brute-force, considering all the possible band combinations. However, band selection approaches can be further refined using domain knowledge. Such techniques are inspired by feature selection methodologies for reducing the feature space. Possible approaches that have been tested by the inventors are:\n\n\n- - Wrapper methods: Such methods rely on the regression function and\u2014as\n    the name suggests\u2014wrap the regressor within an optimization\n    function, while iteratively selecting bands that minimize a\n    criterion such as \u2018mean absolute error\u2019. Within this context the\n    search for optimal bands can be modeled as a sequential search\n    selection (SFS), as described in Whitney A W. *A direct method of\n    nonparametric measurement selection. IEEE Transactions on\n    Computers.* 1971 September; 100(9):1100-3, or a best first search\n    (BFS) approach, as described in Kohavi R, John G H. *Wrappers for\n    feature subset selection. Artificial intelligence.* 1997 Dec. 1;\n    97(1-2):273-32. Other possible search strategies can also be\n    incorporated.\n  - Methods relying purely on the input (X) and target data (Y): Such\n    methods are also termed as \u201cfilter\u201d methods. They are independent of\n    the kind of regressor being employed. Different metrics can be\n    employed for methods in this domain such as Conditional Mutual\n    Information Maximization (CMIM) as described in Fleuret F. *Fast\n    binary feature selection with conditional mutual information.\n    Journal of Machine Learning Research.* 2004; 5(November):1531-55);\n    Interaction Capping (ICAP), as described in Jakulin A. *Machine\n    learning based on attribute interactions* (*Doctoral dissertation,\n    Univerza v Ljubljani*), and Joint Mutual Information (JMI) as\n    described in Yang H, Moody J. *Feature selection based on joint\n    mutual information. In Proceedings of international ICSC symposium\n    on advances in intelligent data analysis* 1999 June (pp. 22-25), to\n    name a few. Filter methods are typically used in discrete domain\n    problems such as classification. To extend it to regression, which\n    is a continuous domain problem, for the computation of conditional\n    Mutual information with a continuous target variable, Kraskov's\n    nearest neighbor mutual information estimator (Kraskov A, St\u00f6gbauer\n    H, Grassberger P. *Estimating mutual information. Physical review\n    E.* 2004 Jun. 23; 69(6):066138) is used instead of the typically\n    employed histogram binning.",
                        "Using the workflow described above and schematically shown in FIG. 16, several band selection methods were compared for finding bands best suited. SFS was identified as the best method in this context. Specifically for oxygenation estimation, five bands were identified as the best suited, which are summarized in the table below.",
                        "In this table, the central column designates corresponding wavelength regions, in which the center of the band should lie. If all five wavelength bands are employed in the multispectral imaging, oxygenation results with excellent accuracy can be obtained. This compares favorably with the embodiments described above, in which, 16 wavelength bands were employed. Further analysis of the inventors revealed that in fact any combination of 4 out of the 5 proposed bands would give excellent results for oxygenation estimation. This allows e.g. for designing a multispectral sensor where each multispectral pixel is formed by 2\u00d72 single color pixel sensors, detecting light in corresponding four out of the above five bands. This allows for increasing the resolution as compared to the multispectral sensor 22 described above by a factor of four, while still allowing for obtaining similarly good oxygenation results.",
                        "Surprisingly, the inventors could confirm that good oxygenation estimates can even be obtained when only three of the above five wavelengths are chosen. This allows for an even higher resolution, if the multispectral image sensor comprises only three single color pixel sensors. However, in the multispectral image sensor, three types of single color pixel sensors located in respective three out of the above five bands could be combined with pixel sensors detecting light within different bands that are provided for other imaging purposes.",
                        "For clinical applications, robustness of methods is typically of crucial importance. In preferred embodiments, it is therefore proposed to integrate methods for uncertainty quantification and compensation into the machine learning based algorithms used with the embodiments of the present invention. Main sources of uncertainty can be categorized in aleatoric uncertainty and epistemic uncertainty, cf. Kendall A, Gal Y. What Uncertainties Do We Need in Bayesian Deep Learning for Computer Vision? arXiv:170304977 [cs] [Internet]. 2017 Mar. 15. The former may e.g. describe the inherent noise introduced by the imaging modality, whereas the latter represents the model uncertainty mainly introduced e.g. by invalid assumptions or the lack of training data, for example.",
                        "Given the spectrum of a pixel along with the inferred tissue parameters, there are multiple ways to determine the uncertainty of an estimation:",
                        "Measures of confidence provided by machine learning algorithm: The uncertainty of an inference can be determined in an algorithm-specific manner. For support vector machines, for example, the posterior probability certainty index (PPCI) and the Gini coefficient (GC) can be used, as described in previous work by some of the present inventors, Moccia, S., Wirkert, S. J., Kenngott, H., Vemuri, A. S., Apitz, M., Mayer, B., . . . & Maier-Hein, L. (2018). Uncertainty-aware organ classification for surgical data science applications in laparoscopy. IEEE Transactions on Biomedical Engineering. In the case of random forests, the standard deviation of the individual trees may be used, as described in Breiman L. Random forests. Machine learning. 2001; 45(1):5-3. In convolutional neural networks (CNNs), several methods have been proposed including the estimation of conditional probability densities (Feindt M. A Neural Bayesian Estimator for Conditional Probability Densities. arXiv:physics/0402093 [Internet]. 2004 Feb. 18), the estimation of both model-based and image-based uncertainties (Kendall A, Gal Y. What Uncertainties Do We Need in Bayesian Deep Learning for Computer Vision? arXiv:170304977 [cs] [Internet]. 2017 Mar. 15), and the so-called dropout sampling, as described in Kingma D P, Salimans T, Welling M. Variational Dropout and the Local Reparameterization Trick. In: Cortes C, Lawrence N D, Lee D D, Sugiyama M, Garnett R, editors. Advances in Neural Information Processing Systems 28 [Internet]. Curran Associates, Inc.; 2015 [cited 2018 Jul. 27]. p. 2575-2583. measures quantifying aleatoric uncertainty include a signal-to-noise-ratio and/or a contrast-to-noise-ratio.",
                        "Probabilistic inference: Traditional machine learning methods generate a single \u201chypothesis\u201d given a measurement (e.g. one plausible parameter configuration given a measured spectrum). However, in preferred embodiments of the machine learning algorithms of the present disclosure, the machine learning is directed to deriving multiple plausible hypotheses instead, in a manner described e.g. in Simon A. A. Kohl, Bernardino Romera-Paredes, Clemens Meyer, Jeffrey De Fauw, Joseph R. Ledsam, Klaus H. Maier-Hein, S. M. Ali Eslami, Danilo Jimenez Rezende, Olaf Ronneberger A Probabilistic U-Net for Segmentation of Ambiguous Images, 2018, arXiv:1806.05034v1.",
                        "Other probabilistic approaches (e.g. approximate Bayesian computation) may be used to tackle inverse problems, whose forward process is well-understood. In such embodiments, a distribution of plausible parameter configurations (rather than one single estimate) is outputted for a given spectrum. If the distribution is uni-modal (and not too broad), the inversion of the acquired spectrum can be regarded a well-posed problem. Otherwise, the problem is ambiguous and the different modes of the distribution are outputted as alternative hypotheses, or in other words, \u201cmultiple plausible solutions\u201d.",
                        "In various embodiments, the uncertainty associated with a pixel or region may be used in multiple ways:\n\n\n- - Visualization of uncertainty: The uncertainty can be made explicit\n    by only visualizing estimations with high certainty and/or providing\n    a quantification of confidence along with each measurement.\n  - Confidence-based value aggregation: In such embodiments, confidence\n    values may be used for an uncertainty-based aggregation of values,\n    e.g. a weighted mean of inferred values taken from a region of\n    interest, or the like.",
                        "Mode-based post-processing: Substantially different tissue parameter configurations may\u2014in theory\u2014yield similar spectra. Probabilistic methods of the types mentioned above have found to be able to recover the distribution representing the set of plausible parameter configurations that could have produced a specific spectrum. If the distribution features multiple modes, the ambiguity can potentially be resolved by taking additional measurements with a different hardware setup, for example different filter responses and/or a different illumination spectrum. This is schematically shown in illustrated in FIG. 17.",
                        "FIG. 17 illustrates a situation where different tissue parameter vectors (P1 and P2; here projected onto the first two principal components V1 and V2 in tissue parameter space) are found to yield almost identical spectra, when a first hardware configuration (\u201cconfig. 1\u201d), i.e. a first \u201cimaging setup\u201d is used. However, the ambiguity can be resolved by taking additional measurements with a different hardware configuration (\u201cconfig. 2\u201d). In preferred embodiments, the different hardware configuration or \u201cimaging setup\u201d may refer to different spectra of the illumination light and/or a different selection of bands recorded in the multispectral image.",
                        "In the preceding sections, it has been shown how machine learning algorithms can be used to convert pixel-wise reflectance measurements to tissue parameters, such as oxygenation. However, the accuracy of these algorithms can only be guaranteed if the spectra acquired during surgery match the ones seen during training. In machine learning, a regressor or classifier can only give meaningful results for datasets which are similar or related to datasets for which it has been trained. Datasets lacking such relational similarity are also referred to as \u201cout of distribution\u201d (OoD) datasets in the art. In order to address this issue, the inventors developed methods for detecting so-called out of distribution (OoD) spectra to prevent the machine learning algorithms from presenting spurious results for the tissue parameters. This is an important improvement on the path towards reliable functional imaging in medical treatment.",
                        "Herein, a multi-stage process for uncertainty handling as illustrated in FIG. 22 is proposed. As shown in FIG. 22, for each pixel or image region of the multispectral image, a spectrum can be defined, which could form the input to the regressor. However, before the regression is carried out, it is checked in an OoD detection whether the spectrum or spectra are \u201cclose\u201d to the training data, or whether they are \u201cout of distribution\u201d. If it is confirmed that the spectrum is \u201cvalid\u201d, i.e. close enough to the training data, as is the case for the first line in FIG. 22, the regression can be carried out, to provide one or more functional parameters. In the example shown in FIG. 22, this functional parameter is an oxygenation value. In the preferred embodiment, not only the regression, but also the uncertainty estimation is carried out, based on a full posterior probability distribution schematically likewise shown in FIG. 22. In the first line of FIG. 22, the posterior probability distribution has a single peak and a moderate width, which allows for estimating not only an oxygenation value (77%), but also an uncertainty of \u00b15%.",
                        "The second line of FIG. 22 shows a case where the spectrum deviates significantly from spectra that had been considered during training, such that the OoD detection determines the spectrum to lie \u201cout of domain\u201d. In this case, the regression cannot give meaningful results, and is therefore not carried out.",
                        "Finally, in the third line of FIG. 22, the spectrum was found to be sufficiently close to the training data, but the posterior probability distribution established in the regression has two peaks, indicating that the result is ambiguous. For situations like this, it is advantageous that a full posterior probability distribution is established rather than just a point estimate for each tissue parameter.",
                        "While the inventors are not aware of any previous work in OoD detection in the field of optical imaging, the topic has gained increasing interest in the machine learning community for other purposes. To implement the proposed multi-stage process for uncertainty handling in multispectral image analysis as schematically shown in FIG. 22, the inventors chose an information theory based approach, building upon the work presented in Choi, H., Jang, E., Alemi, A. A.: Waic, but why? generative ensembles for robust anomaly detection. CoRR (2018). In this work, Choi et al. propose the \u201cwidely applicable information criterion\u201d (WAIC) as a means to measure the closeness of a new sample to the training distribution. The advantage of this method lies in the fact that it outperforms many other ensemble based unsupervised learning methods while still being fairly easily computable. An unsupervised approach is highly advantageous as it would be an overwhelming task to generate enough labeled negative samples to train a discriminator between in- and outliers. The extra effort associated with applying WAIC is due to the fact that it is an ensemble based method, hence requiring to train a model multiple times. Depending on the data dimensions, this can be rather demanding both in terms of time and hardware requirements. In the present embodiment, invertible neural networks (INN) as described in Ardizzone, L., Kruse, J., Rother, C., Kothe, U.: Analyzing inverse problems with invertible neural networks. In: International Conference on Learning Representations (2019) are used to estimate WAIC on multispectral medical imaging data.",
                        "The Definition of of WAIC",
                        "In the original work of Watanabe, S.: Algebraic geometry and statistical learning theory. Cambridge University Press (2009), WAIC was defined as",
                        "WAIC(x)=Var\u0398[log p(x|\u0398)]\u2212E\u0398[log p(x|\u0398)];",
                        "where WAIC(x) quantifies the proximity of a sample x to the distribution of the training data Xtr, and is distributed according to p(\u0398|Xtr). In the very recent publication of Choi et al. cited above, it was suggested to use WAIC as a means for OoD in the setting of neural networks. Note that the sign convention of the WAIC as used by Choi and by Watanabe are opposite, and in this disclosure, the definition of Watanabe has been adopted. The variance term in the above equation measures \u2018how certain\u2019 the posterior distribution p(*|\u0398) is about a sample x, the heuristic being that it should be more certain about samples that are close to what it has seen before. The second term in the above equation, which is an \u201cexpectation term\u201d, is used for normalization. The rationale behind this expectation term is that if the expectation of log p(x|\u0398) is high, then the spread measured by the variance might also be larger without actually measuring internal uncertainty of the model. Hence, it is subtracted to account for this effect.",
                        "WAIC Computation with Invertible Neural Networks",
                        "The WAIC concept only works for parametrized models. To meet this precondition, the inventors used a deep neural network f\u0398 to encode the spectra X in a latent space Z following an analytically tractable distribution, which in this embodiment was chosen to be a multivariate standard Gaussian. Note that this neural network f\u0398 is per se unrelated to the machine learning based classifier or regressor that is eventually to be used for determining functional parameters, except that it is trained using the same training data. Namely, the neural network f\u0398 is not intended for predicting any biologically medically meaningful parameters, but is instead simply trained to map a distribution of spectra X to a multivariate standard Gaussian distribution, and is only used for this OoD analysis.",
                        "Let f\u0398: X\u2282Rn\u2192Z\u2282Rn denote the neural network with parameters \u0398. Then one can use the change of variable formula to compute the log-likelihood log p(x|\u0398) for a spectrum x as",
                        "log p(x|\u0398)=\u2212\u00bd\u2225f\u0398(x)\u22252\u2212n/2 log(2\u03c0)+log|det Jf\u0398(x)|,",
                        "where Jf\u0398 denotes its Jacobian. The above expression for the log-likelihood log p(x|\u0398) shows that it is mandatory for the log-Jacobi determinant of the network f\u0398 to be efficiently computable. One established architecture permitting this is the one of normalizing flows originally introduced in Dinh, L., Sohl-Dickstein, J., Bengio, S.: Density estimation using Real NVP. CoRR (2016), which was refined in the above-mentioned article of Ardizzone et al. under the name of invertible neural networks (INN). For each of the examples described in the next section, an ensemble of INNs was trained to estimate p(\u0398|Xtr). Each network consisted of 10 layers of so called coupling blocks (see Dinh et al.) each followed by a permutation layer. Each coupling block consisted of a 3 layer fully connected network with ReLU activation functions. The networks were trained using Maximum-Likelihood training, i. e. by maximizing the loss L(x)=log p(x|\u0398) as given in the above equation using the Adam optimizer is disclosed in Kingma, D. P., Ba, J.: Adam: A method for stochastic optimization. arXiv preprint arXiv:1412.6980 (2014)."
                    ],
                    "subsections": [
                        {
                            "title": "EXAMPLES",
                            "paragraphs": [
                                "The approach to OoD detection explained above has been validated by the inventors in various examples both in silico as well as in vivo use cases.",
                                "An in silico quantitative validation based on simulations is described first. In the simulation framework used, multispectral imaging pixels are again generated from a vector t of tissue properties, which are assumed to be relevant for the image formation process. Plausible tissue samples t are drawn from a layered tissue model as explained in the dedicated section of the same name above. The simulation framework was used to generate a data set Xraw, consisting of 550,000 high resolution spectra and corresponding ground truth tissue properties. It was split in a training Xrawtr and a test set Xrawte, comprising 500,000 and 50,000 spectra respectively.",
                                "For the in silico quantitative validation, the (high resolution) spectra of the simulated data sets were converted to plausible camera measurements using the filter response functions of the 8-band Pixelteq SpectroCam. Herein, a subscript (in this case: SC for SpectroCam) is used to refer to the data set Xraw after it was adapted to a certain camera. XSCtr was split into a small training set XSCtr,s and a superset XSCsup, such that the support of XSCtr,s lay within the support of XSCsup and XSCsup consisted of a cluster of data points outside of the support of XSCtr,s, as illustrated in FIG. 23. This led to a split of XSCtr,d of approximately 49% of XSCtr and XSCsup of approximately 51% of XSCtr. An ensemble of five INNs was trained on XSCtr,s and the WAIC value was evaluated on XSCsup. XSCsup,r is defined as the reduced or \u201crestricted\u201d data set of XSCsup lying in the support of XSCtr,s.",
                                "The inventors then investigated\n\n\n- (1) whether the WAIC distribution of the X_(SC)^(sup,r) matches that\n  of the X_(SC)^(tr,s) and whether\n- (2) the part of X_(SC)^(sup) not in the support of X_(SC)^(tr,s) was\n  correctly classified as outliers by our method.",
                                "As is seen from FIGS. 23 and 24, both of the above assumptions could be confirmed. FIG. 23 shows the results obtained with the WAIC method\u2014trained on the small training set XSCtr,s\u2014when applied to the superset XSCsup. In FIG. 23, the small training set XSCtr,s is projected onto the first two principal components (PCA) of the complete training set XSCtr, and lies within the dashed contour. The 2% percentile of best superset spectra according the WAIC value are shown as a kernel density estimation and lie within the dotted contour shown in FIG. 23, which fully lies within the training set XSCtr,s. Accordingly, the 2% percentile spectra showing the best WAIC values are clearly \u201cin-distribution-samples\u201d. The 2% percentile worst spectra according to the WAIC-value are likewise shown as a kernel density estimation and lie within the chain dotted contour in FIG. 23, and hence clearly outside the small training set XSCtr,s. It is therefore seen that the part of XSCsup not in the support of XSCtr,s was correctly classified as outliers.",
                                "FIG. 24 shows the WAIC distribution of the training set XSCtr,s, the superset XSCsup and the restricted superset XSCsup,r. Note that in FIG. 24 the superset box plot needed to be truncated, since it included much larger WAIC values than the training set and the restricted superset. As seen from FIG. 24, the WAIC distributions of the restricted superset XSCsup,r and of the training set XSCtr,s are in excellent agreement. In fact, the superset XSCsup only differs in the regard that there are far more outliers, which can be accounted to the data points outside of XSCtr,s.",
                                "Next examples directed to in vivo applications are described. In general, there can be various reasons why one would wish to detect a multispectral image, or a part of a multispectral image in which the spectra do not closely match the training data distribution. Possible applications include the detection of abnormal tissue or of artificial objects within the multispectral image, for example surgical or diagnostic instruments.",
                                "To demonstrate the working and usefulness of this aspect, the inventors used the complete training set XSCtr to train an ensemble of five INNs. As in vivo test data, the inventors acquired endoscopic images of porcine organs which were classified as organs lying in the simulation domain XiD and organs not lying in the simulation domain XoD. These spectra were acquired using a Pixelteq SpectroCam on a 30 Stortz laparascope with a a Stortz Xenon light source (Storz D-light P 201337 20). More particularly, the inventors classified liver, spleen, abdominal wall, diaphragm and bowl as in-domain-organs, as hemoglobin can be assumed to be the main absorber in these. In contrast, the inventors classified gallbladder as an out-of-domain organ, since bile is a notable absorber, but has not been considered in the simulation framework using the layered tissue model described above. The sets XiD and XoD consisted of 50000 spectra and 10000 spectra, respectively. The hypothesis underlying this embodiment was that the WAIC values of XiD should be much lower than those for XoD. For reference, the resulting WAIC distributions were also compared to that of the simulated test data XSCte.",
                                "The WAIC distribution for the simulated test data XSCte, the in-domain-organs XiD and the out-of-domain organ XoD are shown in FIG. 25. The distribution of the test data is by far the sharpest with a maximum a posterior probability (MAP) at \u22124.9. The distribution closely matches that of the training data (MAP=\u22124.9). The distribution of XiD also possesses a sharp maximum, however with a far heavier tail. The MAP estimate yields 9.3 which indicates a still existent domain gap between the simulation domain and the organ domain. The distribution of XoD is very noisy and has a much heavier tail than XiD. The MAP lies at 34. This indicates that the proposed WAIC estimate is suitable to distinguish between in-domain-tissue and out-of-domain tissue based on in vivo images. This is a remarkable result, since it is entirely based on unsupervised learning, and still allows to automatically delete determine whether a certain organ belongs to a trained or untrained domain.",
                                "In a further embodiment, the OoD detection can be used for detecting scene changes. As was explained herein, intra-operative image modalities often rely on a careful calibration of the device. For example, when recovering blood oxygenation from multispectral measurements, it is generally required that the regressor employed is trained with the light source that is used during the intervention. In the previously described embodiments, it was indicated how this situation can be handled, for example by estimating a spectral composition of light illuminating a region of interest of the tissue, which need not exactly match the spectral composition on which a given classifier or regressor was trained, and by making the regressor or classifier employed for deriving tissue parameters to match the estimated spectral composition of the illumination light according to one of the possibilities described herein.",
                                "One remaining difficulty in this regard is that particularly in open surgery, the illumination conditions may frequently change, for example when an additional surgical light is switched on, or is brought closer to the region of interest. While it has been demonstrated above how one can cope with varying illumination conditions, there remains the task of noticing significant changes in the illumination conditions that would require an adaption of the regressor or classifier.",
                                "Of course, as was explained above, the described estimation of the spectral composition of the light illuminating a region of interest can be repeated at predetermined time intervals, such that a change in illumination can be noticed when it arises. Unfortunately, this may amount to extra effort occupying computational resources and cause idle times during the determination of tissue parameters. However, based on the OoD detection described herein, a change in the illumination spectrum can be automatically detected once it occurs, if the illumination changes from an illumination that was considered in the training to an untrained illumination. This is of practical relevance, since unnoticed illumination changes can be harmful, since they may render the tissue parameter estimation results invalid. Note that an \u201cillumination considered in the training\u201d and an \u201cuntrained illumination\u201d are of course not absolute criteria, but will depend on the respective application. For example, consider the simple case that there are two regressors, a first regressor that has been trained with first training data associated with a first illumination source and a second regressor that has been trained with second training data associated with a second illumination source, having a different spectral composition as the first illumination source. Then, when using the first regressor, the OoD detection will be based on the WAIC determined based on an ensemble of INNs that has been trained with this first training data. Then, when the illumination is changed to the second illumination, this will be detected as OoD, because this ensemble of INNs has not been trained by training data associated with this second illumination, and the encountered spectra are therefore therefore untrained \u201cfrom its perspective\u201d, although this data has of course been used in training for another ensemble of INNs, that is to be used for detecting OoD with regard to the second regressor.",
                                "In a specific embodiment, Xraw was adapted to to a xiQ XIMEA (Muenster, Germany) SN m4 4 mosaic camera consisting of 16 bands assuming a Wolf LED light source (Wolf Endolight LED 2.2). An ensemble of five INNs was trained on XXimtr. Furthermore, 200 512\u00d7272-pixel images of the lip of a healthy human volunteer were recorded using the xiQ XIMEA camera and a 30 Stortz laparascope, as shown in FIG. 26 on the right. At around image 80, the endoscope was switched from a Stortz Xenon light source (Storz D-light P 201337 20) to a Wolf LED light source (Wolf Endolight LED 2.2). On the left of FIG. 26, a corresponding WAIC time series for the region of interest is shown. It is seen that the changing light source leads to a drastic change in the WAIC. The uncertainty prior to the change of lighting can most likely be explained by the short darkness stemming from the light source switch. The jump at image 100 was due to involuntary movement of the volunteer leading to the image being out of focus. One reason for the generally high WAIC values is the fact that melanin (a chromophore in the skin) was not simulated in the training data.",
                                "From FIG. 26, it is demonstrated that by observing the WAIC, a change in illumination can be automatically determined, and this could for example trigger a recalibration of the system to the different spectral composition of the new illumination. Clearly, this OoD detection can be employed to automatically detect various other scene changes as well.",
                                "In the present implementation, five INNs were used in the ensembles. According to the current understanding of the inventors, this number is sufficient. the inventors computed the WAIC on the data sets used for the organ detection example for up to 20 ensemble members. For both the simulated test data and the in domain organs the values stabilized below n=10.",
                                "The above examples underline the power of WAIC in the setting of medical OoD detection. For practical implementations, it has to be considered that the WAIC is based on \u201carbitrary units\u201d, and that it is therefore not easily possible to define a universal threshold for outlier detection, which would have to be typically determined for each individual application. One approach to deal with this is to devise a suitable normalization. Another possibility could be to just mask the worst n pixels in a certain ROI. Since the estimation of WAIC requires an ensemble of neural networks, the computational effort becomes expensive for larger input dimensions. In view of this, it is suggested to adapt methods for network compression to reduce the computational effort.",
                                "Although a preferred exemplary embodiment is shown and specified in detail in the drawings and the preceding specification, these should be viewed as purely exemplary and not as limiting the invention. It is noted in this regard that only the preferred exemplary embodiment is shown and specified, and all variations and modifications should be protected that presently or in the future lie within the scope of protection of the invention as defined in the claims."
                            ],
                            "subsections": [],
                            "outline_long": [
                                "introduce in silico validation",
                                "describe simulation framework",
                                "generate data set Xraw",
                                "split data set into training and test sets",
                                "convert spectra to camera measurements",
                                "split XSCtr into small training set and superset",
                                "train ensemble of INNs on XSCtr,s",
                                "evaluate WAIC value on XSCsup",
                                "define XSCsup,r",
                                "investigate WAIC distribution of XSCsup,r",
                                "investigate correct classification of outliers",
                                "show results of WAIC method in FIG. 23",
                                "show WAIC distribution of training set, superset, and restricted superset in FIG. 24",
                                "introduce in vivo applications",
                                "describe detection of abnormal tissue or artificial objects",
                                "train ensemble of INNs on complete training set XSCtr",
                                "acquire endoscopic images of porcine organs",
                                "classify organs as in-domain or out-of-domain",
                                "show WAIC distributions of simulated test data, in-domain organs, and out-of-domain organ in FIG. 25",
                                "describe use of OoD detection for detecting scene changes",
                                "describe automatic detection of change in illumination",
                                "show WAIC time series for region of interest in FIG. 26",
                                "discuss limitations of WAIC and need for normalization",
                                "suggest adapting methods for network compression",
                                "conclude with remarks on scope of invention"
                            ],
                            "num_characters": 12651,
                            "outline_medium": [
                                "introduce in silico validation",
                                "describe simulation framework",
                                "generate data set Xraw",
                                "split data set into training and test sets",
                                "convert spectra to camera measurements",
                                "train ensemble of INNs",
                                "evaluate WAIC value",
                                "investigate WAIC distribution",
                                "introduce in vivo applications",
                                "describe OoD detection for scene changes",
                                "demonstrate automatic detection of illumination changes",
                                "discuss practical implementation considerations"
                            ],
                            "outline_short": [
                                "validate OoD detection approach through in silico simulations",
                                "describe in silico quantitative validation methodology",
                                "present results of in silico validation, including WAIC distribution analysis",
                                "demonstrate OoD detection in in vivo applications, including organ detection",
                                "illustrate use of OoD detection for scene change detection, including illumination changes",
                                "discuss practical considerations and potential improvements for OoD detection implementation"
                            ]
                        }
                    ],
                    "outline_long": [
                        "introduce multispectral imaging",
                        "describe limitations of deciphering molecular composition",
                        "introduce embodiment of invention for video-rate estimation",
                        "describe offline and online parts of augmented imaging method",
                        "generate samples from point-wise model of artificial tissue",
                        "calculate spectral reflectance using highly accurate simulations",
                        "transform spectral reflectance to camera space",
                        "train machine learning regressor",
                        "apply trained regressor to real multispectral images",
                        "derive tissue parameters from reflectance measurements",
                        "display tissue parameters as an image",
                        "describe display options for laparoscopic applications",
                        "describe display options for open surgery applications",
                        "introduce forward model for sample creation and transformation",
                        "describe layered tissue model",
                        "define optically relevant tissue properties",
                        "calculate absorption coefficient",
                        "calculate reduced scattering coefficient",
                        "calculate scattering coefficient",
                        "assume pixel independence",
                        "calculate spectral reflectance using MCML approach",
                        "adapt spectral reflectance to imaging system",
                        "convert spectral reflectance to image intensities",
                        "describe camera noise",
                        "simulate image intensity",
                        "simplify image intensity model",
                        "calculate band reflectance",
                        "calculate normalized reflectance",
                        "calculate normalized absorbance",
                        "train machine learning regressor",
                        "describe machine learning based inversion",
                        "introduce random regression forests",
                        "describe decision trees",
                        "describe learning trees using greedy algorithm",
                        "describe advantages of random forest regressors",
                        "introduce neural networks as alternative",
                        "apply trained regressor to in vivo acquired multispectral images",
                        "transform images to normalized reflectance",
                        "transform images to absorbance",
                        "normalize images by 2 norm",
                        "enable video rate analysis",
                        "describe laparoscopic system",
                        "introduce multispectral snapshot camera",
                        "explain camera specifications",
                        "describe blue/green filter",
                        "introduce computing device and machine learning module",
                        "describe data link and display device",
                        "show example image on display",
                        "motivate convolutional neural networks",
                        "describe offline training network",
                        "describe live evaluation network",
                        "introduce data preparation module",
                        "simulate spectral reflectance",
                        "adapt simulations to imaging hardware",
                        "simulate local neighborhoods",
                        "account for spatial extent of mosaic pattern",
                        "describe incorporation of neighborhood information",
                        "model tissue inhomogeneities",
                        "model sensor noise",
                        "introduce normalization module",
                        "demosaic images",
                        "normalize reflectances",
                        "introduce functional estimation module",
                        "describe convolution/ReLU blocks",
                        "describe fully convolutional architecture",
                        "obtain tissue parameter image",
                        "compare with true tissue parameters",
                        "calculate loss",
                        "employ functional estimation module in live evaluation network",
                        "output functional image",
                        "apply machine learning based regressor",
                        "define loss function",
                        "introduce Euclidean loss",
                        "scale real and estimated parameters",
                        "copy trained weights and biases",
                        "transform camera images to reflectance",
                        "compute reflectance",
                        "incorporate normalization into network",
                        "store white and dark recordings",
                        "estimate RGB image",
                        "reconstruct idealized RGB filter response",
                        "find linear transformation by least squares regression",
                        "represent transformation by 1x1 filters",
                        "introduce practical implementation",
                        "describe target application",
                        "explain verification of correct clamping",
                        "show results of multispectral imaging",
                        "compare performance of different methods",
                        "discuss limitations of Beer-Lambert approach",
                        "show mean oxygenation and standard deviation",
                        "compare different training methods for CNN",
                        "introduce autocalibration step",
                        "estimate spectral composition of light source",
                        "ensure regressor matches estimated spectral composition",
                        "describe method for estimating light source from specular reflections",
                        "identify specular highlights in MSI",
                        "transform MSI to HSI color space",
                        "segment HSI image into specular regions and non-specular regions",
                        "sort specular regions by size",
                        "deal with overexposed pixels using morphologic dilatation",
                        "separate diffused and specular reflection components using PCA",
                        "estimate spectrum of illumination light source",
                        "derive quasi-continuous spectrum of actual light source",
                        "apply color constancy method",
                        "illustrate simpler variant for estimating spectral composition of light",
                        "acquire low exposure images",
                        "process low exposure images using specular highlight segmentation approach",
                        "estimate illuminant based on specular highlight pixels",
                        "compute Euclidean angle between illuminant spectra",
                        "generate in silico data for quantitative validation",
                        "simulate multispectral measurements with corresponding ground truth oxygenation",
                        "assess accuracy and robustness of approach to estimating spectrum",
                        "analyze effect of errors in estimation of spectrum on accuracy of functional parameter estimation",
                        "determine empirically appropriate values for hyperparameters",
                        "perform initial experiments using validation LS",
                        "analyze low exposure images in validation set",
                        "define signal-to-noise ratio (SNR)",
                        "set exposure time to that with maximum SNR",
                        "acquire multiple low exposure images",
                        "compute descriptive statistics for angle between reference spectrum and estimated spectrum",
                        "quantify impact of error in illuminant estimation on oxygenation estimation error",
                        "simulate set of ground truth optical properties",
                        "generate training sets for each of the five light sources",
                        "train regressor for oxygenation estimation",
                        "test performance of regressors",
                        "compute descriptive statistics for quality of oxygenation estimation",
                        "perform qualitative validation using multispectral imaging stream",
                        "apply automatic light source calibration",
                        "update regressor to one tailored to estimated light source",
                        "visualize oxygenation results in region of interest",
                        "show reference illuminant spectrum along with estimations",
                        "summarize performance of illuminant estimation method",
                        "show mean error in oxygenation estimation when using ground truth illuminant for training",
                        "show benefit of presented approach in vivo",
                        "illustrate error in blood oxygenation estimation when assuming constant illumination",
                        "compensate for changing illumination spectrum using automatic LS calibration",
                        "produce same blood oxygenation value under different illumination spectrum",
                        "describe method for estimating light source from specular reflections",
                        "summarize approach to illuminant estimation",
                        "confirm guiding hypothesis",
                        "show high accuracy of estimations",
                        "attribute robustness to hyperparameters",
                        "describe embodiment assumptions",
                        "extend method for different illuminants",
                        "describe alternative machine learning algorithms",
                        "describe MSI-based augmented imaging system",
                        "associate camera with operating room light source",
                        "describe computing device and display device",
                        "describe goggles embodiment",
                        "describe data processing unit functionality",
                        "describe autocalibration schemes",
                        "describe augmented image display",
                        "describe gesture recognition",
                        "describe eye tracking",
                        "describe speech control",
                        "describe rearrangement of components",
                        "describe connection to external database",
                        "describe teaching programs",
                        "describe anatomic structure classification",
                        "describe automatic classification step",
                        "describe organ recognition approach",
                        "describe confidence estimate assessment",
                        "describe improvement over prior art",
                        "describe multispectral imaging limitations",
                        "describe improvement with multispectral sensor",
                        "describe trade-off between processing speed and spatial resolution",
                        "describe framework for performance assessment",
                        "describe simulation workflow",
                        "describe band selection approaches",
                        "describe wrapper methods",
                        "describe filter methods",
                        "describe comparison of band selection methods",
                        "describe identified optimal bands",
                        "describe preferred embodiments",
                        "propose integrating uncertainty quantification",
                        "categorize main sources of uncertainty",
                        "determine uncertainty of estimation",
                        "describe measures of confidence",
                        "describe probabilistic inference",
                        "describe other probabilistic approaches",
                        "use uncertainty in multiple ways",
                        "visualize uncertainty",
                        "perform confidence-based value aggregation",
                        "perform mode-based post-processing",
                        "resolve ambiguity",
                        "describe machine learning algorithms",
                        "guarantee accuracy of algorithms",
                        "detect out of distribution spectra",
                        "propose multi-stage process for uncertainty handling",
                        "describe OoD detection",
                        "perform regression and uncertainty estimation",
                        "establish full posterior probability distribution",
                        "implement information theory based approach",
                        "describe widely applicable information criterion",
                        "define WAIC",
                        "compute WAIC with invertible neural networks",
                        "use deep neural network to encode spectra",
                        "compute log-likelihood",
                        "describe architecture of invertible neural networks",
                        "train ensemble of INNs",
                        "describe training process"
                    ],
                    "num_characters": 102379,
                    "outline_medium": [
                        "introduce multispectral imaging (MSI) and its potential",
                        "describe challenges in deciphering MSI information",
                        "introduce embodiments of the invention for video-rate estimation of physiological parameters",
                        "describe the augmented imaging method according to an embodiment of the present invention",
                        "outline the offline part of the method, including training",
                        "describe the online part of the method, including real-time estimation",
                        "introduce the concept of a forward model",
                        "describe the layered tissue model used in the forward model",
                        "define the optical and physiological parameters of the tissue model",
                        "describe the calculation of the absorption coefficient",
                        "describe the calculation of the reduced scattering coefficient",
                        "describe the calculation of the scattering coefficient",
                        "introduce the concept of pixel independence",
                        "describe the calculation of spectral reflectance",
                        "introduce the Monte Carlo method for simulating light transport",
                        "describe the adaptation to the imaging system",
                        "describe the simulation of image intensities",
                        "introduce the concept of band reflectance",
                        "describe the machine learning based inversion method",
                        "outline the application of the trained regressor to in vivo recordings",
                        "describe laparoscopic system",
                        "introduce multispectral snapshot camera",
                        "explain camera filter and data link",
                        "describe machine learning module and computing device",
                        "introduce display device and augmented image",
                        "motivate convolutional neural networks",
                        "describe offline training network",
                        "explain data preparation module",
                        "simulate local neighborhoods and mosaics",
                        "incorporate spatial neighborhood into estimation",
                        "describe normalization module",
                        "demosaic and normalize mosaic images",
                        "establish relationship between input data and tissue parameters",
                        "describe functional estimation module",
                        "apply machine learning based regressor to multispectral image",
                        "define loss function",
                        "motivate scaling of parameters",
                        "describe calibration process",
                        "introduce RGB estimation",
                        "describe practical implementation",
                        "present results of approach",
                        "discuss limitations of Beer-Lambert approach",
                        "compare performance of different methods",
                        "introduce autocalibration step",
                        "describe two variants of autocalibration",
                        "explain transformation of multispectral image",
                        "describe method for estimating light source from specular reflections",
                        "identify specular highlights in MSI",
                        "transform MSI to HSI color space",
                        "segment HSI image into specular regions and non-specular regions",
                        "sort specular regions by size",
                        "deal with overexposed pixels using morphologic dilatation",
                        "separate diffused and specular reflection components using PCA",
                        "estimate spectrum of illumination light source",
                        "derive quasi-continuous spectrum of actual light source",
                        "describe color constancy method",
                        "illustrate simpler variant for estimating spectral composition of light",
                        "acquire low exposure images",
                        "process low exposure images using specular highlight segmentation",
                        "estimate illuminant based on specular highlight pixels",
                        "validate approach using five different light sources",
                        "quantify difference between two LS spectra using Euclidean angle",
                        "generate in silico data for quantitative validation",
                        "assess accuracy and robustness of approach",
                        "analyze effect of errors in estimation of spectrum of LS on accuracy of functional parameter estimation",
                        "determine optimal values for hyperparameters",
                        "quantify impact of error in illuminant estimation on oxygenation estimation error",
                        "perform qualitative validation using multispectral imaging stream",
                        "confirm guiding hypothesis",
                        "discuss robustness of estimation results",
                        "describe embodiment with homogenous illuminant spectrum",
                        "propose extensions to embodiment",
                        "describe MSI-based augmented imaging system",
                        "discuss association of camera with operating room light source",
                        "describe computing device and display device",
                        "introduce goggles embodiment",
                        "describe data processing unit and augmented image display",
                        "discuss autocalibration schemes",
                        "describe gesture recognition and eye tracking",
                        "introduce speech control",
                        "discuss rearrangement of components",
                        "describe connection to external database",
                        "propose anatomic structure classification",
                        "describe approach to anatomical structure classification",
                        "introduce framework for performance assessment of multispectral cameras",
                        "describe preferred embodiments",
                        "propose integrating uncertainty quantification and compensation",
                        "categorize main sources of uncertainty",
                        "determine uncertainty of estimation",
                        "describe measures of confidence",
                        "describe probabilistic inference",
                        "describe other probabilistic approaches",
                        "use uncertainty in multiple ways",
                        "describe mode-based post-processing",
                        "address issue of out of distribution datasets",
                        "propose multi-stage process for uncertainty handling",
                        "describe information theory based approach",
                        "define widely applicable information criterion (WAIC)",
                        "compute WAIC with invertible neural networks"
                    ],
                    "outline_short": [
                        "introduce multispectral imaging (MSI) and its potential",
                        "describe challenges in deciphering MSI information",
                        "introduce embodiments of the invention for video-rate estimation of physiological parameters",
                        "describe the offline part of the augmented imaging method",
                        "explain the online part of the augmented imaging method",
                        "introduce the layered tissue model",
                        "describe the calculation of spectral reflectance",
                        "explain the adaptation to imaging system",
                        "describe machine learning based inversion",
                        "apply the trained regressor to in vivo recordings",
                        "describe laparoscopic system",
                        "introduce multispectral snapshot camera",
                        "explain machine learning module",
                        "describe data preparation",
                        "explain convolutional neural networks",
                        "describe normalization module",
                        "explain functional estimation module",
                        "define loss function",
                        "describe calibration process",
                        "explain RGB estimation",
                        "detail practical implementation",
                        "describe autocalibration step",
                        "describe method for estimating light source from specular reflections",
                        "identify specular highlights in multispectral image",
                        "transform multispectral image to HSI color space",
                        "segment specular regions and non-specular regions",
                        "sort specular regions by size",
                        "dilate specular regions to include non-saturated pixels",
                        "separate diffused and specular reflection components",
                        "estimate spectrum of illumination light source",
                        "describe alternative method for estimating spectral composition of light",
                        "acquire low exposure images and process for specular highlight segmentation",
                        "estimate illuminant based on specular highlight analysis",
                        "summarize experimental results",
                        "discuss limitations of current approach",
                        "propose extensions to method",
                        "describe MSI-based augmented imaging system",
                        "detail various embodiments of system",
                        "discuss autocalibration schemes",
                        "introduce approach to anatomical structure classification",
                        "propose framework for performance assessment of multispectral cameras",
                        "motivate uncertainty quantification",
                        "describe probabilistic inference methods",
                        "discuss uncertainty-based value aggregation",
                        "introduce mode-based post-processing",
                        "describe out-of-distribution detection",
                        "define widely applicable information criterion (WAIC)",
                        "compute WAIC with invertible neural networks"
                    ]
                }
            ],
            "outline_long": [],
            "num_characters": 0,
            "outline_medium": [],
            "outline_short": []
        }
    ],
    "claims": [
        "1. A method of generating one or more augmented images of tissue of a patient undergoing open treatment wherein each augmented image associates at least one tissue parameter with a region or pixel of the image of the tissue, said method comprising:\nestimating a spectral composition of light illuminating a region of interest of the tissue,\nobtaining one or more multispectral images of the region of interest,\napplying a machine learning based regressor or classifier to the one or more multispectral images, or an image derived from said multispectral image, to thereby derive one or more tissue parameters associated with image regions or pixels of the corresponding multispectral image, wherein said regressor or classifier has been trained to predict the one or more tissue parameters from a multispectral image under a given spectral composition of illumination,\nwherein the regressor or classifier employed is made to match the estimated spectral composition of light illuminating said region of interest of the tissue by one of\nselecting the regressor or classifier among a plurality regressors or classifiers that have been previously trained for different training illuminations, such that the spectral composition of the training illumination is the most similar to the estimated spectral composition of said light illuminating said region of interest, or\ntransforming the obtained multispectral image based on information derived from the estimated spectral composition of the light illuminating said region of interest and applying a standard regressor or classifier to the transformed multispectral image, which has been trained under a standard illumination, wherein the transformation is capable of compensating a change in the multispectral image due to a deviation in the spectral composition of the illumination from the standard illumination, or\nretraining an already trained regressor or classifier using simulation data that is adapted to the estimated spectral composition of light illuminating said region of interest.",
        "2. The method of claim 1, wherein said at least one tissue parameter comprises one or more of the following: an oxygenation, a blood volume fraction, a presence or concentration of lipids, a presence or concentration of melanine, a presence or concentration of bile, a presence or density of collagen or elastin, a presence or concentration of water, a presence of artificial dyes, in particular methylene blue, indocyanine green (ICG), or a parameter derived from any or any combination thereof,\na tissue classification parameter designating various organs, designating necrotic tissue, designating cancerous tissue, or designating polyps,\na parameter designating different materials and/or tooth decay in dental applications,\na landmark-indicating-parameter designating nerves or important vessels as key landmarks;\nan event parameter indicating the presence of bleeding, tissue inflammation, or the presence of smoke,\na neurological parameter representing sensory evoked potentials, or\na prediction-of event-parameter, predicting a medical event.",
        "3. The method of claim 1, wherein said estimating a spectral composition of illuminating light is based on light that is specularly reflected from said region of interest of the tissue, or from a region close to said region of interest of the tissue.",
        "4. The method of claim 3, wherein said method further comprises a step of identifying regions of specular reflection within a multispectral image of said region of interest of the tissue, or a region close to said region of interest of the tissue.",
        "5. The method of claim 3, wherein said method further comprises transforming said multispectral image to a lower dimensional color space, in particular HSI color space.",
        "6. The method of claim 4, further comprising sorting regions of specular reflection according to size, wherein the second to n-th largest connected regions of specular pixels are determined, where n is an integer number that is smaller than the total number of regions of connected specular pixels.",
        "7. The method of claim 4, further comprising subjecting identified regions of specular reflection to morphologic dilation to thereby ensure that they include a predetermined number or percentage of non-saturated pixels.",
        "8. The method of claim 4, further comprising separating, within an identified region of specular reflection within the multispectral image, contributions from specular reflection from contributions from diffused reflection, in particular using a principal component analysis or an independent component analysis.",
        "9. The method of claim 3, wherein for estimating said spectral composition of the illuminating light, multispectral images of said region of interest are recorded with a lower exposure than the multispectral images to which said regressor or classifier is applied.",
        "10. The method of claim 9, wherein said lower exposure multispectral images are recorded with one or both of a lower exposure time and a smaller aperture opening than the multispectral images to which said regressor or classifier is applied, wherein the exposure time or aperture size is chosen such that the intensity is decreased by at least 20% with respect to the intensity obtained for the exposure used for recording the multispectral images to which said regressor or classifier is applied.",
        "11. The method of claim 9, wherein said spectral composition is estimated based on a selected number of pixels or pixel groups, wherein said pixels or pixel groups are selected from said lower exposure image according to a selection criterion ensuring that the pixel or pixel group has a high lightness, under the provision that the image detector used for recording the image is not saturated for any of the spectral components of the pixel or pixel group, wherein the lightness is a measure for the average intensity of the pixel or pixel group over all of its spectral components.",
        "12. The method of claim 3, wherein said multispectral image comprises a number of k color channels, and wherein the method further comprises transforming the spectral information from said k color channels, or a subset thereof, to a quasi-continuous spectrum, wherein the wavelengths within said quasi-continuous spectrum are separated by no more than 10 nm.",
        "13.-46. (canceled)",
        "47. A system for generating one or more augmented images of tissue of a patient undergoing open treatment, wherein each augmented image associates at least one tissue parameter with a region or pixel of the image of the tissue, said system comprising:\nan apparatus for estimating a spectral composition of light illuminating a region of interest of the tissue,\na multispectral camera for obtaining one or more multispectral images of the region of interest,\na computing device comprising a machine learning module for applying a machine learning based regressor or classifier to the one or more multispectral images or an image derived from said multispectral image, to thereby derive one or more tissue parameters associated with image regions or pixels of the corresponding multispectral image, wherein said regressor or classifier has been trained to predict the one or more tissue parameters from a multispectral image under a given spectral composition of illumination,\nwherein the computing device is configured to make the regressor or classifier employed to match the estimated spectral composition of light illuminating said region of interest of the tissue by one of\nselecting the regressor or classifier among a plurality regressors or classifiers that have been previously trained for different training illuminations, such that the spectral composition of the training illumination is the most similar to the estimated spectral composition of said light illuminating said region of interest, or\ntransforming the obtained multispectral image based on information derived from the estimated spectral composition of the light illuminating said region of interest and applying a standard regressor or classifier to the transformed multispectral image, which has been trained under a standard illumination, wherein the transformation is capable of compensating a change in the multispectral image due to a deviation in the spectral composition of the illumination from the standard illumination, or\nretraining an already trained regressor or classifier using simulation data that is adapted to the estimated spectral composition of light illuminating said region of interest.",
        "48. The system of claim 47, further comprising a display device, wherein said system is configured to display said augmented image.",
        "49. The system of claim 48, further comprising goggles, wherein said system is configured to project said augmented image into the field of view of said goggles.",
        "50. The system of claim 49, wherein said goggles further comprise one or more of the following components:\na multispectral camera suitable for obtaining said one or more multispectral images of the region of interest,\na microphone for receiving speech commands,\na wireless data link for exchanging data with a computing device or a database, and\na data processing unit suitable for one or more of applying said regressor or classifier to said multispectral image, recognizing gestures indicating regions of interest for which augmented images are to be created, and controlling the display of augmented images in the field of view of the glasses.",
        "51. The system of claim 47, wherein said at least one tissue parameter comprises one or more of the following: an oxygenation, a blood volume fraction, a presence or concentration of lipids, a presence or concentration of melanine, or a parameter derived from any or any combination thereof,\na tissue classification parameter designating various organs, designating necrotic tissue, designating cancerous tissue or designating polyps,\na parameter designating different materials or tooth decay in dental applications,\na landmark indicating parameter designating nerves or important vessels as key landmarks;\nan event parameter indicating the presence of bleeding, or a parameter indicating the presence of smoke,\na neurological parameter representing sensory evoked potentials, or\na prediction of event parameter, predicting a medical event.",
        "52. The system of claim 47, wherein said apparatus for estimating a spectral composition of illuminating light is configured for carrying out said estimation based on light that is specularly reflected from said region of interest of the tissue, or from a region close to said region of interest of the tissue.",
        "53. The system of claim 52, wherein said apparatus for estimating spectral composition is configured for identifying regions of specular reflection within a multispectral image of said region of interest of the tissue, obtained with said multispectral camera, or a region close to said region of interest of the tissue.",
        "54. The system of claim 52, wherein said apparatus for estimating spectral composition is further configured for transforming said multispectral image to a lower dimensional color space.",
        "55. (canceled)",
        "56. The system of claim 53, wherein said apparatus is further configured for subjecting identified regions of specular reflection to morphologic dilation to thereby ensure that they include a predetermined number or percentage of non-saturated pixels.",
        "57. The system of claim 53, wherein said apparatus further configured for separating, within an identified region of specular reflection within the multispectral image, contributions from specular reflection from contributions from diffused reflection, in particular using a principal component analysis or an independent component analysis.",
        "58. The system of claim 52, wherein for estimating said spectral composition of the illuminating light, the system is configured for recording multispectral images of said region of interest with a lower exposure than the multispectral images to which said regressor or classifier is applied.",
        "59. The system of claim 58, wherein said system is configured for recording said lower exposure multispectral images with one or both of a lower exposure time and a smaller aperture opening than the multispectral images to which said regressor or classifier is applied, wherein the exposure time or aperture size is set such that the intensity is decreased by at least 20% with respect to the intensity obtained for the exposure used for recording the multispectral images to which said regressor or classifier is applied.",
        "60. The system of claim 58, wherein said system is configured for estimating said spectral composition based on a selected number of pixels or pixel groups, wherein said system is configured for selecting said pixels or pixel groups from said lower exposure image according to a selection criterion ensuring that the pixel or pixel group has a high lightness, under the provision that the image detector used for recording the image is not saturated for any of the spectral components of the pixel or pixel group, wherein the lightness is a measure for the average intensity of the pixel or pixel group over all of its spectral components.",
        "61.-91. (canceled)"
    ]
}